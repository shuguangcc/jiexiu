import{x as I}from"./earcut-58237617.js";import{p as L}from"./Polyline-b571c705.js";import{n as m}from"./deduplicate-d92c3cc2.js";function W(n){const c=O(n.rings,n.hasZ,E.CCW_IS_HOLE),u=new Array;let e=0,o=0;for(const t of c.polygons){const f=t.count,l=t.index,y=new Float64Array(c.position.buffer,3*l*c.position.BYTES_PER_ELEMENT,3*f),p=t.holeIndices.map(h=>h-l),i=new Uint32Array(I(y,p,3));u.push({position:y,faces:i}),e+=y.length,o+=i.length}const s=x(u,e,o),a=m(s.position.buffer,6,{originalIndices:s.faces});return s.position=new Float64Array(a.buffer),s.faces=a.indices,s}function x(n,c,u){if(n.length===1)return n[0];const e=new Float64Array(c),o=new Uint32Array(u);let s=0,a=0,t=0;for(const f of n){for(let l=0;l<f.position.length;l++)e[s++]=f.position[l];for(let l=0;l<f.faces.length;l++)o[a++]=f.faces[l]+t;t=s/3}return{position:e,faces:o}}function O(n,c,u){const e=n.length,o=new Array(e),s=new Array(e),a=new Array(e);let t=0,f=0,l=0,y=0;for(let h=0;h<e;++h)y+=n[h].length;const p=new Float64Array(3*y);let i=0;for(let h=e-1;h>=0;h--){const r=n[h],_=u===E.CCW_IS_HOLE&&N(r);if(_&&e!==1)o[t++]=r;else{let C=r.length;for(let g=0;g<t;++g)C+=o[g].length;const w={index:i,pathLengths:new Array(t+1),count:C,holeIndices:new Array(t)};w.pathLengths[0]=r.length,r.length>0&&(a[l++]={index:i,count:r.length}),i=_?d(r,r.length-1,-1,p,i,r.length,c):d(r,0,1,p,i,r.length,c);for(let g=0;g<t;++g){const A=o[g];w.holeIndices[g]=i,w.pathLengths[g+1]=A.length,A.length>0&&(a[l++]={index:i,count:A.length}),i=d(A,0,1,p,i,A.length,c)}t=0,w.count>0&&(s[f++]=w)}}for(let h=0;h<t;++h){const r=o[h];r.length>0&&(a[l++]={index:i,count:r.length}),i=d(r,0,1,p,i,r.length,c)}return s.length=f,a.length=l,{position:p,polygons:s,outlines:a}}function d(n,c,u,e,o,s,a){o*=3;for(let t=0;t<s;++t){const f=n[c];e[o++]=f[0],e[o++]=f[1],e[o++]=a?f[2]:0,c+=u}return o/3}function N(n){return!L(n,!1,!1)}var E;(function(n){n[n.NONE=0]="NONE",n[n.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(E||(E={}));export{E as c,O as l,W as o};
