import{_ as q}from"./preload-helper-41c905a7.js";import{s as T}from"./jsonMap-190c5593.js";import{r as p,t as g}from"./typedArrayUtil-d9bc5fbd.js";import{X as D}from"./unitUtils-dd6fb8ee.js";import{l as O,_ as V,A as C}from"./projection-acd73147.js";import{l as K}from"./Polyline-b571c705.js";import{v as L,u as A,y as X,f as H}from"./jsonUtils-c6684c52.js";import{v as Q}from"./normalizeUtils-0f537694.js";import{y as W,u as Y,E as R,v as N,m as S,I as $,e as tt,x as b}from"./Extent-a1a1de42.js";import{h as nt,a as y,I as it,F as x,$ as et,D as rt,O as st}from"./featureConversionUtils-d2229ed4.js";import{t as d}from"./OptimizedFeature-73582c6e.js";import{t as U}from"./json-48e3ea08.js";const h=[0,0];function j(t,n){if(!n)return null;if("x"in n){const i={x:0,y:0};return[i.x,i.y]=t(n.x,n.y,h),n.z!=null&&(i.z=n.z),n.m!=null&&(i.m=n.m),i}if("xmin"in n){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=t(n.xmin,n.ymin,h),[i.xmax,i.ymax]=t(n.xmax,n.ymax,h),n.hasZ&&(i.zmin=n.zmin,i.zmax=n.zmax,i.hasZ=!0),n.hasM&&(i.mmin=n.mmin,i.mmax=n.mmax,i.hasM=!0),i}return"rings"in n?{rings:Z(n.rings,t),hasM:n.hasM,hasZ:n.hasZ}:"paths"in n?{paths:Z(n.paths,t),hasM:n.hasM,hasZ:n.hasZ}:"points"in n?{points:E(n.points,t),hasM:n.hasM,hasZ:n.hasZ}:null}function Z(t,n){const i=[];for(const e of t)i.push(E(e,n));return i}function E(t,n){const i=[];for(const e of t){const r=n(e[0],e[1],[0,0]);i.push(r),e.length>2&&r.push(e[2]),e.length>3&&r.push(e[3])}return i}async function G(t,n){if(!t||!n)return;const i=Array.isArray(t)?t.map(e=>p(e.geometry)?e.geometry.spatialReference:null).filter(p):[t];await V(i.map(e=>({source:e,dest:n})))}const I=j.bind(null,W),J=j.bind(null,Y);function B(t,n,i,e){if(!t||(i||(i=n,n=t.spatialReference),!$(n)||!$(i)||R(n,i)))return t;if(N(n,i)){const r=S(i)?I(t):J(t);return r.spatialReference=i,r}return O(U,[t],n,i,null,e)[0]}let at=class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(n,i,e){if(!n||!n.length||!i||!e||R(i,e))return n;const r={geometries:n,inSpatialReference:i,outSpatialReference:e,resolve:null};return this._jobs.push(r),new Promise(a=>{r.resolve=a,this._timer===null&&(this._timer=setTimeout(this._process,10))})}_process(){this._timer=null;const n=this._jobs.shift();if(!n)return;const{geometries:i,inSpatialReference:e,outSpatialReference:r,resolve:a}=n;N(e,r)?S(r)?a(i.map(I)):a(i.map(J)):a(O(U,i,e,r,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};const ot=new at;function zt(t,n,i){return ot.push(t,n,i)}const lt=new T({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),z=Object.freeze({}),F=new d,mt=new d,_=new d,l={esriGeometryPoint:x,esriGeometryPolyline:et,esriGeometryPolygon:rt,esriGeometryMultipoint:st};function Ft(t,n,i,e=t.hasZ,r=t.hasM){if(g(n))return null;const a=t.hasZ&&e,o=t.hasM&&r;if(i){const s=y(_,n,t.hasZ,t.hasM,"esriGeometryPoint",i,e,r);return x(s,a,o)}return x(n,a,o)}function Ot(t,n,i,e,r,a,o=n,s=i){var w,M,v;const c=n&&o,u=i&&s,m=p(e)?"coords"in e?e:e.geometry:null;if(g(m))return null;if(r){let f=nt(mt,m,n,i,t,r,o,s);return a&&(f=y(_,f,c,u,t,a)),((w=l[t])==null?void 0:w.call(l,f,c,u))??null}if(a){const f=y(_,m,n,i,t,a,o,s);return((M=l[t])==null?void 0:M.call(l,f,c,u))??null}return it(F,m,n,i,o,s),((v=l[t])==null?void 0:v.call(l,F,c,u))??null}async function At(t,n,i){const{outFields:e,orderByFields:r,groupByFieldsForStatistics:a,outStatistics:o}=t;if(e)for(let s=0;s<e.length;s++)e[s]=e[s].trim();if(r)for(let s=0;s<r.length;s++)r[s]=r[s].trim();if(a)for(let s=0;s<a.length;s++)a[s]=a[s].trim();if(o)for(let s=0;s<o.length;s++)o[s].onStatisticField&&(o[s].onStatisticField=o[s].onStatisticField.trim());return t.geometry&&!t.outSR&&(t.outSR=t.geometry.spatialReference),ut(t,n,i)}async function ut(t,n,i){var a;if(!t)return null;let{where:e}=t;if(t.where=e=e&&e.trim(),(!e||/^1 *= *1$/.test(e)||n&&n===e)&&(t.where=null),!t.geometry)return t;let r=await ft(t);if(t.distance=0,t.units=null,t.spatialRel==="esriSpatialRelEnvelopeIntersects"){const{spatialReference:o}=t.geometry;r=K(r),r.spatialReference=o}if(r){await G(r.spatialReference,i),r=ct(r,i);const o=(await Q(L(r)))[0];if(g(o))throw z;const s="quantizationParameters"in t&&((a=t.quantizationParameters)==null?void 0:a.tolerance)||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,c=s&&P(r,i)?{densificationStep:8*s}:void 0,u=o.toJSON(),m=await B(u,u.spatialReference,i,c);if(!m)throw z;m.spatialReference=i,t.geometry=m}return t}function P(t,n){if(!t)return!1;const i=t.spatialReference;return(A(t)||X(t)||H(t))&&!R(i,n)&&!C(i,n)}function ct(t,n){const i=t.spatialReference;return P(t,n)&&A(t)?{spatialReference:i,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}:t}async function ft(t){const{distance:n,units:i}=t,e=t.geometry;if(n==null||"vertexAttributes"in e)return e;const r=e.spatialReference,a=i?lt.fromJSON(i):D(r),o=r&&(tt(r)||S(r))?e:await G(r,b).then(()=>B(e,b));return(await ht())(o.spatialReference,o,n,a)}async function ht(){return(await q(()=>import("./geometryEngineJSON-a45b7108.js"),["./geometryEngineJSON-a45b7108.js","./geometryEngineBase-3dd302e0.js","./geometryEngineJSON-45c195fe.js","./json-48e3ea08.js"],import.meta.url)).geodesicBuffer}function Nt(t){return t&&k in t?JSON.parse(JSON.stringify(t,pt)):t}const k="_geVersion",pt=(t,n)=>t!==k?n:void 0;export{Nt as E,z as F,ut as J,zt as M,Ft as b,G as f,B as g,Ot as v,At as z};
