import{l as z}from"./Color-af6e0c66.js";import{a as P}from"./Error-57322e92.js";import{o as R}from"./fontUtils-4ed0e787.js";import{u as v,e as U}from"./screenUtils-90993e16.js";import{f as T,y as D,h as A}from"./utils-4469bf65.js";import{aR as x,aS as B,aT as $,aU as V}from"./index-40f88256.js";import"./colorUtils-639f4d25.js";import"./mathUtils-57aba1ea.js";import"./vec3-1863987c.js";import"./vec3f64-6cd30318.js";import"./common-c186b691.js";import"./vec4-46a9b36d.js";import"./typedArrayUtil-d9bc5fbd.js";import"./ensureType-25b8cc06.js";import"./string-480f3e3f.js";import"./preload-helper-41c905a7.js";import"./symbols-9fcb6cc2.js";import"./cast-a534ae90.js";import"./nextTick-3ee5a785.js";import"./promiseUtils-32d9c228.js";import"./CIMSymbol-72a9d286.js";import"./enumeration-61a13175.js";import"./jsonMap-190c5593.js";import"./Extent-a1a1de42.js";import"./fieldUtils-b2df74c4.js";import"./arcadeOnDemand-a976a73c.js";import"./geometry-eec1b371.js";import"./Polyline-b571c705.js";import"./typeUtils-cd52dc20.js";import"./Symbol-8266348e.js";import"./opacityUtils-1333f803.js";import"./symbolLayerUtils3D-c8c40895.js";import"./aaBoundingBox-4a83dbbc.js";import"./aaBoundingRect-b340cf8c.js";import"./request-24011425.js";import"./persistableUrlUtils-d0777bec.js";import"./Collection-7c37b74e.js";import"./Evented-cbf5f368.js";import"./SimpleObservable-8e532943.js";import"./collectionUtils-0365f48b.js";import"./Portal-c6e03126.js";import"./Loadable-46524a7e.js";import"./Promise-368b703a.js";import"./locale-30120714.js";import"./PortalGroup-d495847c.js";import"./PortalUser-1016c43c.js";import"./Clonable-9b34e760.js";import"./asyncUtils-087555fc.js";import"./BlendLayer-813950f9.js";import"./parser-01f6451e.js";import"./mat4f32-77b3d8ac.js";import"./mat4-7dde83b1.js";import"./assets-cd44347b.js";import"./ItemCache-bf1028d4.js";import"./MemCache-1d2f56ee.js";import"./utils-c81a5c52.js";import"./Basemap-59ed9516.js";import"./deprecate-0d93948c.js";import"./loadAll-01cdf0a9.js";import"./PortalItem-e4ba4b94.js";import"./messages-28bf3b89.js";import"./writeUtils-3bde6e49.js";import"./layerUtils-68eea656.js";import"./compilerUtils-fefa73ae.js";import"./CollectionFlattener-f43a0fce.js";import"./TablesMixin-55858fba.js";import"./Layer-cea228f0.js";import"./Identifiable-093f90a8.js";import"./Graphic-6c08e65d.js";import"./PopupTemplate-f97bb051.js";import"./number-2ab8ca0d.js";import"./jsonUtils-c6684c52.js";import"./Cyclical-078b4564.js";import"./reactiveUtils-5869e41a.js";import"./workers-af024c50.js";import"./Connection-b591250e.js";import"./Queue-275a6362.js";import"./intl-7d39a8c0.js";import"./projection-acd73147.js";import"./unitUtils-dd6fb8ee.js";import"./zscale-48bab05e.js";import"./TileInfo-c5c8c8d2.js";import"./widget-4abc68df.js";import"./uuid-73213768.js";import"./dom-5b7af1bf.js";import"./HandleOwner-2edbba46.js";import"./byteSizeEstimations-90c5a50d.js";import"./executeQueryJSON-29279a46.js";import"./normalizeUtils-0f537694.js";import"./query-b7b3a76b.js";import"./pbfQueryUtils-c922ef32.js";import"./pbf-8b0546e8.js";import"./OptimizedFeature-73582c6e.js";import"./OptimizedFeatureSet-1d1ac4b9.js";import"./queryZScale-3c8de33a.js";import"./FeatureSet-deb2029d.js";import"./Field-1d4f9ca4.js";import"./fieldType-b34e5d2d.js";import"./Query-13124a97.js";import"./TimeExtent-2004eecf.js";import"./RelationshipQuery-c27267ab.js";import"./LegendOptions-2e7b3d70.js";import"./jsonUtils-1c5cdf77.js";import"./UniqueValueRenderer-73d567ad.js";import"./diffUtils-8a8cb5bc.js";import"./colorRamps-8d7efc14.js";import"./sizeVariableUtils-d4870b0d.js";import"./lengthUtils-92fed992.js";import"./jsonUtils-8c02ff16.js";import"./styleUtils-391927cf.js";import"./DictionaryLoader-2a334243.js";import"./LRUCache-b9228ca3.js";import"./heatmapUtils-3d7c22c5.js";import"./vec4f64-939de194.js";import"./featureConversionUtils-d2229ed4.js";import"./TopFeaturesQuery-9aca00bf.js";import"./FeatureLayer-534ff006.js";import"./MultiOriginJSONSupport-b8792dfa.js";import"./LayerFloorInfo-f184c8f5.js";import"./FeatureLayerBase-c0aa3674.js";import"./HeightModelInfo-34f16d74.js";import"./arcgisLayerUrl-bed3cba1.js";import"./OperationalLayer-9c50475b.js";import"./ElevationInfo-80227ecc.js";import"./editsZScale-12d81957.js";import"./APIKeyMixin-b6e4f897.js";import"./ArcGISService-aada3b5d.js";import"./CustomParametersMixin-a5d06ccc.js";import"./EditBusLayer-b5dc3689.js";import"./FeatureReductionLayer-fcaeb34a.js";import"./labelingInfo-c70ad911.js";import"./labelUtils-4f4b54c6.js";import"./defaultsJSON-59981e75.js";import"./OrderedLayer-9623e905.js";import"./PortalLayer-12f4a535.js";import"./RefreshableLayer-49182ab8.js";import"./ScaleRangeLayer-c072e266.js";import"./TemporalLayer-c74d13d4.js";import"./TimeInfo-f76d6c20.js";import"./FeatureTemplate-c4496b93.js";import"./FeatureType-0be9420b.js";import"./fieldProperties-4207e953.js";import"./FieldsIndex-02142c8a.js";import"./versionUtils-fabd8b3a.js";import"./styleUtils-08eaa4d2.js";import"./popupUtils-1ecc877c.js";import"./colorUtils-82440b70.js";import"./mat2d-d0b91e3e.js";import"./Scheduler-5e6ccc87.js";import"./GraphicsLayer-b332f442.js";import"./ViewingMode-915d19cb.js";import"./unitBezier-881ac1eb.js";import"./vec2-ab9f47bf.js";import"./vec2f64-30dc1443.js";import"./mat3-9a8d9db7.js";import"./mat3f32-d3d088e8.js";import"./vec2f32-461e65a9.js";import"./TileStrategy-a5366189.js";import"./TileStore-8f580dbf.js";import"./TileKey-9cae9369.js";import"./rbush-8e36784a.js";import"./quickselect-322ec8e1.js";import"./capabilities-d08b6e58.js";import"./context-util-d4c193b5.js";import"./Subtype-a3103d84.js";import"./datetime-4f774298.js";import"./elevationInfoUtils-c3025fae.js";import"./QueryEngineResult-92e13fe4.js";import"./utils-52ad3c09.js";import"./generateRendererUtils-2f0b667c.js";import"./WhereClause-6c9440a1.js";import"./utils-44a68fd6.js";import"./json-48e3ea08.js";import"./Util-289ce3b5.js";import"./EffectView-dffeb0bc.js";import"./ExportImageParameters-ba01802d.js";import"./sublayerUtils-eea48c01.js";import"./webStyleSymbolUtils-0b165621.js";import"./devEnvironmentUtils-5002a058.js";import"./dehydratedFeatures-3dcd65f1.js";import"./enums-4b2a86a0.js";import"./plane-46a8c767.js";import"./sphere-622880b9.js";import"./quatf64-c94bd656.js";import"./mat4f64-fbeb2cd1.js";import"./quat-ec16a584.js";function W(o){let{r:i,g:t,b:r,a}=o;return a<1&&(i=Math.round(a*i+255*(1-a)),t=Math.round(a*t+255*(1-a)),r=Math.round(a*r+255*(1-a))),new z({r:i,g:t,b:r})}function F(o){const{r:i,g:t,b:r}=W(o);return .2126*i+.7152*t+.0722*r}const Z="picture-fill",H="picture-marker",G="simple-fill",I="simple-line",J="simple-marker",K="text",N="Aa",Q=x.size,k=x.maxSize,X=x.maxOutlineSize,Y=x.lineWidth,j=225,_=document.createElement("canvas");function q(o,i){const t=_.getContext("2d"),r=[];return i&&(i.weight&&r.push(i.weight),i.size&&r.push(i.size+"px"),i.family&&r.push(i.family)),t.font=r.join(" "),t.measureText(o).width}const ii=7.2/2.54,oi=72/2.54;function ti(o){if(o.length===0)return 0;if(o.length>2){const i=U(1),t=parseFloat(o);switch(o.slice(-2)){case"px":return t;case"pt":return t*i;case"in":return 72*t*i;case"pc":return 12*t*i;case"mm":return t*ii*i;case"cm":return t*oi*i}}return parseFloat(o)}function M(o){const i=o==null?void 0:o.size;return{width:i!=null&&typeof i=="object"&&"width"in i?v(i.width):null,height:i!=null&&typeof i=="object"&&"height"in i?v(i.height):null}}async function ri(o,i){const t=i.fill,r=o.color;if((t==null?void 0:t.type)==="pattern"&&r&&o.type!==Z){const a=await A(t.src,r.toCss(!0));t.src=a,i.fill=t}}async function mi(o,i,t,r){if(!("font"in o)||!o.font||i.shape.type!=="text")return;try{await R(o.font)}catch{}const{width:a}=M(r),u=/[\uE600-\uE6FF]/.test(i.shape.text);a!=null||u||(t[0]=q(i.shape.text,{weight:i.font.weight,size:i.font.size,family:i.font.family}))}function E(o,i){return o>i?"dark":"light"}function pi(o,i){var L;const t=typeof(i==null?void 0:i.size)=="number"?i==null?void 0:i.size:null,r=t!=null?v(t):null,a=(i==null?void 0:i.maxSize)!=null?v(i.maxSize):null,u=(i==null?void 0:i.rotation)!=null?i.rotation:"angle"in o?o.angle:null,y=T(o);let c=D(o);ei(o,245)!=="dark"||i!=null&&i.ignoreWhiteSymbols||(c={width:.75,...c,color:"#bdc3c7"});const s={shape:null,fill:y,stroke:c,offset:[0,0]};c!=null&&c.width&&(c.width=Math.min(c.width,X));const h=(c==null?void 0:c.width)||0;let g=(i==null?void 0:i.size)!=null&&((i==null?void 0:i.scale)==null||(i==null?void 0:i.scale)),m=0,p=0,b=!1;switch(o.type){case J:{const n=o.style,{width:l,height:e}=M(i),w=l===e&&l!=null?l:r??Math.min(v(o.size),a||k);switch(m=w,p=w,n){case"circle":s.shape={type:"circle",cx:0,cy:0,r:.5*w},g||(m+=h,p+=h);break;case"cross":s.shape={type:"path",path:[{command:"M",values:[0,.5*p]},{command:"L",values:[m,.5*p]},{command:"M",values:[.5*m,0]},{command:"L",values:[.5*m,p]}]};break;case"diamond":s.shape={type:"path",path:[{command:"M",values:[0,.5*p]},{command:"L",values:[.5*m,0]},{command:"L",values:[m,.5*p]},{command:"L",values:[.5*m,p]},{command:"Z",values:[]}]},g||(m+=h,p+=h);break;case"square":s.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,0]},{command:"L",values:[m,p]},{command:"L",values:[0,p]},{command:"Z",values:[]}]},g||(m+=h,p+=h),u&&(b=!0);break;case"triangle":s.shape={type:"path",path:[{command:"M",values:[.5*m,0]},{command:"L",values:[m,p]},{command:"L",values:[0,p]},{command:"Z",values:[]}]},g||(m+=h,p+=h),u&&(b=!0);break;case"x":s.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,p]},{command:"M",values:[m,0]},{command:"L",values:[0,p]}]},u&&(b=!0);break;case"path":s.shape={type:"path",path:o.path||""},g||(m+=h,p+=h),u&&(b=!0),g=!0}break}case I:{const{width:n,height:l}=M(i),e=l??r??h,w=n??Y;c&&(c.width=e),m=w,p=e;const f=((L=s==null?void 0:s.stroke)==null?void 0:L.cap)||"butt",d=f==="round";g=!0,s.stroke&&(s.stroke.cap=f==="butt"?"square":f),s.shape={type:"path",path:[{command:"M",values:[d?e/2:0,p/2]},{command:"L",values:[d?m-e/2:m,p/2]}]};break}case Z:case G:{const n=typeof(i==null?void 0:i.symbolConfig)=="object"&&(i==null?void 0:i.symbolConfig.isSquareFill),{width:l,height:e}=M(i);m=!n&&l!==e||l==null?r??Q:l,p=!n&&l!==e||e==null?m:e,g||(m+=h,p+=h),g=!0,s.shape=n?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,0]},{command:"L",values:[m,p]},{command:"L",values:[0,p]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:B.fill[0];break}case H:{const n=Math.min(v(o.width),a||k),l=Math.min(v(o.height),a||k),{width:e,height:w}=M(i),f=e===w&&e!=null?e:r??Math.max(n,l),d=n/l;m=d<=1?Math.ceil(f*d):f,p=d<=1?f:Math.ceil(f/d),s.shape={type:"image",x:-Math.round(m/2),y:-Math.round(p/2),width:m,height:p,src:o.url||""},u&&(b=!0);break}case K:{const n=o,l=(i==null?void 0:i.overrideText)||n.text||N,e=n.font,{width:w,height:f}=M(i),d=f??r??Math.min(v(e.size),a||k),O=q(l,{weight:e.weight,size:d,family:e.family}),S=/[\uE600-\uE6FF]/.test(l);m=w??(S?d:O),p=d;let C=.25*ti((e?d:0).toString());S&&(C+=5),s.shape={type:"text",text:l,x:n.xoffset||0,y:n.yoffset||C,align:"middle",alignBaseline:n.verticalAlignment,decoration:e&&e.decoration,rotated:n.rotated,kerning:n.kerning},s.font=e&&{size:d,style:e.style,decoration:e.decoration,weight:e.weight,family:e.family};break}}return{shapeDescriptor:s,size:[m,p],renderOptions:{node:i==null?void 0:i.node,scale:g,opacity:i==null?void 0:i.opacity,rotation:u,useRotationSize:b,effectView:i==null?void 0:i.effectView}}}async function Tr(o,i){const{shapeDescriptor:t,size:r,renderOptions:a}=pi(o,i);if(!t.shape)throw new P("symbolPreview: renderPreviewHTML2D","symbol not supported.");await ri(o,t),await mi(o,t,r,i);const u=[[t]];if(typeof(i==null?void 0:i.symbolConfig)=="object"&&(i!=null&&i.symbolConfig.applyColorModulation)){const y=.6*r[0];u.unshift([{...t,offset:[-y,0],fill:$(t.fill,-.3)}]),u.push([{...t,offset:[y,0],fill:$(t.fill,.3)}]),r[0]+=2*y,a.scale=!1}return V(u,r,a)}function ei(o,i=j){const t=T(o),r=D(o),a=!t||"type"in t?null:new z(t),u=r!=null&&r.color?new z(r==null?void 0:r.color):null,y=a?E(F(a),i):null,c=u?E(F(u),i):null;return c?y?y===c?y:i>=j?"light":"dark":c:y}export{ei as getContrastingBackgroundTheme,pi as getRenderSymbolParameters,Tr as previewSymbol2D};
