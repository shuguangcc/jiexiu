import{_ as N}from"./preload-helper-41c905a7.js";import{i as _}from"./multiOriginJSONSupportUtils-c978f4c3.js";import{k as v,K as O,V as h,G as R}from"./request-24011425.js";import{n as z}from"./uuid-73213768.js";import{q as S,W as $,C as F}from"./cast-a534ae90.js";import{p as k,m as y,R as A,U as B,d as E,x as J}from"./persistableUrlUtils-d0777bec.js";function f(e){return d[K(e)]||V}function K(e){return e instanceof Blob?e.type:T(e.url)}function T(e){const r=v(e);return g[r]||x}const d={},x="text/plain",V=d[x],g={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const e in g)d[g[e]]=e;function te(e){const r=(e==null?void 0:e.origins)??[void 0];return(o,i)=>{const n=q(e,o,i);for(const s of r){const a=S(o,s,i);for(const t in n)a[t]=n[t]}}}function q(e,r,o){if((e==null?void 0:e.type)==="resource")return C(e,r,o);switch((e==null?void 0:e.type)??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:i,write:n}=J;return{read:i,write:n}}}}function C(e,r,o){const i=$(r,o);return{type:String,read:(n,s,a)=>{const t=k(n,s,a);return i.type===String?t:typeof i.type=="function"?new i.type({url:t}):void 0},write:{writer(n,s,a,t){if(!t||!t.resources)return typeof n=="string"?void(s[a]=y(n,t)):void(s[a]=n.write({},t));const m=W(n),p=y(m,{...t,verifyItemRelativeUrls:t&&t.verifyItemRelativeUrls?{writtenUrls:t.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},A.NO),u=i.type!==String&&(!_(this)||t&&t.origin&&this.originIdOf(o)>F(t.origin)),c={object:this,propertyName:o,value:n,targetUrl:p,dest:s,targetPropertyName:a,context:t,params:e};t&&t.portalItem&&p&&!O(p)?u?D(c):G(c):t&&t.portalItem&&(p==null||B(p)!=null||h(p)||u)?U(c):s[a]=p}}}}function U(e){const{targetUrl:r,params:o,value:i,context:n,dest:s,targetPropertyName:a}=e;if(!n.portalItem)return;const t=E(r),m=(t==null?void 0:t.filename)??z(),p=(o==null?void 0:o.prefix)??(t==null?void 0:t.prefix),u=I(i,r,n),c=R(p,m),b=`${c}.${f(u)}`,l=n.portalItem.resourceFromPath(b);h(r)&&n.resources&&n.resources.pendingOperations.push(L(r).then(j=>{l.path=`${c}.${f(j)}`,s[a]=l.itemRelativeUrl}).catch(()=>{}));const P=(o==null?void 0:o.compress)??!1;n.resources&&w({...e,resource:l,content:u,compress:P,updates:n.resources.toAdd}),s[a]=l.itemRelativeUrl}function D(e){const{context:r,targetUrl:o,params:i,value:n,dest:s,targetPropertyName:a}=e;if(!r.portalItem)return;const t=r.portalItem.resourceFromPath(o),m=I(n,o,r),p=f(m),u=v(t.path),c=(i==null?void 0:i.compress)??!1;p===u?(r.resources&&w({...e,resource:t,content:m,compress:c,updates:r.resources.toUpdate}),s[a]=o):U(e)}function G({context:e,targetUrl:r,dest:o,targetPropertyName:i}){e.portalItem&&e.resources&&(e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(r),compress:!1}),o[i]=r)}function w({object:e,propertyName:r,updates:o,resource:i,content:n,compress:s}){o.push({resource:i,content:n,compress:s,finish:a=>{H(e,r,a)}})}function I(e,r,o){return typeof e=="string"?{url:r}:new Blob([JSON.stringify(e.toJSON(o))],{type:"application/json"})}async function L(e){const r=(await N(()=>import("./request-24011425.js").then(i=>i.w),["./request-24011425.js","./preload-helper-41c905a7.js","./Error-57322e92.js","./string-480f3e3f.js","./typedArrayUtil-d9bc5fbd.js","./promiseUtils-32d9c228.js"],import.meta.url)).default,{data:o}=await r(e,{responseType:"blob"});return o}function W(e){return e==null?null:typeof e=="string"?e:e.url}function H(e,r,o){typeof e[r]=="string"?e[r]=o.url:e[r].url=o.url}export{te as g};
