import{g as Gt}from"./Graphic-6c08e65d.js";import{r as c,t as Z}from"./typedArrayUtil-d9bc5fbd.js";import{w as L,p as Bt,a as it}from"./Extent-a1a1de42.js";import{_ as H}from"./preload-helper-41c905a7.js";import{e as A,y as F,n as Zt}from"./cast-a534ae90.js";import{s as x,a as st}from"./Error-57322e92.js";import{a as Vt}from"./HandleOwner-2edbba46.js";import{m as Jt}from"./Loadable-46524a7e.js";import{m as Wt}from"./Promise-368b703a.js";import{y as pt,L as Xt,p as Yt,f as Ht}from"./promiseUtils-32d9c228.js";import{l as qt}from"./reactiveUtils-5869e41a.js";import"./ensureType-25b8cc06.js";import{n as y,f as Pt,r as nt}from"./vec3f64-6cd30318.js";import{v as Kt}from"./Polyline-b571c705.js";import{a as J,v as at,g as lt,x as Qt,k as Y}from"./axisAngleDegrees-700f0205.js";import{g as G,p as q}from"./MeshComponent-da2d633e.js";import{r as rt,b as te,x as ee,_ as re,L as K}from"./georeference-553d20c3.js";import{o as ne}from"./triangulationUtils-6b510de4.js";import{k as _,Z as Et}from"./projection-acd73147.js";import{O as oe,_ as ie}from"./request-24011425.js";import{a as It}from"./mat3-9a8d9db7.js";import{a as ft}from"./quatf64-c94bd656.js";import{e as _t}from"./mat4f64-fbeb2cd1.js";import{u as ut,S as Q,z as se,o as Ct,e as tt,O as ae,g as zt}from"./vec3-1863987c.js";import{c as mt}from"./unitUtils-dd6fb8ee.js";import{M as ht,j as gt,k as dt,O as xt,h as yt,L as wt}from"./projection-9ba51a79.js";import{g as le}from"./mat4-7dde83b1.js";import ce from"./FeatureSet-deb2029d.js";import"./geometry-eec1b371.js";import"./typeUtils-cd52dc20.js";import"./jsonMap-190c5593.js";import"./string-480f3e3f.js";import"./PopupTemplate-f97bb051.js";import"./Clonable-9b34e760.js";import"./Collection-7c37b74e.js";import"./Evented-cbf5f368.js";import"./SimpleObservable-8e532943.js";import"./fieldUtils-b2df74c4.js";import"./arcadeOnDemand-a976a73c.js";import"./enumeration-61a13175.js";import"./number-2ab8ca0d.js";import"./locale-30120714.js";import"./Identifiable-093f90a8.js";import"./symbols-9fcb6cc2.js";import"./CIMSymbol-72a9d286.js";import"./Symbol-8266348e.js";import"./Color-af6e0c66.js";import"./colorUtils-639f4d25.js";import"./mathUtils-57aba1ea.js";import"./vec4-46a9b36d.js";import"./common-c186b691.js";import"./screenUtils-90993e16.js";import"./opacityUtils-1333f803.js";import"./symbolLayerUtils3D-c8c40895.js";import"./aaBoundingBox-4a83dbbc.js";import"./aaBoundingRect-b340cf8c.js";import"./persistableUrlUtils-d0777bec.js";import"./collectionUtils-0365f48b.js";import"./Portal-c6e03126.js";import"./PortalGroup-d495847c.js";import"./PortalUser-1016c43c.js";import"./nextTick-3ee5a785.js";import"./jsonUtils-c6684c52.js";import"./quat-ec16a584.js";import"./imageUtils-c2d0d1ae.js";import"./BufferView-478024d2.js";import"./vec2-ab9f47bf.js";import"./vec33-ec7b196f.js";import"./earcut-58237617.js";import"./deduplicate-d92c3cc2.js";import"./assets-cd44347b.js";import"./zscale-48bab05e.js";import"./Field-1d4f9ca4.js";import"./fieldType-b34e5d2d.js";const ct=x.getLogger("esri.geometry.support.meshUtils.centerAt");function pe(t,r,e){if(!t.vertexAttributes||!t.vertexAttributes.position)return;const n=(e==null?void 0:e.origin)??t.origin;c(t.transform)?((e==null?void 0:e.geographic)!=null&&e.geographic!==t.transform.geographic&&ct.warn(`Specifying the 'geographic' parameter (${e.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`),fe(t.transform,r,n)):rt(t.spatialReference,e)?ue(t,r,n):me(t,r,n)}function fe(t,r,e){const n=r.x-e.x,o=r.y-e.y,s=r.hasZ&&e.hasZ?r.z-e.z:0,i=t.origin;t.origin=[i[0]+n,i[1]+o,i[2]+s]}function ue(t,r,e){const n=te(t.vertexAttributes,e,{geographic:!0}),{position:o,normal:s,tangent:i}=ee(n,r,{geographic:!0});t.vertexAttributes.position=o,t.vertexAttributes.normal=s,t.vertexAttributes.tangent=i,t.vertexAttributesChanged()}function me(t,r,e){const n=de,o=ge;if(_(r,o,t.spatialReference)){if(!_(e,n,t.spatialReference)){const s=t.origin;n[0]=s.x,n[1]=s.y,n[2]=s.z,ct.error(`Failed to project specified origin (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}).`)}he(t.vertexAttributes.position,o,n),t.vertexAttributesChanged()}else ct.error(`Failed to project centerAt location (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid})`)}function he(t,r,e){if(t)for(let n=0;n<t.length;n+=3)for(let o=0;o<3;o++)t[n+o]+=r[o]-e[o]}const ge=y(),de=y();async function xe(t,r,e){const{loadGLTFMesh:n}=await pt(H(()=>import("./loadGLTFMesh-b826c13a.js"),["./loadGLTFMesh-b826c13a.js","./Color-af6e0c66.js","./colorUtils-639f4d25.js","./mathUtils-57aba1ea.js","./vec3-1863987c.js","./vec3f64-6cd30318.js","./common-c186b691.js","./vec4-46a9b36d.js","./typedArrayUtil-d9bc5fbd.js","./ensureType-25b8cc06.js","./string-480f3e3f.js","./Error-57322e92.js","./request-24011425.js","./preload-helper-41c905a7.js","./promiseUtils-32d9c228.js","./mat3-9a8d9db7.js","./quatf64-c94bd656.js","./vec4f64-939de194.js","./MeshComponent-da2d633e.js","./cast-a534ae90.js","./nextTick-3ee5a785.js","./imageUtils-c2d0d1ae.js","./Extent-a1a1de42.js","./persistableUrlUtils-d0777bec.js","./BufferView-478024d2.js","./vec2-ab9f47bf.js","./vec33-ec7b196f.js","./DefaultMaterial_COLOR_GAMMA-ccf18a3a.js","./types-e1c0a5bf.js","./asyncUtils-087555fc.js","./mat4f64-fbeb2cd1.js","./enums-64ab819c.js","./Version-b16872d5.js","./mat4-7dde83b1.js","./quat-ec16a584.js","./compilerUtils-fefa73ae.js","./Indices-d9b791ce.js","./georeference-553d20c3.js","./unitUtils-dd6fb8ee.js","./jsonMap-190c5593.js","./projection-acd73147.js","./SimpleObservable-8e532943.js","./Polyline-b571c705.js","./assets-cd44347b.js","./aaBoundingRect-b340cf8c.js","./zscale-48bab05e.js","./axisAngleDegrees-700f0205.js","./projection-9ba51a79.js"],import.meta.url),e),o=await kt(r,e),s=n(new L({x:0,y:0,z:0,spatialReference:t.spatialReference}),o.url,{resolveFile:ye(o),useTransform:!0,signal:c(e)?e.signal:null});s.then(()=>o.dispose(),()=>o.dispose());const{vertexAttributes:i,components:a}=await s;t.vertexAttributes=i,t.components=a}function ye(t){const r=oe(t.url);return e=>{const n=ie(e,r,r),o=n?n.replace(/^ *\.\//,""):null;return(o?t.files.get(o):null)??e}}async function kt(t,r){return t instanceof Blob?V.fromBlob(t):typeof t=="string"?new V(t):Array.isArray(t)?we(t,r):ve(t,r)}async function we(t,r){const e=new Map;let n=null;const o=await Xt(t.map(async i=>({name:i.name,source:await kt(i instanceof Blob?i:i.source,r)}))),s=[];for(const i of o)i&&(Yt(r)?i.source.dispose():s.push(i));Ht(r);for(const{name:i,source:a}of s)(Z(n)||/\.(gltf|glb)/i.test(i))&&(n=a.url),e.set(i,a.url),a.files&&a.files.forEach((l,f)=>e.set(f,l));if(Z(n))throw new st("mesh-load-external:missing-files","Missing files to load external mesh source");return new V(n,()=>s.forEach(({source:i})=>i.dispose()),e)}async function ve(t,r){const{default:e}=await pt(H(()=>import("./request-24011425.js").then(o=>o.w),["./request-24011425.js","./preload-helper-41c905a7.js","./Error-57322e92.js","./string-480f3e3f.js","./typedArrayUtil-d9bc5fbd.js","./promiseUtils-32d9c228.js"],import.meta.url),r),n=typeof t.multipart[0]=="string"?await Promise.all(t.multipart.map(async o=>(await e(o,{responseType:"array-buffer"})).data)):t.multipart;return V.fromBlob(new Blob(n))}let V=class{constructor(r,e=()=>{},n=new Map){this.url=r,this.dispose=e,this.files=n}static fromBlob(r){const e=URL.createObjectURL(r);return new V(e,()=>URL.revokeObjectURL(e))}};function be(t,r,e){t.vertexAttributes&&t.vertexAttributes.position&&(c(t.transform)?((e==null?void 0:e.geographic)!=null&&e.geographic!==t.transform.geographic&&x.getLogger("esri.geometry.support.meshUtils.offset").warn(`Specifying the 'geographic' parameter (${e.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`),Ae(t.transform,r)):rt(t.spatialReference,e)?$e(t,r):Re(t,r))}function Ae(t,r){const e=t.origin;t.origin=ut(y(),e,r)}function $e(t,r){const e=t.spatialReference,n=t.vertexAttributes.position,o=t.vertexAttributes.normal,s=t.vertexAttributes.tangent,i=new Float64Array(n.length),a=c(o)?new Float32Array(o.length):null,l=c(s)?new Float32Array(s.length):null,f=t.extent.center,p=Fe;Et(e,[f.x,f.y,f.z],vt,mt(e)),It(bt,vt),Q(p,r,bt),ht(n,e,i),c(o)&&c(a)&&gt(o,n,i,e,a),c(s)&&c(l)&&dt(s,n,i,e,l),St(i,p),xt(i,n,e),c(o)&&c(a)&&yt(a,n,i,e,o),c(s)&&c(l)&&wt(l,n,i,e,s),t.vertexAttributesChanged()}function Re(t,r){St(t.vertexAttributes.position,r),t.vertexAttributesChanged()}function St(t,r){if(t)for(let e=0;e<t.length;e+=3)for(let n=0;n<3;n++)t[e+n]+=r[n]}const Fe=y(),vt=_t(),bt=ft();function Me(){const{faceDescriptions:t,faceVertexOffsets:r,uvScales:e}=ze,n=4*t.length,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(2*t.length*3);let l=0,f=0,p=0,m=0;for(let h=0;h<t.length;h++){const u=t[h],v=l/3;for(const d of r)a[m++]=v+d;const O=u.corners;for(let d=0;d<4;d++){const $=O[d];let b=0;i[p++]=.25*e[d][0]+u.uvOrigin[0],i[p++]=u.uvOrigin[1]-.25*e[d][1];for(let R=0;R<3;R++)u.axis[R]!==0?(o[l++]=.5*u.axis[R],s[f++]=u.axis[R]):(o[l++]=.5*$[b++],s[f++]=0)}}return{position:o,normal:s,uv:i,faces:a}}function Le(t,r){const e=t.components[0],n=e.faces,o=ke[r],s=6*o,i=new Array(6),a=new Array(n.length-6);let l=0,f=0;for(let p=0;p<n.length;p++)p>=s&&p<s+6?i[l++]=n[p]:a[f++]=n[p];if(c(t.vertexAttributes.uv)){const p=new Float32Array(t.vertexAttributes.uv),m=4*o*2,h=[0,1,1,1,1,0,0,0];for(let u=0;u<h.length;u++)p[m+u]=h[u];t.vertexAttributes.uv=p}return t.components=[new G({faces:i,material:e.material}),new G({faces:a})],t}function Oe(t=0){const r=Math.round(8*2**t),e=2*r,n=(r-1)*(e+1)+2*e,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(3*((r-1)*e*2));let l=0,f=0,p=0,m=0;for(let h=0;h<=r;h++){const u=h/r*Math.PI+.5*Math.PI,v=Math.cos(u),O=Math.sin(u);g[2]=O;const d=h===0||h===r,$=d?e-1:e;for(let b=0;b<=$;b++){const R=b/$*2*Math.PI;g[0]=-Math.sin(R)*v,g[1]=Math.cos(R)*v;for(let P=0;P<3;P++)o[l]=.5*g[P],s[l]=g[P],++l;i[f++]=(b+(d?.5:0))/e,i[f++]=h/r,h!==0&&b!==e&&(h!==r&&(a[p++]=m,a[p++]=m+1,a[p++]=m-e),h!==1&&(a[p++]=m,a[p++]=m-e,a[p++]=m-e-1)),m++}}return{position:o,normal:s,uv:i,faces:a}}function Pe(t=0){const e=Math.round(16*2**t),n=(5-1)*(e+1)+2*e,o=new Float64Array(3*n),s=new Float32Array(3*n),i=new Float32Array(2*n),a=new Uint32Array(3*(4*e));let l=0,f=0,p=0,m=0,h=0;for(let u=0;u<=5;u++){const v=u===0||u===5,O=u<=1||u>=5-1,d=u===2||u===4,$=v?e-1:e;for(let b=0;b<=$;b++){const R=b/$*2*Math.PI,P=v?0:.5;g[0]=P*Math.sin(R),g[1]=P*-Math.cos(R),g[2]=u<=2?.5:-.5;for(let z=0;z<3;z++)o[l++]=g[z],s[f++]=O?z===2?u<=1?1:-1:0:z===2?0:g[z]/P;i[p++]=(b+(v?.5:0))/e,i[p++]=u<=1?1*u/3:u<=3?1*(u-2)/3+1/3:1*(u-4)/3+2/3,d||u===0||b===e||(u!==5&&(a[m++]=h,a[m++]=h+1,a[m++]=h-e),u!==1&&(a[m++]=h,a[m++]=h-e,a[m++]=h-e-1)),h++}}return{position:o,normal:s,uv:i,faces:a}}function Ee(t,r){const e=typeof r=="number"?r:r!=null?r.width:1,n=typeof r=="number"?r:r!=null?r.height:1;switch(t){case"up":case"down":return{width:e,depth:n};case"north":case"south":return{width:e,height:n};case"east":case"west":return{depth:e,height:n}}}function Ie(t){const r=B.facingAxisOrderSwap[t],e=B.position,n=B.normal,o=new Float64Array(e.length),s=new Float32Array(n.length);let i=0;for(let a=0;a<4;a++){const l=i;for(let f=0;f<3;f++){const p=r[f],m=Math.abs(p)-1,h=p>=0?1:-1;o[i]=e[l+m]*h,s[i]=n[l+m]*h,i++}}return{position:o,normal:s,uv:new Float32Array(B.uv),faces:new Uint32Array(B.faces),isPlane:!0}}const k=1,S=2,D=3,B={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[D,k,S],west:[-D,-k,S],north:[-k,D,S],south:[k,-D,S],up:[k,S,D],down:[k,-S,-D]}};function W(t,r,e){t.isPlane||_e(t),Ce(t,e==null?void 0:e.size);const{vertexAttributes:n,transform:o}=re(t,r,e);return{vertexAttributes:new q({...n,uv:t.uv}),transform:o,components:[new G({faces:t.faces,material:e&&e.material||null})],spatialReference:r.spatialReference}}function _e(t){for(let r=0;r<t.position.length;r+=3)t.position[r+2]+=.5}function Ce(t,r){if(r==null)return;const e=typeof r=="number"?[r,r,r]:[r.width!=null?r.width:1,r.depth!=null?r.depth:1,r.height!=null?r.height:1];E[0]=e[0],E[4]=e[1],E[8]=e[2];for(let n=0;n<t.position.length;n+=3){for(let o=0;o<3;o++)g[o]=t.position[n+o];Q(g,g,E);for(let o=0;o<3;o++)t.position[n+o]=g[o]}if(e[0]!==e[1]||e[1]!==e[2]){E[0]=1/e[0],E[4]=1/e[1],E[8]=1/e[2];for(let n=0;n<t.normal.length;n+=3){for(let o=0;o<3;o++)g[o]=t.normal[n+o];Q(g,g,E),se(g,g);for(let o=0;o<3;o++)t.normal[n+o]=g[o]}}}const ze={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},ke={south:0,east:1,north:2,west:3,up:4,down:5},g=y(),E=ft(),Dt=x.getLogger("esri.geometry.support.meshUtils.rotate");function Se(t,r,e){if(!t.vertexAttributes||!t.vertexAttributes.position||r[3]===0)return;const n=t.spatialReference;if(c(t.transform)){(e==null?void 0:e.geographic)!=null&&e.geographic!==t.transform.geographic&&Dt.warn(`Specifying the 'geographic' parameter (${e.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`);const o=(e==null?void 0:e.origin)??t.transform.getOriginPoint(n);De(t.transform,r,o)}else{const o=(e==null?void 0:e.origin)??t.origin;rt(t.spatialReference,e)?Te(t,r,o):je(t,r,o)}}function De(t,r,e){const n=Ct(j,e.x,e.y,e.z),o=tt(j,n,t.origin);t.applyLocalInverse(o,At),t.rotation=at(t.rotation,r,J()),t.applyLocalInverse(o,o),tt(o,o,At),t.translation=ut(y(),t.translation,o)}function Te(t,r,e){const n=t.spatialReference,o=mt(n),s=Tt;_(e,s,o)||_(t.origin,s,o);const i=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,f=new Float64Array(i.length),p=c(a)?new Float32Array(a.length):null,m=c(l)?new Float32Array(l.length):null;Et(o,s,et,o),It(Rt,et);const h=$t;Q(lt($t),lt(r),Rt),h[3]=r[3],ht(i,n,f),c(a)&&c(p)&&gt(a,i,f,n,p),c(l)&&c(m)&&dt(l,i,f,n,m),U(f,h,3,s),xt(f,i,n),c(a)&&c(p)&&(U(p,h,3),yt(p,i,f,n,a)),c(l)&&c(m)&&(U(m,h,4),wt(m,i,f,n,l)),t.vertexAttributesChanged()}function je(t,r,e){const n=Tt;if(!_(e,n,t.spatialReference)){const o=t.origin;n[0]=o.x,n[1]=o.y,n[2]=o.z,Dt.error(`Failed to project specified origin (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}).`)}U(t.vertexAttributes.position,r,3,n),U(t.vertexAttributes.normal,r,3),U(t.vertexAttributes.tangent,r,4),t.vertexAttributesChanged()}function U(t,r,e,n=Pt){if(!Z(t)){le(et,Qt(r),lt(r));for(let o=0;o<t.length;o+=e){for(let s=0;s<3;s++)j[s]=t[o+s]-n[s];ae(j,j,et);for(let s=0;s<3;s++)t[o+s]=j[s]+n[s]}}}const j=y(),At=y(),$t=J(),et=_t(),Rt=ft(),Tt=y(),jt=x.getLogger("esri.geometry.support.meshUtils.scale");function Ne(t,r,e){if(!t.vertexAttributes||!t.vertexAttributes.position)return;const n=t.spatialReference;if(c(t.transform)){(e==null?void 0:e.geographic)!=null&&e.geographic!==t.transform.geographic&&jt.warn(`Specifying the 'geographic' parameter (${e.geographic}) different from the Mesh transform setting (${t.transform.geographic}) is not supported`);const o=(e==null?void 0:e.origin)??t.transform.getOriginPoint(n);Ue(t.transform,r,o)}else{const o=rt(t.spatialReference,e),s=e&&e.origin||t.origin;o?Ge(t,r,s):Be(t,r,s)}}function Ue(t,r,e){const n=Ct(N,e.x,e.y,e.z),o=tt(N,n,t.origin);t.applyLocalInverse(o,Ft);const s=zt(y(),t.scale,r);t.scale=s,t.applyLocalInverse(o,o),tt(o,o,Ft),t.translation=ut(y(),t.translation,o)}function Ge(t,r,e){const n=t.spatialReference,o=mt(n),s=Ut;_(e,s,o)||_(t.origin,s,o);const i=t.vertexAttributes.position,a=t.vertexAttributes.normal,l=t.vertexAttributes.tangent,f=new Float64Array(i.length),p=c(a)?new Float32Array(a.length):null,m=c(l)?new Float32Array(l.length):null;ht(i,n,f),c(a)&&c(p)&&gt(a,i,f,n,p),c(l)&&c(m)&&dt(l,i,f,n,m),Nt(f,r,s),xt(f,i,n),c(a)&&c(p)&&yt(p,i,f,n,a),c(l)&&c(m)&&wt(m,i,f,n,l),t.vertexAttributesChanged()}function Be(t,r,e){const n=Ut;if(!_(e,n,t.spatialReference)){const o=t.origin;n[0]=o.x,n[1]=o.y,n[2]=o.z,jt.error(`Failed to project specified origin (wkid:${e.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}).`)}Nt(t.vertexAttributes.position,r,n),t.vertexAttributesChanged()}function Nt(t,r,e=Pt){if(t)for(let n=0;n<t.length;n+=3){for(let o=0;o<3;o++)N[o]=t[n+o]-e[o];zt(N,N,r);for(let o=0;o<3;o++)t[n+o]=N[o]+e[o]}}const N=y(),Ft=y(),Ut=y();var M;const C="esri.geometry.Mesh";let w=M=class extends Vt(Jt.LoadableMixin(Wt(Bt))){constructor(t){super(t),this.components=null,this.transform=null,this.external=null,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new q,this.type="mesh"}initialize(){(Z(this.external)||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.handles.add(qt(()=>{var t;return{vertexAttributes:this.vertexAttributes,components:(t=this.components)==null?void 0:t.map(r=>r.clone())}},()=>this._set("external",null),{once:!0,sync:!0}))})}get hasExtent(){return!this.loaded&&c(this.external)&&c(this.external.extent)||this.loaded&&this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0)}get _boundingInfo(){const t=this.vertexAttributes.position,r=this.spatialReference;if(t.length===0||this.components&&this.components.length===0)return{extent:new it({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:r}),center:new L({x:0,y:0,z:0,spatialReference:r})};const e=c(this.transform)?this.transform.project(t,r):t;let n=1/0,o=1/0,s=1/0,i=-1/0,a=-1/0,l=-1/0,f=0,p=0,m=0;const h=e.length,u=1/(h/3);let v=0;for(;v<h;){const O=e[v++],d=e[v++],$=e[v++];n=Math.min(n,O),o=Math.min(o,d),s=Math.min(s,$),i=Math.max(i,O),a=Math.max(a,d),l=Math.max(l,$),f+=u*O,p+=u*d,m+=u*$}return{extent:new it({xmin:n,ymin:o,zmin:s,xmax:i,ymax:a,zmax:l,spatialReference:r}),center:new L({x:f,y:p,z:m,spatialReference:r})}}get anchor(){if(c(this.transform))return this.transform.getOriginPoint(this.spatialReference);const t=this._boundingInfo;return new L({x:t.center.x,y:t.center.y,z:t.extent.zmin,spatialReference:this.spatialReference})}get origin(){return c(this.transform)?this.transform.getOriginPoint(this.spatialReference):this._boundingInfo.center}get extent(){return!this.loaded&&c(this.external)&&c(this.external.extent)?this.external.extent.clone():this._boundingInfo.extent}addComponent(t){this.loaded?(this.components||(this.components=[]),this.components.push(G.from(t)),this.notifyChange("components")):x.getLogger(this.declaredClass).error("addComponent()","Mesh must be loaded before applying operations")}removeComponent(t){if(this.loaded){if(this.components){const r=this.components.indexOf(t);if(r!==-1)return this.components.splice(r,1),void this.notifyChange("components")}x.getLogger(this.declaredClass).error("removeComponent()","Provided component is not part of the list of components")}else x.getLogger(this.declaredClass).error("removeComponent()","Mesh must be loaded before applying operations")}rotate(t,r,e,n){return Y(ot.x,t,T),Y(ot.y,r,Mt),Y(ot.z,e,Lt),at(T,Mt,T),at(T,Lt,T),Se(this,T,n),this}offset(t,r,e,n){return this.loaded?(X[0]=t,X[1]=r,X[2]=e,be(this,X,n),this):(x.getLogger(this.declaredClass).error("offset()","Mesh must be loaded before applying operations"),this)}scale(t,r){return this.loaded?(Ne(this,t,r),this):(x.getLogger(this.declaredClass).error("scale()","Mesh must be loaded before applying operations"),this)}centerAt(t,r){return this.loaded?(pe(this,t,r),this):(x.getLogger(this.declaredClass).error("centerAt()","Mesh must be loaded before applying operations"),this)}load(t){return c(this.external)&&this.addResolvingPromise(xe(this,this.external.source,t)),Promise.resolve(this)}updateExternalSource(t){this._set("external",t)}clone(){let t=null;if(this.components){const e=new Map,n=new Map;t=this.components.map(o=>o.cloneWithDeduplication(e,n))}const r={components:t,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),transform:c(this.transform)?this.transform.clone():null,external:c(this.external)?{source:this.external.source,extent:c(this.external.extent)?this.external.extent.clone():null}:null};return new M(r)}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(t){const r=H(()=>import("./gltfexport-4fc12d00.js"),["./gltfexport-4fc12d00.js","./request-24011425.js","./preload-helper-41c905a7.js","./Error-57322e92.js","./string-480f3e3f.js","./typedArrayUtil-d9bc5fbd.js","./promiseUtils-32d9c228.js","./Extent-a1a1de42.js","./cast-a534ae90.js","./ensureType-25b8cc06.js","./nextTick-3ee5a785.js","./quat-ec16a584.js","./quatf64-c94bd656.js","./vec3f64-6cd30318.js","./common-c186b691.js","./vec3-1863987c.js","./vec4-46a9b36d.js","./MeshComponent-da2d633e.js","./Color-af6e0c66.js","./colorUtils-639f4d25.js","./mathUtils-57aba1ea.js","./imageUtils-c2d0d1ae.js","./persistableUrlUtils-d0777bec.js","./georeference-553d20c3.js","./unitUtils-dd6fb8ee.js","./jsonMap-190c5593.js","./mat4-7dde83b1.js","./mat4f64-fbeb2cd1.js","./mat3-9a8d9db7.js","./projection-acd73147.js","./SimpleObservable-8e532943.js","./Polyline-b571c705.js","./assets-cd44347b.js","./aaBoundingRect-b340cf8c.js","./zscale-48bab05e.js","./axisAngleDegrees-700f0205.js","./BufferView-478024d2.js","./vec2-ab9f47bf.js","./vec33-ec7b196f.js","./projection-9ba51a79.js","./enums-64ab819c.js","./imageutils-0a369a69.js"],import.meta.url),e=this.load(),n=await Promise.all([r,e]),{toBinaryGLTF:o}=n[0];return o(this,t)}static createBox(t,r){if(!(t instanceof L))return x.getLogger(C).error(".createBox()","expected location to be a Point instance"),null;const e=new M(W(Me(),t,r));return r&&r.imageFace&&r.imageFace!=="all"?Le(e,r.imageFace):e}static createSphere(t,r){return t instanceof L?new M(W(Oe(r&&r.densificationFactor||0),t,r)):(x.getLogger(C).error(".createSphere()","expected location to be a Point instance"),null)}static createCylinder(t,r){return t instanceof L?new M(W(Pe(r&&r.densificationFactor||0),t,r)):(x.getLogger(C).error(".createCylinder()","expected location to be a Point instance"),null)}static createPlane(t,r){if(!(t instanceof L))return x.getLogger(C).error(".createPlane()","expected location to be a Point instance"),null;const e=(r==null?void 0:r.facing)??"up",n=Ee(e,r==null?void 0:r.size);return new M(W(Ie(e),t,{...r,size:n}))}static createFromPolygon(t,r){if(!(t instanceof Kt))return x.getLogger(C).error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const e=ne(t);return new M({vertexAttributes:new q({position:e.position}),components:[new G({faces:e.faces,shading:"flat",material:(r==null?void 0:r.material)??null})],spatialReference:t.spatialReference})}static async createFromGLTF(t,r,e){if(!(t instanceof L))throw x.getLogger(C).error(".createfromGLTF()","expected location to be a Point instance"),new st("invalid-input","Expected location to be a Point instance");const{loadGLTFMesh:n}=await pt(H(()=>import("./loadGLTFMesh-b826c13a.js"),["./loadGLTFMesh-b826c13a.js","./Color-af6e0c66.js","./colorUtils-639f4d25.js","./mathUtils-57aba1ea.js","./vec3-1863987c.js","./vec3f64-6cd30318.js","./common-c186b691.js","./vec4-46a9b36d.js","./typedArrayUtil-d9bc5fbd.js","./ensureType-25b8cc06.js","./string-480f3e3f.js","./Error-57322e92.js","./request-24011425.js","./preload-helper-41c905a7.js","./promiseUtils-32d9c228.js","./mat3-9a8d9db7.js","./quatf64-c94bd656.js","./vec4f64-939de194.js","./MeshComponent-da2d633e.js","./cast-a534ae90.js","./nextTick-3ee5a785.js","./imageUtils-c2d0d1ae.js","./Extent-a1a1de42.js","./persistableUrlUtils-d0777bec.js","./BufferView-478024d2.js","./vec2-ab9f47bf.js","./vec33-ec7b196f.js","./DefaultMaterial_COLOR_GAMMA-ccf18a3a.js","./types-e1c0a5bf.js","./asyncUtils-087555fc.js","./mat4f64-fbeb2cd1.js","./enums-64ab819c.js","./Version-b16872d5.js","./mat4-7dde83b1.js","./quat-ec16a584.js","./compilerUtils-fefa73ae.js","./Indices-d9b791ce.js","./georeference-553d20c3.js","./unitUtils-dd6fb8ee.js","./jsonMap-190c5593.js","./projection-acd73147.js","./SimpleObservable-8e532943.js","./Polyline-b571c705.js","./assets-cd44347b.js","./aaBoundingRect-b340cf8c.js","./zscale-48bab05e.js","./axisAngleDegrees-700f0205.js","./projection-9ba51a79.js"],import.meta.url),e);return new M(await n(t,r,e))}static createWithExternalSource(t,r,e){var i;const n=(e==null?void 0:e.extent)??null,o=((i=e==null?void 0:e.transform)==null?void 0:i.clone())??new K;o.origin=[t.x,t.y,t.z??0];const s=t.spatialReference;return new M({external:{source:r,extent:n},transform:o,spatialReference:s})}static createIncomplete(t,r){var s;const e=((s=r==null?void 0:r.transform)==null?void 0:s.clone())??new K;e.origin=[t.x,t.y,t.z??0];const n=t.spatialReference,o=new M({transform:e,spatialReference:n});return o.addResolvingPromise(Promise.reject(new st("mesh-incomplete","Mesh resources are not complete"))),o}};A([F({type:[G],json:{write:!0}})],w.prototype,"components",void 0),A([F({type:K,json:{write:!0}})],w.prototype,"transform",void 0),A([F({constructOnly:!0})],w.prototype,"external",void 0),A([F({readOnly:!0})],w.prototype,"hasExtent",null),A([F({readOnly:!0})],w.prototype,"_boundingInfo",null),A([F({readOnly:!0})],w.prototype,"anchor",null),A([F({readOnly:!0})],w.prototype,"origin",null),A([F({readOnly:!0,json:{read:!1}})],w.prototype,"extent",null),A([F({readOnly:!0,json:{read:!1,write:!0,default:!0}})],w.prototype,"hasZ",void 0),A([F({readOnly:!0,json:{read:!1,write:!0,default:!1}})],w.prototype,"hasM",void 0),A([F({type:q,nonNullable:!0,json:{write:!0}})],w.prototype,"vertexAttributes",void 0),w=M=A([Zt(C)],w);const ot={x:nt(1,0,0),y:nt(0,1,0),z:nt(0,0,1)},T=J(),Mt=J(),Lt=J(),X=y(),Ot=w;function yn(t,r,e){const n=e.features;e.features=[],delete e.geometryType;const o=ce.fromJSON(e);if(o.geometryType="mesh",!e.assetMaps)return o;const s=Xe(r,e.assetMaps),i=o.spatialReference,a=e.globalIdFieldName,l=Z(t.outFields)||!t.outFields.length?()=>({}):Ze(t.outFields.includes("*")?null:new Set(t.outFields));for(const f of n){const p=Ve(f,a,i,r,s);c(p)&&o.features.push(new Gt({geometry:p,attributes:l(f)}))}return o}function Ze(t){return({attributes:r})=>{if(!r)return{};if(!t)return r;for(const e in r)t.has(e)||delete r[e];return r}}function Ve(t,r,e,n,o){const s=t.attributes[r],i=o.get(s);if(i==null||i.status===I.FAILED||i.url==null)return null;const a=Je(t,e,n),l=it.fromJSON(t.geometry);l.spatialReference=e;const f=We(t.attributes,n,i.geographic);return i.status===I.PENDING?Ot.createIncomplete(a,{extent:l,transform:f}):Ot.createWithExternalSource(a,[{name:i.name,source:i.url}],{extent:l,transform:f})}function Je({attributes:t},r,{transformFieldRoles:e}){return new L({x:t[e.originX],y:t[e.originY],z:t[e.originZ],spatialReference:r})}function We(t,{transformFieldRoles:r},e){return new K({translation:[t[r.translationX],t[r.translationY],t[r.translationZ]],rotation:Y([t[r.rotationX],t[r.rotationY],t[r.rotationZ]],t[r.rotationDeg]),scale:[t[r.scaleX],t[r.scaleY],t[r.scaleZ]],geographic:e})}var I;function Xe(t,r){const e=new Map;for(const n of r){const o=n.parentGlobalId;if(o==null)continue;const s=n.assetName,i=n.assetURL,a=n.conversionStatus;let l=e.get(o);if(l!=null)throw new Error("multiple asset parts not expected.");switch(l={name:s,status:I.FAILED,url:i,geographic:Ye(n.flags).projectVertices},e.set(o,l),a){case"COMPLETED":case"SUBMITTED":l.status=I.COMPLETED;break;case"INPROGRESS":l.status=I.PENDING;break;default:l.status=I.FAILED}}return e}function Ye(t){return{projectVertices:t.includes("PROJECT_VERTICES")}}(function(t){t[t.FAILED=0]="FAILED",t[t.PENDING=1]="PENDING",t[t.COMPLETED=2]="COMPLETED"})(I||(I={}));export{yn as meshFeatureSetFromJSON};
