import{_ as V}from"./preload-helper-41c905a7.js";import{a as N}from"./Error-57322e92.js";import{t as F,r as s}from"./typedArrayUtil-d9bc5fbd.js";import{t as _,o as w}from"./string-480f3e3f.js";import{i as D}from"./arcadeOnDemand-a976a73c.js";var a;function L(e,n){switch(e.type){case"range":{const i="range"in e?e.range[0]:e.minValue,t="range"in e?e.range[1]:e.maxValue;if(i!=null&&+n<i||t!=null&&+n>t)return a.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(e.codedValues==null||e.codedValues.every(i=>i==null||i.code!==n))return a.INVALID_CODED_VALUE}return null}function O(e){if(!(!e||e.type!=="range"))return{min:"range"in e?e.range[0]:e.minValue,max:"range"in e?e.range[1]:e.maxValue}}(function(e){e.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",e.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(a||(a={}));const S=/^([0-9])/,U=/[^A-Za-z0-9_\u0080-\uffff]/g,$=/_{2,}/g,P=/^_/,R=/_$/;function se(e){return e?e.trim().replace(U,"_").replace($,"_").replace(P,"").replace(R,"").replace(S,"F$1"):null}const z=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],C=["field","normalizationField"];function ue(e,n){if(e!=null&&n!=null){for(const i of Array.isArray(e)?e:[e])if(x(z,i,n),"visualVariables"in i&&i.visualVariables)for(const t of i.visualVariables)x(C,t,n)}}function x(e,n,i){if(e)for(const t of e){const r=_(t,n),l=r&&typeof r!="function"&&i.get(r);l&&w(t,l.name,n)}}function fe(e,n){var i;if(e!=null&&((i=n==null?void 0:n.fields)!=null&&i.length))if("startField"in e){const t=n.get(e.startField),r=n.get(e.endField);e.startField=(t==null?void 0:t.name)??null,e.endField=(r==null?void 0:r.name)??null}else{const t=n.get(e.startTimeField),r=n.get(e.endTimeField);e.startTimeField=(t==null?void 0:t.name)??null,e.endTimeField=(r==null?void 0:r.name)??null}}const p=new Set;function b(e,n){return e&&n?(p.clear(),f(p,e,n),Array.from(p).sort()):[]}function f(e,n,i){var t;if(i)if((t=n==null?void 0:n.fields)!=null&&t.length)if(i.includes("*"))for(const{name:r}of n.fields)e.add(r);else for(const r of i)m(e,n,r);else{if(i.includes("*"))return e.clear(),void e.add("*");for(const r of i)r!=null&&e.add(r)}}function m(e,n,i){if(typeof i=="string")if(n){const t=n.get(i);t&&e.add(t.name)}else e.add(i)}function de(e,n){return F(n)||F(e)?[]:n.includes("*")?(e.fields??[]).map(i=>i.name):n}async function u(e,n,i){var l;if(!i)return;const{arcadeUtils:t}=await D(),r=t.extractFieldNames(i,(l=n==null?void 0:n.fields)==null?void 0:l.map(o=>o.name));for(const o of r)m(e,n,o)}async function v(e,n,i){if(i&&i!=="1=1"){const t=(await V(()=>import("./WhereClause-6c9440a1.js"),["./WhereClause-6c9440a1.js","./string-480f3e3f.js","./typedArrayUtil-d9bc5fbd.js"],import.meta.url)).WhereClause.create(i,n);if(!t.isStandardized)throw new N("fieldUtils:collectFilterFields","Where clause is not standardized",{where:i});f(e,n,t.fieldNames)}}function ce({displayField:e,fields:n}){return e||(n&&n.length?g(n,"name-or-title")||g(n,"unique-identifier")||g(n,"type-or-category")||G(n):null)}function G(e){for(const n of e){if(!n||!n.name)continue;const i=n.name.toLowerCase();if(i.includes("name")||i.includes("title"))return n.name}return null}function g(e,n){for(const i of e)if(i&&i.valueType&&i.valueType===n)return i.name;return null}async function me(e,n){if(!n)return;const i=_("elevationInfo.featureExpressionInfo",n);return i?i.collectRequiredFields(e,n.fieldsIndex):void 0}function k(e,n,i){i.onStatisticExpression?u(e,n,i.onStatisticExpression.expression):e.add(i.onStatisticField)}async function pe(e,n,i){if(!n||!i||!("fields"in i))return;const t=[],r=i.popupTemplate;t.push(M(e,n,r)),i.fields&&t.push(...i.fields.map(async l=>k(e,n.fieldsIndex,l))),await Promise.all(t)}async function M(e,n,i){const t=[];i!=null&&i.expressionInfos&&t.push(...i.expressionInfos.map(l=>u(e,n.fieldsIndex,l.expression)));const r=i==null?void 0:i.content;if(Array.isArray(r))for(const l of r)l.type==="expression"&&l.expressionInfo&&t.push(u(e,n.fieldsIndex,l.expressionInfo.expression));await Promise.all(t)}async function ge(e,n,i){n&&(n.timeInfo&&s(i)&&i.timeExtent&&f(e,n.fieldsIndex,[n.timeInfo.startField,n.timeInfo.endField]),n.floorInfo&&f(e,n.fieldsIndex,[n.floorInfo.floorField]),s(i)&&s(i.where)&&await v(e,n.fieldsIndex,i.where))}async function ye(e,n,i){n&&i&&await Promise.all(i.map(t=>W(e,n,t)))}async function W(e,n,i){n&&i&&(i.valueExpression?await u(e,n.fieldsIndex,i.valueExpression):i.field&&m(e,n.fieldsIndex,i.field))}function Ie(e){if(!e)return[];const n="editFieldsInfo"in e&&e.editFieldsInfo;return n?b(e.fieldsIndex,[n&&n.creatorField,n&&n.creationDateField,n&&n.editorField,n&&n.editDateField]):[]}function Fe(e){if(!e)return[];const n=e.geometryFieldsInfo;return n?b(e.fieldsIndex,[n.shapeAreaField,n.shapeLengthField]):[]}async function xe(e,n){const{labelingInfo:i,fieldsIndex:t}=n;i&&i.length&&await Promise.all(i.map(r=>Y(e,t,r)))}async function Y(e,n,i){if(!i)return;const t=i.getLabelExpression(),r=i.where;if(t.type==="arcade")await u(e,n,t.expression);else{const l=t.expression.match(/{[^}]*}/g);l&&l.forEach(o=>{m(e,n,o.slice(1,-1))})}await v(e,n,r)}function _e(e){const n=e.defaultValue;return n!==void 0&&E(e,n)?n:e.nullable?null:void 0}function h(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}function q(e){return e===null||h(e)}const y="isInteger"in Number?Number.isInteger:e=>typeof e=="number"&&isFinite(e)&&Math.floor(e)===e;function J(e){return e===null||y(e)}function T(e){return e!=null&&typeof e=="string"}function X(e){return e===null||T(e)}function Z(){return!0}function E(e,n){let i;switch(e.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":i=e.nullable?J:y;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":i=e.nullable?q:h;break;case"string":case"esriFieldTypeString":i=e.nullable?X:T;break;default:i=Z}return arguments.length===1?i:i(n)}const j=["integer","small-integer","single","double"],B=new Set([...j,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function A(e){return e!=null&&B.has(e.type)}function be(e){return e!=null&&(e.type==="string"||e.type==="esriFieldTypeString")}function ve(e){return e!=null&&(e.type==="date"||e.type==="esriFieldTypeDate")}var d,c;function he(e){return e==null||typeof e=="number"&&isNaN(e)?null:e}function Te(e,n){return e.nullable&&n===null?null:A(e)&&!H(e.type,Number(n))?d.OUT_OF_RANGE:E(e,n)?e.domain?L(e.domain,n):null:c.INVALID_TYPE}function H(e,n){const i=typeof e=="string"?I(e):e;if(!i)return!1;const t=i.min,r=i.max;return i.isInteger?y(n)&&n>=t&&n<=r:n>=t&&n<=r}function Ee(e){return O(e.domain)||(A(e)?I(e.type):void 0)}function I(e){switch(e){case"esriFieldTypeSmallInteger":case"small-integer":return K;case"esriFieldTypeInteger":case"integer":return Q;case"esriFieldTypeSingle":case"single":return ee;case"esriFieldTypeDouble":case"double":return ne}}(function(e){e.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(d||(d={})),function(e){e.INVALID_TYPE="type-validation-error::invalid-type"}(c||(c={}));const K={min:-32768,max:32767,isInteger:!0},Q={min:-2147483648,max:2147483647,isInteger:!0},ee={min:-34e37,max:12e37,isInteger:!1},ne={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function Ae(e,n,i){switch(e){case a.INVALID_CODED_VALUE:return`Value ${i} is not in the coded domain - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case a.VALUE_OUT_OF_RANGE:return`Value ${i} is out of the range of valid values - field: ${n.name}, domain: ${JSON.stringify(n.domain)}`;case c.INVALID_TYPE:return`Value ${i} is not a valid value for the field type - field: ${n.name}, type: ${n.type}, nullable: ${n.nullable}`;case d.OUT_OF_RANGE:{const{min:t,max:r}=I(n.type);return`Value ${i} is out of range for the number type - field: ${n.name}, type: ${n.type}, value range is ${t} to ${r}`}}}function Ve(e,n){return!ie(e,n,null)}function ie(e,n,i){if(!n||!n.attributes||!e){if(s(i))for(const l of e??[])i.add(l);return!0}const t=n.attributes;let r=!1;for(const l of e)if(!(l in t)){if(r=!0,!s(i))break;i.add(l)}return r}function Ne(e){return["raster.itempixelvalue","raster.servicepixelvalue"].some(n=>e.toLowerCase().startsWith(n))}export{Ie as C,me as D,ce as E,ue as F,Ae as I,_e as M,pe as O,Fe as R,u as S,b as T,xe as W,O as a,fe as b,Ee as c,f as d,a as e,Te as f,he as g,Ne as h,A as i,ge as j,L as n,d as o,se as p,ve as r,c as s,be as t,de as v,m as w,Ve as x,ye as z};
