import{u as j,e,y as r,n as h,m as P}from"./cast-a534ae90.js";import{c as C}from"./Analysis-4f8dbb03.js";import{t as a,b as m,r as s,o as g,e as w}from"./typedArrayUtil-d9bc5fbd.js";import{i as H,l as M}from"./Clonable-9b34e760.js";import"./ensureType-25b8cc06.js";import{g as f}from"./persistable-f6bec6f5.js";import{w as O}from"./Extent-a1a1de42.js";import{x as L}from"./ElevationInfo-80227ecc.js";import{j as v}from"./Collection-7c37b74e.js";import{t as k,n as E}from"./collectionUtils-0365f48b.js";import{l as F,w as R}from"./reactiveUtils-5869e41a.js";import{u as B}from"./projection-acd73147.js";import{u as D,c as G,m as J}from"./aaBoundingBox-4a83dbbc.js";import{i as K}from"./elevationInfoUtils-c3025fae.js";import{O as Q}from"./MultiOriginJSONSupport-b8792dfa.js";import{b as U}from"./Layer-cea228f0.js";import{c as V}from"./OperationalLayer-9c50475b.js";import"./string-480f3e3f.js";import"./Error-57322e92.js";import"./nextTick-3ee5a785.js";import"./promiseUtils-32d9c228.js";import"./Identifiable-093f90a8.js";import"./preload-helper-41c905a7.js";import"./multiOriginJSONSupportUtils-c978f4c3.js";import"./request-24011425.js";import"./uuid-73213768.js";import"./persistableUrlUtils-d0777bec.js";import"./jsonMap-190c5593.js";import"./fieldUtils-b2df74c4.js";import"./arcadeOnDemand-a976a73c.js";import"./geometry-eec1b371.js";import"./Polyline-b571c705.js";import"./typeUtils-cd52dc20.js";import"./lengthUtils-92fed992.js";import"./unitUtils-dd6fb8ee.js";import"./Evented-cbf5f368.js";import"./SimpleObservable-8e532943.js";import"./mathUtils-57aba1ea.js";import"./vec3-1863987c.js";import"./vec3f64-6cd30318.js";import"./common-c186b691.js";import"./vec4-46a9b36d.js";import"./mat4-7dde83b1.js";import"./assets-cd44347b.js";import"./aaBoundingRect-b340cf8c.js";import"./zscale-48bab05e.js";import"./Loadable-46524a7e.js";import"./Promise-368b703a.js";import"./TimeExtent-2004eecf.js";import"./opacityUtils-1333f803.js";function S(t,i){return $(t)===$(i)}function $(t){if(a(t))return null;const i=t.layer!=null?t.layer.id:"";let o=null;return o=t.objectId!=null?t.objectId:t.layer!=null&&"objectIdField"in t.layer&&t.layer.objectIdField!=null&&t.attributes!=null?t.attributes[t.layer.objectIdField]:t.uid,o==null?null:`o-${i}-${o}`}const z={json:{write:{writer:W,target:{"feature.layerId":{type:[Number,String]},"feature.objectId":{type:[Number,String]}}},origins:{"web-scene":{read:X}}}};function W(t,i){var o;a(t)||((o=t.layer)==null?void 0:o.objectIdField)==null||t.attributes==null||(i.feature={layerId:t.layer.id,objectId:t.attributes[t.layer.objectIdField]})}function X(t){if(t.layerId!=null&&t.objectId!=null)return{uid:null,layer:{id:t.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:t.objectId}}}let p=class extends j(H(P)){constructor(i){super(i),this.position=null,this.elevationInfo=null,this.feature=null}equals(i){return m(this.position,i.position)&&m(this.elevationInfo,i.elevationInfo)&&S(this.feature,i.feature)}};e([r({type:O}),f()],p.prototype,"position",void 0),e([r({type:L}),f()],p.prototype,"elevationInfo",void 0),e([r(z)],p.prototype,"feature",void 0),p=e([h("esri.analysis.LineOfSightAnalysisObserver")],p);const _=p;let u=class extends j(M){constructor(t){super(t),this.position=null,this.elevationInfo=null,this.feature=null}equals(t){return m(this.position,t.position)&&m(this.elevationInfo,t.elevationInfo)&&S(this.feature,t.feature)}};e([r({type:O}),f()],u.prototype,"position",void 0),e([r({type:L}),f()],u.prototype,"elevationInfo",void 0),e([r(z)],u.prototype,"feature",void 0),u=e([h("esri.analysis.LineOfSightAnalysisTarget")],u);const A=u,b=v.ofType(A);let l=class extends C{constructor(t){super(t),this.type="line-of-sight",this.observer=null,this.extent=null}initialize(){this.addHandles(F(()=>this._computeExtent(),t=>{(a(t)||a(t.pending))&&this._set("extent",s(t)?t.extent:null)},R))}get targets(){return this._get("targets")||new b}set targets(t){this._set("targets",E(t,this.targets,b))}get spatialReference(){return s(this.observer)&&s(this.observer.position)?this.observer.position.spatialReference:null}get requiredPropertiesForEditing(){return[g(this.observer,t=>t.position)]}async waitComputeExtent(){const t=this._computeExtent();return s(t)?w(t.pending):null}_computeExtent(){const t=this.spatialReference;if(a(this.observer)||a(this.observer.position)||a(t))return null;const i=y=>K(y.position,y.elevationInfo)==="absolute-height",o=this.observer.position,I=D(o.x,o.y,o.z,o.x,o.y,o.z);for(const y of this.targets)if(s(y.position)){const d=B(y.position,t);if(s(d.pending))return{pending:d.pending,extent:null};if(s(d.geometry)){const{x:T,y:q,z:N}=d.geometry;G(I,[T,q,N])}}const c=J(I,t);return i(this.observer)&&this.targets.every(i)||(c.zmin=null,c.zmax=null),{pending:null,extent:c}}clear(){this.observer=null,this.targets.removeAll()}};e([r({type:["line-of-sight"]})],l.prototype,"type",void 0),e([r({type:_,json:{read:!0,write:!0}})],l.prototype,"observer",void 0),e([r({cast:k,type:b,nonNullable:!0,json:{read:!0,write:!0}})],l.prototype,"targets",null),e([r({value:null,readOnly:!0})],l.prototype,"extent",void 0),e([r({readOnly:!0})],l.prototype,"spatialReference",null),e([r({readOnly:!0})],l.prototype,"requiredPropertiesForEditing",null),l=e([h("esri.analysis.LineOfSightAnalysis")],l);const x=l,Y=v.ofType(A);let n=class extends V(Q(U)){constructor(t){super(t),this.type="line-of-sight",this.operationalLayerType="LineOfSightLayer",this.analysis=new x,this.opacity=1}initialize(){this.addHandles(F(()=>this.analysis,(t,i)=>{s(i)&&i.parent===this&&(i.parent=null),s(t)&&(t.parent=this)},R))}async load(){return s(this.analysis)&&this.addResolvingPromise(this.analysis.waitComputeExtent()),this}get observer(){return g(this.analysis,t=>t.observer)}set observer(t){g(this.analysis,i=>i.observer=t)}get targets(){return s(this.analysis)?this.analysis.targets:new v}set targets(t){var i;E(t,(i=this.analysis)==null?void 0:i.targets)}get fullExtent(){return s(this.analysis)?this.analysis.extent:null}get spatialReference(){return s(this.analysis)?w(this.analysis.spatialReference):null}releaseAnalysis(t){this.analysis===t&&(this.analysis=new x)}};e([r({json:{read:!1},readOnly:!0})],n.prototype,"type",void 0),e([r({type:["LineOfSightLayer"]})],n.prototype,"operationalLayerType",void 0),e([r({type:_,json:{read:!0,write:{ignoreOrigin:!0}}})],n.prototype,"observer",null),e([r({type:Y,json:{read:!0,write:{ignoreOrigin:!0}}})],n.prototype,"targets",null),e([r({nonNullable:!0,json:{read:!1,write:!1}})],n.prototype,"analysis",void 0),e([r({readOnly:!0})],n.prototype,"fullExtent",null),e([r({readOnly:!0})],n.prototype,"spatialReference",null),e([r({readOnly:!0,json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],n.prototype,"opacity",void 0),e([r({type:["show","hide"]})],n.prototype,"listMode",void 0),n=e([h("esri.layers.LineOfSightLayer")],n);const Wt=n;export{Wt as default};
