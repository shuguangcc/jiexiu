import{b as l,a as f}from"./Error-57322e92.js";import{j as S}from"./Portal-c6e03126.js";import{U as h}from"./request-24011425.js";import{b as d}from"./ensureType-25b8cc06.js";import{c}from"./jsonUtils-c6684c52.js";import{f as w,b as R,o as v}from"./normalizeUtils-0f537694.js";import{e as m,y as p,n as $,l as J}from"./cast-a534ae90.js";import"./typedArrayUtil-d9bc5fbd.js";import"./string-480f3e3f.js";import"./preload-helper-41c905a7.js";import"./Loadable-46524a7e.js";import"./Promise-368b703a.js";import"./promiseUtils-32d9c228.js";import"./Extent-a1a1de42.js";import"./locale-30120714.js";import"./PortalGroup-d495847c.js";import"./jsonMap-190c5593.js";import"./PortalUser-1016c43c.js";import"./nextTick-3ee5a785.js";import"./Polyline-b571c705.js";import"./geometry-eec1b371.js";import"./typeUtils-cd52dc20.js";let a=class extends J{constructor(r){super(r),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const r=this.geometries.map(i=>i.toJSON()),e=this.geometries[0],t={};return t.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),t.inSR=e.spatialReference.wkid||JSON.stringify(e.spatialReference.toJSON()),t.geometries=JSON.stringify({geometryType:c(e),geometries:r}),this.transformation&&(t.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(t.transformForward=this.transformForward),t}};m([p()],a.prototype,"geometries",void 0),m([p({json:{read:{source:"outSR"}}})],a.prototype,"outSpatialReference",void 0),m([p()],a.prototype,"transformation",void 0),m([p()],a.prototype,"transformForward",void 0),a=m([$("esri.rest.support.ProjectParameters")],a);const u=a,N=d(u);async function O(o,r,e){r=N(r);const t=w(o),i={...t.query,f:"json",...r.toJSON()},n=r.outSpatialReference,s=c(r.geometries[0]),g=R(i,e);return h(t.path+"/project",g).then(({data:{geometries:y}})=>v(y,s,n))}async function j(o=null,r){var i,n;if(l.geometryServiceUrl)return l.geometryServiceUrl;if(!o)throw new f("internal:geometry-service-url-not-configured");let e;e="portal"in o?o.portal||S.getDefault():o,await e.load({signal:r});const t=(n=(i=e.helperServices)==null?void 0:i.geometry)==null?void 0:n.url;if(!t)throw new f("internal:geometry-service-url-not-configured");return t}async function X(o,r,e=null,t){const i=await j(e,t),n=new u;n.geometries=[o],n.outSpatialReference=r;const s=await O(i,n,{signal:t});if(s&&Array.isArray(s)&&s.length===1)return s[0];throw new f("internal:geometry-service-projection-failed")}export{j as getGeometryServiceURL,X as projectGeometry};
