import{r as v,t as g}from"./typedArrayUtil-d9bc5fbd.js";import{c as z,$ as G,L as S,E as Y}from"./unitUtils-dd6fb8ee.js";import{e as k,a as C}from"./quatf64-c94bd656.js";import{P as V,h as O,u as Z,C as D,B as H,i as J}from"./mat4-7dde83b1.js";import{e as y,o as U}from"./mat4f64-fbeb2cd1.js";import{g as P}from"./mat3-9a8d9db7.js";import{Z as B,x as W}from"./projection-0af97a56.js";import{e as u,y as f,n as K,l as Q}from"./cast-a534ae90.js";import"./ensureType-25b8cc06.js";import{v as X}from"./quat-ec16a584.js";import{O as E,F as tt}from"./vec3-1863987c.js";import{n as b,r as rt,t as T}from"./vec3f64-6cd30318.js";import{w as nt}from"./Extent-a1a1de42.js";import{a as N,x as ot,g as et}from"./axisAngleDegrees-700f0205.js";import{T as m,i as h}from"./BufferView-478024d2.js";import{t as A,e as it,r as $}from"./vec33-ec7b196f.js";import{O as at,h as lt,L as st,M as ct,j as pt,k as ut,R as ft,v as gt,V as mt}from"./projection-78a47c97.js";var M;let p=M=class extends Q{constructor(t){super(t),this.origin=b(),this.translation=b(),this.rotation=N(),this.scale=rt(1,1,1),this.geographic=!0}get localMatrix(){const t=y();return X(L,et(this.rotation),ot(this.rotation)),V(t,L,this.translation,this.scale),t}get localMatrixInverse(){return O(y(),this.localMatrix)}applyLocal(t,r){return E(r,t,this.localMatrix)}applyLocalInverse(t,r){return E(r,t,this.localMatrixInverse)}project(t,r){const n=new Float64Array(t.length),o=m.fromTypedArray(n),e=m.fromTypedArray(t);if(this.geographic){const l=z(r),c=y();return B(r,this.origin,c,l),Z(c,c,this.localMatrix),A(o,e,c),W(n,l,0,n,r,0,n.length/3),n}const{localMatrix:i,origin:a}=this;D(i,U)?it(o,e):A(o,e,i);for(let l=0;l<n.length;l+=3)n[l+0]+=a[0],n[l+1]+=a[1],n[l+2]+=a[2];return n}getOriginPoint(t){const[r,n,o]=this.origin;return new nt({x:r,y:n,z:o,spatialReference:t})}equals(t){return v(t)&&this.geographic===t.geographic&&tt(this.origin,t.origin)&&H(this.localMatrix,t.localMatrix)}clone(){const t={origin:T(this.origin),translation:T(this.translation),rotation:N(this.rotation),scale:T(this.scale),geographic:this.geographic};return new M(t)}};u([f({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"origin",void 0),u([f({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"translation",void 0),u([f({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"rotation",void 0),u([f({type:[Number],nonNullable:!0,json:{write:!0}})],p.prototype,"scale",void 0),u([f({type:Boolean,nonNullable:!0,json:{write:!0}})],p.prototype,"geographic",void 0),u([f()],p.prototype,"localMatrix",null),u([f()],p.prototype,"localMatrixInverse",null),p=M=u([K("esri.geometry.support.MeshTransform")],p);const L=k(),ht=p;function x(t,r){return t.isGeographic||t.isWebMercator&&((r==null?void 0:r.geographic)??!0)}function j(t,r,n){return x(r.spatialReference,n)?xt(t,r,n):$t(t,r,n)}function yt(t,r,n){const{position:o,normal:e,tangent:i}=t;if(g(r))return{position:o,normal:e,tangent:i};const a=r.localMatrix;return j({position:ft(o,new Float64Array(o.length),a),normal:v(e)?gt(e,new Float32Array(e.length),a):null,tangent:v(i)?mt(i,new Float32Array(i.length),a):null},r.getOriginPoint(n),{geographic:r.geographic})}function Zt(t,r,n){if(n!=null&&n.useTransform){const{position:o,normal:e,tangent:i}=t;return{vertexAttributes:{position:o,normal:e,tangent:i},transform:new ht({origin:[r.x,r.y,r.z??0],geographic:x(r.spatialReference,n)})}}return{vertexAttributes:j(t,r,n),transform:null}}function At(t,r,n){return x(r.spatialReference,n)?_(t,r,n):d(t,r,n)}function Dt(t,r,n,o){if(g(r))return At(t,n,o);const e=yt(t,r,n.spatialReference);return n.equals(r.getOriginPoint(n.spatialReference))?d(e,n,o):x(n.spatialReference,o)?_(e,n,o):d(e,n,o)}function $t(t,r,n){const o=new Float64Array(t.position.length),e=t.position,i=r.x,a=r.y,l=r.z||0,{horizontal:c,vertical:w}=R(n?n.unit:null,r.spatialReference);for(let s=0;s<e.length;s+=3)o[s+0]=e[s+0]*c+i,o[s+1]=e[s+1]*c+a,o[s+2]=e[s+2]*w+l;return{position:o,normal:t.normal,tangent:t.tangent}}function xt(t,r,n){const o=r.spatialReference,e=I(r,n,F),i=new Float64Array(t.position.length),a=wt(t.position,e,o,i),l=P(q,e);return{position:a,normal:Tt(a,i,t.normal,l,o),tangent:vt(a,i,t.tangent,l,o)}}function wt(t,r,n,o){A(m.fromTypedArray(o),m.fromTypedArray(t),r);const e=new Float64Array(t.length);return at(o,e,n)}function Tt(t,r,n,o,e){if(g(n))return null;const i=new Float32Array(n.length);return $(h.fromTypedArray(i),h.fromTypedArray(n),o),lt(i,t,r,e,i),i}function vt(t,r,n,o,e){if(g(n))return null;const i=new Float32Array(n.length);$(h.fromTypedArray(i,4*Float32Array.BYTES_PER_ELEMENT),h.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT),o);for(let a=3;a<i.length;a+=4)i[a]=n[a];return st(i,t,r,e,i),i}function d(t,r,n){const o=new Float64Array(t.position.length),e=t.position,i=r.x,a=r.y,l=r.z||0,{horizontal:c,vertical:w}=R(n?n.unit:null,r.spatialReference);for(let s=0;s<e.length;s+=3)o[s+0]=(e[s+0]-i)/c,o[s+1]=(e[s+1]-a)/c,o[s+2]=(e[s+2]-l)/w;return{position:o,normal:t.normal,tangent:t.tangent}}function _(t,r,n){const o=r.spatialReference;I(r,n,F);const e=O(Rt,F),i=new Float64Array(t.position.length),a=Mt(t.position,o,e,i),l=P(q,e);return{position:a,normal:dt(t.normal,t.position,i,o,l),tangent:Ft(t.tangent,t.position,i,o,l)}}function I(t,r,n){B(t.spatialReference,[t.x,t.y,t.z||0],n,z(t.spatialReference));const{horizontal:o,vertical:e}=R(r?r.unit:null,t.spatialReference);return J(n,n,[o,o,e]),n}function Mt(t,r,n,o){const e=ct(t,r,o),i=m.fromTypedArray(e),a=new Float64Array(e.length),l=m.fromTypedArray(a);return A(l,i,n),a}function dt(t,r,n,o,e){if(g(t))return null;const i=pt(t,r,n,o,new Float32Array(t.length)),a=h.fromTypedArray(i);return $(a,a,e),i}function Ft(t,r,n,o,e){if(g(t))return null;const i=ut(t,r,n,o,new Float32Array(t.length)),a=h.fromTypedArray(i,4*Float32Array.BYTES_PER_ELEMENT);return $(a,a,e),i}function R(t,r){if(g(t))return Et;const n=r.isGeographic?1:G(r),o=r.isGeographic?1:S(r),e=Y(1,t,"meters");return{horizontal:e*n,vertical:e*o}}const F=y(),Rt=y(),q=C(),Et={horizontal:1,vertical:1};export{ht as L,Dt as M,Zt as _,At as b,yt as k,x as r,j as x};
