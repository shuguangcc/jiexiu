import{j as d}from"./Collection-7c37b74e.js";import"./string-480f3e3f.js";import{E as T}from"./promiseUtils-32d9c228.js";import{a as n}from"./lazyLayerLoader-f5029ec7.js";import f from"./PortalItem-6eebfb2b.js";import{selectLayerClassPath as g}from"./portalLayers-957389b6.js";import{t as G}from"./styleUtils-08eaa4d2.js";import"./cast-a534ae90.js";import"./typedArrayUtil-d9bc5fbd.js";import"./Error-57322e92.js";import"./ensureType-25b8cc06.js";import"./nextTick-3ee5a785.js";import"./Evented-cbf5f368.js";import"./SimpleObservable-8e532943.js";import"./preload-helper-101896b7.js";import"./assets-a5ce5e1a.js";import"./request-f17a8ddb.js";import"./Loadable-46524a7e.js";import"./Promise-368b703a.js";import"./Extent-a1a1de42.js";import"./Portal-51616380.js";import"./locale-30120714.js";import"./PortalGroup-d495847c.js";import"./jsonMap-190c5593.js";import"./PortalUser-e16fc7d1.js";import"./layersLoader-79c82c9e.js";import"./Layer-ead8c88c.js";import"./geometry-eec1b371.js";import"./Polyline-b571c705.js";import"./typeUtils-cd52dc20.js";import"./Identifiable-093f90a8.js";import"./arcgisLayerUrl-6e9db12f.js";import"./persistableUrlUtils-56d43b12.js";import"./jsonContext-6424e470.js";import"./portalItemUtils-086b3ea5.js";import"./projection-0af97a56.js";import"./mathUtils-57aba1ea.js";import"./vec3-1863987c.js";import"./vec3f64-6cd30318.js";import"./common-c186b691.js";import"./vec4-46a9b36d.js";import"./unitUtils-dd6fb8ee.js";import"./mat4-7dde83b1.js";import"./aaBoundingRect-b340cf8c.js";import"./zscale-48bab05e.js";import"./asyncUtils-087555fc.js";function M(e){return s(e,"notes")}function A(e){return s(e,"markup")}function v(e){return s(e,"route")}function s(e,r){return!(!e.layerType||e.layerType!=="ArcGISFeatureLayer")&&e.featureCollectionType===r}async function w(e,r,a){if(!r)return;const i=[];for(const t of r){const y=B(t,a);t.layerType==="GroupLayer"?i.push(x(y,t,a)):i.push(y)}const o=await T(i);for(const t of o)!t.value||a.filter&&!a.filter(t.value)||e.add(t.value)}const b={ArcGISDimensionLayer:"DimensionLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",PointCloudLayer:"PointCloudLayer",ArcGISSceneServiceLayer:"SceneLayer",IntegratedMeshLayer:"IntegratedMeshLayer",OGCFeatureLayer:"OGCFeatureLayer",BuildingSceneLayer:"BuildingSceneLayer",ArcGISTiledElevationServiceLayer:"ElevationLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",GroupLayer:"GroupLayer",GeoJSON:"GeoJSONLayer",WebTiledLayer:"WebTileLayer",CSV:"CSVLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer",KML:"KMLLayer",RasterDataLayer:"UnsupportedLayer",Voxel:"VoxelLayer",LineOfSightLayer:"LineOfSightLayer"},W={ArcGISTiledElevationServiceLayer:"ElevationLayer",DefaultTileLayer:"ElevationLayer",RasterDataElevationLayer:"UnsupportedLayer"},F={ArcGISTiledMapServiceLayer:"TileLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",OpenStreetMap:"OpenStreetMapLayer",WebTiledLayer:"WebTileLayer",VectorTileLayer:"VectorTileLayer",ArcGISImageServiceLayer:"UnsupportedLayer",WMS:"UnsupportedLayer",ArcGISMapServiceLayer:"UnsupportedLayer",DefaultTileLayer:"TileLayer"},C={ArcGISAnnotationLayer:"UnsupportedLayer",ArcGISDimensionLayer:"UnsupportedLayer",ArcGISFeatureLayer:"FeatureLayer",ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISStreamLayer:"StreamLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",CSV:"CSVLayer",DefaultTileLayer:"TileLayer",GeoRSS:"GeoRSSLayer",GeoJSON:"GeoJSONLayer",GroupLayer:"GroupLayer",KML:"KMLLayer",OGCFeatureLayer:"OGCFeatureLayer",OrientedImageryLayer:"OrientedImageryLayer",SubtypeGroupLayer:"SubtypeGroupLayer",VectorTileLayer:"VectorTileLayer",WFS:"WFSLayer",WMS:"WMSLayer",WebTiledLayer:"WebTileLayer"},O={ArcGISFeatureLayer:"FeatureLayer"},V={ArcGISImageServiceLayer:"ImageryLayer",ArcGISImageServiceVectorLayer:"ImageryLayer",ArcGISMapServiceLayer:"MapImageLayer",ArcGISTiledImageServiceLayer:"ImageryTileLayer",ArcGISTiledMapServiceLayer:"TileLayer",OpenStreetMap:"OpenStreetMapLayer",VectorTileLayer:"VectorTileLayer",WebTiledLayer:"WebTileLayer",BingMapsAerial:"BingMapsLayer",BingMapsRoad:"BingMapsLayer",BingMapsHybrid:"BingMapsLayer",WMS:"WMSLayer",DefaultTileLayer:"TileLayer"};async function B(e,r){return h(await D(e,r),e,r)}async function h(e,r,a){const i=new e;return i.read(r,a.context),i.type==="group"&&S(r)&&await k(i,r,a.context),await G(i,a.context),i}async function D(e,r){const a=r.context,i=U(a);let o=e.layerType||e.type;!o&&r&&r.defaultLayerType&&(o=r.defaultLayerType);const t=i[o];let y=t?n[t]:n.UnknownLayer;if(I(e)){const l=a==null?void 0:a.portal;if(e.itemId){const L=new f({id:e.itemId,portal:l});await L.load();const p=(await g(L)).className||"UnknownLayer";y=n[p]}}else o==="ArcGISFeatureLayer"?M(e)||A(e)?y=n.MapNotesLayer:v(e)?y=n.RouteLayer:S(e)&&(y=n.GroupLayer):e.wmtsInfo&&e.wmtsInfo.url&&e.wmtsInfo.layerIdentifier?y=n.WMTSLayer:o==="WFS"&&e.wfsInfo.version!=="2.0.0"&&(y=n.UnsupportedLayer);return y()}function S(e){var r,a;return e.layerType!=="ArcGISFeatureLayer"||I(e)?!1:(((a=(r=e.featureCollection)==null?void 0:r.layers)==null?void 0:a.length)??0)>1}function I(e){return e.type==="Feature Collection"}function U(e){let r;if(e.origin==="web-scene")switch(e.layerContainerType){case"basemap":r=F;break;case"ground":r=W;break;default:r=b}else switch(e.layerContainerType){case"basemap":r=V;break;case"tables":r=O;break;default:r=C}return r}async function x(e,r,a){const i=new d,o=w(i,Array.isArray(r.layers)?r.layers:[],a),t=await e;if(await o,t.type==="group")return t.layers.addMany(i),t}async function k(e,r,a){const i=n.FeatureLayer,o=await i(),t=r.featureCollection,y=t.showLegend,l=t.layers.map((L,p)=>{var m;const c=new o;c.read(L,a);const u={...a,ignoreDefaults:!0};return c.read({id:`${e.id}-sublayer-${p}`,visibility:((m=r.visibleLayers)==null?void 0:m.includes(p))??!0},u),y!=null&&c.read({showLegend:y},u),c});e.layers.addMany(l)}export{w as populateOperationalLayers};
