import{a as N}from"./Error-57322e92.js";import{a as S}from"./lazyLayerLoader-f5029ec7.js";import f from"./PortalItem-6eebfb2b.js";import{n as s,w as m,b as h,T as I,g}from"./layersLoader-79c82c9e.js";import{s as c}from"./portalItemUtils-086b3ea5.js";import"./string-480f3e3f.js";import"./typedArrayUtil-d9bc5fbd.js";import"./preload-helper-101896b7.js";import"./cast-a534ae90.js";import"./ensureType-25b8cc06.js";import"./nextTick-3ee5a785.js";import"./promiseUtils-32d9c228.js";import"./assets-a5ce5e1a.js";import"./request-f17a8ddb.js";import"./Loadable-46524a7e.js";import"./Promise-368b703a.js";import"./Extent-a1a1de42.js";import"./Portal-51616380.js";import"./locale-30120714.js";import"./PortalGroup-d495847c.js";import"./jsonMap-190c5593.js";import"./PortalUser-e16fc7d1.js";import"./Layer-ead8c88c.js";import"./geometry-eec1b371.js";import"./Polyline-b571c705.js";import"./typeUtils-cd52dc20.js";import"./Evented-cbf5f368.js";import"./Identifiable-093f90a8.js";import"./arcgisLayerUrl-6e9db12f.js";import"./persistableUrlUtils-56d43b12.js";import"./jsonContext-6424e470.js";import"./styleUtils-08eaa4d2.js";import"./asyncUtils-087555fc.js";import"./projection-0af97a56.js";import"./mathUtils-57aba1ea.js";import"./vec3-1863987c.js";import"./vec3f64-6cd30318.js";import"./common-c186b691.js";import"./vec4-46a9b36d.js";import"./unitUtils-dd6fb8ee.js";import"./SimpleObservable-8e532943.js";import"./mat4-7dde83b1.js";import"./aaBoundingRect-b340cf8c.js";import"./zscale-48bab05e.js";function $e(e){return!e.portalItem||e.portalItem instanceof f||(e={...e,portalItem:new f(e.portalItem)}),w(e.portalItem).then(r=>{const t={portalItem:e.portalItem,...r.properties};return new r.constructor(t)})}function w(e){return e.load().then(T).then(M)}function T(e){switch(e.type){case"Map Service":return v(e);case"Feature Service":return C(e);case"Feature Collection":return F(e);case"Scene Service":return G(e);case"Image Service":return P(e);case"Stream Service":return b();case"Vector Tile Service":return $();case"GeoJson":return j();case"CSV":return D();case"KML":return K();case"WFS":return O();case"WMTS":return W();case"WMS":return V();case"Feed":return k();default:return Promise.reject(new N("portal:unknown-item-type","Unknown item type '${type}'",{type:e.type}))}}function M(e){return(0,S[e.className])().then(r=>({constructor:r,properties:e.properties}))}function v(e){return A(e).then(r=>r?{className:"TileLayer"}:{className:"MapImageLayer"})}function C(e){return c(e,"Oriented Imagery Layer")?x(e):L(e).then(r=>{if(typeof r=="object"){const t={};return r.id!=null&&(t.layerId=r.id),{className:r.className||"FeatureLayer",properties:t}}return{className:"GroupLayer"}})}function G(e){return L(e).then(r=>{if(typeof r=="object"){const t={};let a;if(r.id!=null?(t.layerId=r.id,a=`${e.url}/layers/${r.id}`):a=e.url,Array.isArray(e.typeKeywords)&&e.typeKeywords.length>0){const n={IntegratedMesh:"IntegratedMeshLayer","3DObject":"SceneLayer",Point:"SceneLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};for(const o of Object.keys(n))if(e.typeKeywords.includes(o))return{className:n[o]}}return s(a).then(n=>{let o="SceneLayer";const i={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};return n&&n.layerType&&i[n.layerType]&&(o=i[n.layerType]),{className:o,properties:t}})}return r===!1?s(e.url).then(t=>(t==null?void 0:t.layerType)==="Voxel"?{className:"VoxelLayer"}:{className:"GroupLayer"}):{className:"GroupLayer"}})}async function F(e){await e.load();const r=c(e,"Map Notes"),t=c(e,"Markup");if(r||t)return{className:"MapNotesLayer"};if(c(e,"Route Layer"))return{className:"RouteLayer"};const a=await e.fetchData();return m(a)===1?{className:"FeatureLayer"}:{className:"GroupLayer"}}async function P(e){var i,l,p,y;await e.load();const r=((i=e.typeKeywords)==null?void 0:i.map(d=>d.toLowerCase()))??[];if(r.includes("elevation 3d layer"))return{className:"ElevationLayer"};if(r.includes("tiled imagery"))return{className:"ImageryTileLayer"};const t=(l=await e.fetchData())==null?void 0:l.layerType;if(t==="ArcGISTiledImageServiceLayer")return{className:"ImageryTileLayer"};if(t==="ArcGISImageServiceLayer")return{className:"ImageryLayer"};const a=await s(e.url),n=(p=a.cacheType)==null?void 0:p.toLowerCase(),o=(y=a.capabilities)==null?void 0:y.toLowerCase().includes("tilesonly");return n==="map"||o?{className:"ImageryTileLayer"}:{className:"ImageryLayer"}}function b(){return{className:"StreamLayer"}}function $(){return{className:"VectorTileLayer"}}function j(){return{className:"GeoJSONLayer"}}function D(){return{className:"CSVLayer"}}function K(){return{className:"KMLLayer"}}function O(){return{className:"WFSLayer"}}function V(){return{className:"WMSLayer"}}function W(){return{className:"WMTSLayer"}}function k(){return{className:"StreamLayer"}}function x(e){return e.load().then(()=>e.fetchData()).then(r=>r.coverage?{className:"GroupLayer"}:{className:"OrientedImageryLayer",properties:r})}function A(e){return s(e.url).then(r=>r.tileInfo)}function L(e){return!e.url||e.url.match(/\/\d+$/)?Promise.resolve({}):e.load().then(()=>e.fetchData()).then(async r=>{if(e.type==="Feature Service"){const t=u(await h(r,e.url));if(typeof t=="object"){const a=I(r);t.className=a.includes(t.id)?"SubtypeGroupLayer":"FeatureLayer"}return t}return m(r)>0?u(r):s(e.url).then(u)})}function u(e){return m(e)===1&&{id:g(e)}}export{$e as fromItem,T as selectLayerClassPath};
