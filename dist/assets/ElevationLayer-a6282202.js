import{_ as h}from"./preload-helper-101896b7.js";import{e as a,y as s,n as g}from"./cast-a534ae90.js";import{U as c,g as w}from"./request-f17a8ddb.js";import{a as _}from"./Error-57322e92.js";import{e as T,r as m,P as S}from"./typedArrayUtil-d9bc5fbd.js";import{O as $}from"./MultiOriginJSONSupport-b8792dfa.js";import{w as I,f as u}from"./promiseUtils-32d9c228.js";import"./ensureType-25b8cc06.js";import{o as b}from"./Extent-a1a1de42.js";import{v as D}from"./HeightModelInfo-34f16d74.js";import{b as E}from"./Layer-ead8c88c.js";import{s as x}from"./ArcGISCachedService-65a7e463.js";import{p as O}from"./ArcGISService-e571bcff.js";import{c as V,f as L}from"./OperationalLayer-1dad72ac.js";import{v as j}from"./PortalLayer-9dd15f09.js";import{h as A}from"./WorkerHandle-ef77a7ef.js";import"./string-480f3e3f.js";import"./nextTick-3ee5a785.js";import"./jsonMap-190c5593.js";import"./unitUtils-dd6fb8ee.js";import"./geometry-eec1b371.js";import"./Polyline-b571c705.js";import"./typeUtils-cd52dc20.js";import"./Evented-cbf5f368.js";import"./Identifiable-093f90a8.js";import"./Loadable-46524a7e.js";import"./Promise-368b703a.js";import"./TilemapCache-14276d7a.js";import"./TileInfo-c5c8c8d2.js";import"./aaBoundingRect-b340cf8c.js";import"./mathUtils-57aba1ea.js";import"./vec3-1863987c.js";import"./vec3f64-6cd30318.js";import"./common-c186b691.js";import"./vec4-46a9b36d.js";import"./byteSizeEstimations-90c5a50d.js";import"./HandleOwner-2edbba46.js";import"./reactiveUtils-5869e41a.js";import"./LRUCache-b9228ca3.js";import"./MemCache-1d2f56ee.js";import"./arcgisLayerUrl-6e9db12f.js";import"./persistableUrlUtils-56d43b12.js";import"./TimeExtent-2004eecf.js";import"./ElevationInfo-88554f24.js";import"./fieldUtils-77ec75e2.js";import"./arcadeOnDemand-5175e7d9.js";import"./lengthUtils-92fed992.js";import"./opacityUtils-1333f803.js";import"./asyncUtils-087555fc.js";import"./Portal-51616380.js";import"./locale-30120714.js";import"./PortalGroup-d495847c.js";import"./PortalUser-e16fc7d1.js";import"./PortalItem-6eebfb2b.js";import"./assets-a5ce5e1a.js";import"./workers-5d67fe7a.js";import"./Connection-b756149d.js";import"./Queue-275a6362.js";import"./intl-70c09a3c.js";import"./number-2ab8ca0d.js";import"./messages-28bf3b89.js";class y extends A{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(n.forEach((e,r)=>{e===this&&n.delete(r)}),this.destroy())}}const n=new Map;function P(t=null){let e=n.get(T(t));return e||(m(t)?(e=new y(r=>t.schedule(r)),n.set(t,e)):(e=new y,n.set(null,e))),++e.ref,e}let o=class extends x(O(V(j($(E))))){constructor(...t){super(...t),this.copyright=null,this.heightModelInfo=null,this.path=null,this.minScale=void 0,this.maxScale=void 0,this.opacity=1,this.operationalLayerType="ArcGISTiledElevationServiceLayer",this.sourceJSON=null,this.type="elevation",this.url=null,this.version=null,this._lercDecoder=P()}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}destroy(){this._lercDecoder=S(this._lercDecoder)}readVersion(t,e){let r=e.currentVersion;return r||(r=9.3),r}load(t){const e=m(t)?t.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:r=>{for(let i=0;i<r.typeKeywords.length;i++)if(r.typeKeywords[i].toLowerCase()==="elevation 3d layer")return!0;throw new _("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},t).catch(I).then(()=>this._fetchImageService(e))),Promise.resolve(this)}fetchTile(t,e,r,i){const l=m((i=i||{signal:null}).signal)?i.signal:i.signal=new AbortController().signal,v={responseType:"array-buffer",signal:l},f={noDataValue:i.noDataValue,returnFileInfo:!0};return this.load().then(()=>this._fetchTileAvailability(t,e,r,i)).then(()=>c(this.getTileUrl(t,e,r),v)).then(p=>this._lercDecoder.decode(p.data,f,l)).then(p=>{var d;return{values:p.pixelData,width:p.width,height:p.height,maxZError:(d=p.fileInfo)==null?void 0:d.maxZError,noDataValue:p.noDataValue,minValue:p.minValue,maxValue:p.maxValue}})}getTileUrl(t,e,r){const i=!this.tilemapCache&&this.supportsBlankTile,l=w({...this.parsedUrl.query,blankTile:!i&&null});return`${this.parsedUrl.path}/tile/${t}/${e}/${r}${l?"?"+l:""}`}async queryElevation(t,e){const{ElevationQuery:r}=await h(()=>import("./ElevationQuery-7f8510d2.js"),["assets/ElevationQuery-7f8510d2.js","assets/asyncUtils-087555fc.js","assets/cast-a534ae90.js","assets/typedArrayUtil-d9bc5fbd.js","assets/string-480f3e3f.js","assets/Error-57322e92.js","assets/ensureType-25b8cc06.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-32d9c228.js","assets/unitUtils-dd6fb8ee.js","assets/jsonMap-190c5593.js","assets/Extent-a1a1de42.js","assets/Polyline-b571c705.js","assets/projection-0af97a56.js","assets/preload-helper-101896b7.js","assets/mathUtils-57aba1ea.js","assets/vec3-1863987c.js","assets/vec3f64-6cd30318.js","assets/common-c186b691.js","assets/vec4-46a9b36d.js","assets/SimpleObservable-8e532943.js","assets/mat4-7dde83b1.js","assets/assets-a5ce5e1a.js","assets/request-f17a8ddb.js","assets/aaBoundingRect-b340cf8c.js","assets/zscale-48bab05e.js","assets/geometry-eec1b371.js","assets/typeUtils-cd52dc20.js","assets/TileInfo-c5c8c8d2.js"]);return u(e),new r().query(this,t,e)}async createElevationSampler(t,e){const{ElevationQuery:r}=await h(()=>import("./ElevationQuery-7f8510d2.js"),["assets/ElevationQuery-7f8510d2.js","assets/asyncUtils-087555fc.js","assets/cast-a534ae90.js","assets/typedArrayUtil-d9bc5fbd.js","assets/string-480f3e3f.js","assets/Error-57322e92.js","assets/ensureType-25b8cc06.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-32d9c228.js","assets/unitUtils-dd6fb8ee.js","assets/jsonMap-190c5593.js","assets/Extent-a1a1de42.js","assets/Polyline-b571c705.js","assets/projection-0af97a56.js","assets/preload-helper-101896b7.js","assets/mathUtils-57aba1ea.js","assets/vec3-1863987c.js","assets/vec3f64-6cd30318.js","assets/common-c186b691.js","assets/vec4-46a9b36d.js","assets/SimpleObservable-8e532943.js","assets/mat4-7dde83b1.js","assets/assets-a5ce5e1a.js","assets/request-f17a8ddb.js","assets/aaBoundingRect-b340cf8c.js","assets/zscale-48bab05e.js","assets/geometry-eec1b371.js","assets/typeUtils-cd52dc20.js","assets/TileInfo-c5c8c8d2.js"]);return u(e),new r().createSampler(this,t,e)}_fetchTileAvailability(t,e,r,i){return this.tilemapCache?this.tilemapCache.fetchAvailability(t,e,r,i):Promise.resolve("unknown")}async _fetchImageService(t){var i;if(this.sourceJSON)return this.sourceJSON;const e={query:{f:"json",...this.parsedUrl.query},responseType:"json",signal:t},r=await c(this.parsedUrl.path,e);r.ssl&&(this.url=(i=this.url)==null?void 0:i.replace(/^http:/i,"https:")),this.sourceJSON=r.data,this.read(r.data,{origin:"service",url:this.parsedUrl})}get hasOverriddenFetchTile(){return!this.fetchTile.__isDefault__}};a([s({json:{read:{source:"copyrightText"}}})],o.prototype,"copyright",void 0),a([s({readOnly:!0,type:D})],o.prototype,"heightModelInfo",void 0),a([s({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],o.prototype,"path",void 0),a([s({type:["show","hide"]})],o.prototype,"listMode",void 0),a([s({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}},readOnly:!0})],o.prototype,"minScale",void 0),a([s({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}},readOnly:!0})],o.prototype,"maxScale",void 0),a([s({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],o.prototype,"opacity",void 0),a([s({type:["ArcGISTiledElevationServiceLayer"]})],o.prototype,"operationalLayerType",void 0),a([s()],o.prototype,"sourceJSON",void 0),a([s({json:{read:!1},value:"elevation",readOnly:!0})],o.prototype,"type",void 0),a([s(L)],o.prototype,"url",void 0),a([s()],o.prototype,"version",void 0),a([b("version",["currentVersion"])],o.prototype,"readVersion",null),o=a([g("esri.layers.ElevationLayer")],o),o.prototype.fetchTile.__isDefault__=!0;const Fe=o;export{Fe as default};
