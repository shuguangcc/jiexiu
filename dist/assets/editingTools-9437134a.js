import{e as d,y as _,n as Q,m as Ni,c as Ct,t as ot,R as Me,r as _e,S as Io,T as Sr,A as Go,s as Ws,l as Vo}from"./cast-a534ae90.js";import{r as h,t as g,o as ss,J as Zs,P as qs,e as C,i as q,s as k,h as St,v as zo,U as No,b as Fo}from"./typedArrayUtil-d9bc5fbd.js";import{l as I,a as Ho,h as ke,f as si,w as Os,U as _a}from"./reactiveUtils-5869e41a.js";import{a as Qs}from"./ensureType-25b8cc06.js";import{G as ko,o as B,e as D,z as te,s as me,x as ga,O as ue,r as U,_ as Se,u as z,F as ni,j as Uo,A as _t,g as W,S as Js,p as wr,P as Ei,U as jo,H as xr,v as Bo,T as Ks,q as Rt}from"./vec3-1863987c.js";import{n as M,r as V,t as ma,f as Oi}from"./vec3f64-6cd30318.js";import{i as Er,s as Yo,u as en,f as X,d as Or,g as Xo}from"./elevationInfoUtils-44cce436.js";import{x as Ar}from"./ElevationInfo-88554f24.js";import{i as we,p as ns,x as rs,d as fa,y as tn,l as an}from"./screenUtils-90993e16.js";import"./Error-57322e92.js";import{h as Tr}from"./string-480f3e3f.js";import{j as Wo}from"./asyncUtils-087555fc.js";import{f as Zo}from"./promiseUtils-32d9c228.js";import{d as qo,x as Qo,v as va,b as st,y as ya,j as Ai,c as Fi,e as Ca,f as Jo,m as Ko,l as el,a as Ti,g as Ya,p as sn,h as ta,D as tl}from"./automaticLengthMeasurementUtils-0fd27163.js";import{d as il,u as al,$ as os,Z as sl}from"./unitUtils-dd6fb8ee.js";import{b as Pr,r as re,v as ba,l as ti,A as nl,s as ft,o as As,a as nn,w as rn,j as on,f as rl,M as ol}from"./vec2-ab9f47bf.js";import{n as Lt,i as ll}from"./vec2f64-30dc1443.js";import{p as hl,m as cl}from"./Polyline-b571c705.js";import{u as dl}from"./messages-28bf3b89.js";import{l as K}from"./Color-af6e0c66.js";import"./widget-09d2e7af.js";import{L as pl,N as ul,O as ie,Q as pi,T as _l,U as Xa,V as gl,W as kt,C as ml,X as fl,Y as vl,_ as J,a0 as ln,a1 as yl,a2 as E,a3 as bl,a4 as Ts,a5 as Ml,a6 as Sl,a7 as Le,a8 as Si,a9 as wl,aa as li,ab as Qt,j as La,l as bt,ac as Ma,ad as xl,ae as Rr,af as El,ag as Ol,ah as Sa,ai as Ia,aj as hn,ak as Al,al as tt,am as cn,an as dn,k as Dr,ao as Tl,ap as Pl,aq as Rl,ar as Dl,as as $l,at as Cl,au as pn}from"./index-7dfdb274.js";import{w as It}from"./Extent-a1a1de42.js";import{w as $r,D as Ie,a as Ge,r as Ll}from"./vec4-46a9b36d.js";import{r as zt,t as Cr}from"./vec4f32-2f36231b.js";import{s as Lr,p as Ir,a as Gr,v as Vr,A as zr}from"./Octree-8ed6dc77.js";import{l as At,v as Pi,h as wa,m as Il,b as wi,M as Gl,B as Vl}from"./lineSegment-c6f0b9d1.js";import{R as zl,p as ls,d as Hi,h as Wa,c as S,e as ne,t as mt,g as Nl,i as un,j as Fl,o as _n}from"./sphere-622880b9.js";import{l as Ri}from"./ViewingMode-915d19cb.js";import{o as Hl}from"./glUtil-7aa58841.js";import{T as Nr}from"./InterleavedLayout-b5930508.js";import{e as it,a as gn,b as ki,o as Ui,t as ji,r as kl,c as N,d as Ul,E as Ps,S as jl,f as Oe,B as Bl,u as Yl,g as $,h as Xl,L as Fr,i as Hr,j as Wl,k as Zl,l as j,m as kr,n as Ur,p as jr,v as Rs,q as ql,s as Br,w as Ql,x as Yr,y as Xr,z as hs,A as Jl,C as Wr,D as Kl,F as eh,G as mn,H as th,I as ih,J as ah,K as sh}from"./SSAOHelper-868f5969.js";import{O}from"./VertexAttribute-9c5c630d.js";import{_ as Bi}from"./preload-helper-101896b7.js";import{c as xa,n as Zr,x as cs,i as Yi,s as nh,u as Be,r as ds,h as rh,R as Ds,g as qr,q as Ea,b as Qr,f as fn,I as vn,m as oh}from"./mat4-7dde83b1.js";import{e as ge,t as lh,o as hh}from"./mat4f64-fbeb2cd1.js";import{a as ch,o as he,f as ps,e as Dt,n as P,b as Xi,c as dh,t as ph}from"./ScreenSpacePass-6db805f2.js";import{n as uh,e as vt}from"./SSAO.glsl-3068f7bf.js";import{R as Ue,E as Jr,F as _h,I as pa}from"./enums-64ab819c.js";import{W as Wi,a as $s,_ as Zi,i as Ga,o as Xe,n as ee,c as gh,A as Kr,h as eo,b as to,E as io,d as mh,l as fh,e as vh,S as yh,f as bh}from"./OrderIndependentTransparency-68bd812c.js";import{E as Mh}from"./VertexArrayObject-3630ef4f.js";import{m as nt,a as Oa,i as Sh,b as Di}from"./mathUtils-57aba1ea.js";import{n as ao,r as We,e as Ut}from"./vec4f64-939de194.js";import{p as hi,_ as Nt,q as ri,Y as qi,H as wh}from"./plane-46a8c767.js";import{l as Cs,x as Ls,H as Ft,q as rt,o as xh,Q as Eh,m as Va,h as ci,b as Oh,a as Ah,c as je,r as us,e as Th,E as yn,s as Ph,T as Rh,d as bn,i as Dh,f as $h,g as bi,J as Ch,j as Za,v as Lh,k as Ih,F as Is,A as Gh,Z as $i,B as so,n as Vh,X as zh,C as _s,p as no}from"./NativeLineMaterial-b37d8d98.js";import{j as Aa,x as Nh,A as Fh,p as gs,g as Hh,X as kh,k as Uh}from"./projection-0af97a56.js";import{M as ms,a as ro,A as oo,p as jh,Y as Bh,Z as Yh}from"./aaBoundingBox-4a83dbbc.js";import{y as Xh,p as Wh,q as Zh}from"./colorUtils-82440b70.js";import{n as Ze}from"./Evented-cbf5f368.js";import{v as Qi}from"./dehydratedFeatures-3dcd65f1.js";import{s as qh}from"./Identifiable-093f90a8.js";import{i as Qh}from"./BufferView-478024d2.js";import{e as Jh}from"./Util-289ce3b5.js";import{Z as Kh,q as ec}from"./DrawGraphicTool-fda764ee.js";import{j as tc}from"./Collection-7c37b74e.js";import{a as lo,d as Gs}from"./HandleOwner-2edbba46.js";import"./geometry-eec1b371.js";import{n as ic}from"./compilerUtils-fefa73ae.js";import{a as Mn}from"./mat3-9a8d9db7.js";import{a as ac}from"./quatf64-c94bd656.js";import{F as sc,w as ho}from"./aaBoundingRect-b340cf8c.js";import{G as Jt,H as nc,X as ui}from"./boundedPlane-296928f6.js";import{C as rc}from"./GraphicManipulator-7a117f97.js";import{r as Ci,p as za,a as Vs,l as oc,c as lc,n as hc}from"./TranslateTooltipInfos-2bd19c7a.js";import{d as Sn}from"./utils-4aa03157.js";import{i as cc}from"./automaticAreaMeasurementUtils-065aa71f.js";import{r as dc,s as wn}from"./Cyclical-078b4564.js";import{g as pc,l as uc}from"./axisAngleDegrees-700f0205.js";import{i as _c}from"./Clonable-9b34e760.js";import{g as _i}from"./persistable-086be2f7.js";import{Q as xn}from"./quat-ec16a584.js";import{i as gc,p as mc}from"./ExtentTooltipInfos-ad414646.js";let fc=i=>({vnodeSelector:"",properties:void 0,children:void 0,text:i.toString(),domNode:null}),co=(i,e,t)=>{for(let a=0,s=e.length;a<s;a++){let n=e[a];Array.isArray(n)?co(i,n,t):n!=null&&n!==!1&&(typeof n=="string"&&(n=fc(n)),t.push(n))}};function vc(i,e,t){if(Array.isArray(e))t=e,e=void 0;else if(e&&(typeof e=="string"||e.hasOwnProperty("vnodeSelector"))||t&&(typeof t=="string"||t.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let a,s;return t&&t.length===1&&typeof t[0]=="string"?a=t[0]:t&&(s=[],co(i,t,s),s.length===0&&(s=void 0)),{vnodeSelector:i,properties:e,children:s,text:a===""?void 0:a,domNode:null}}const En={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let ae=class extends Ni{constructor(e){super(e),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor=new K([0,0,0,.6]),this.textColor=new K([255,255,255]),this._textShadowSize=1}get position(){return[this.x,this.y]}set position(e){this._set("x",e[0]),this._set("y",e[1])}get _textShadowColor(){return this.backgroundColor}get _textShadow(){const e=this._textShadowColor.toCss(!1);return`0 0 ${this._textShadowSize}px ${e}`}get _padding(){return .5*this.fontSize}get _borderRadius(){return this._padding}render(){return vc("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(e){if(!this.visible)return;const t=e.font.replace(/^(.*?)px/,"");e.font=`${this.fontSize}px ${t}`;const a=this._padding,s=this._borderRadius,n=e.measureText(this.text).width,r=this.fontSize,o=yc[this.anchor];e.textAlign="center",e.textBaseline="middle";const l=n+2*a,c=r+2*a,p=this.x+o.x*l,u=this.y+o.y*c;this._roundedRect(e,p,u,l,c,s),e.fillStyle=this.backgroundColor.toCss(!0),e.fill();const m=this.x+(o.x+.5)*l,f=this.y+(o.y+.5)*c;this._renderTextShadow(e,this.text,m,f),e.fillStyle=this.textColor.toCss(!0),e.fillText(this.text,m,f)}_renderTextShadow(e,t,a,s){e.lineJoin="miter",e.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/fs.length})`;const n=this._textShadowSize;for(const[r,o]of fs)e.fillText(t,a+n*r,s+n*o)}_roundedRect(e,t,a,s,n,r){e.beginPath(),e.moveTo(t,a+r),e.arcTo(t,a,t+r,a,r),e.lineTo(t+s-r,a),e.arcTo(t+s,a,t+s,a+r,r),e.lineTo(t+s,a+n-r),e.arcTo(t+s,a+n,t+s-r,a+n,r),e.lineTo(t+r,a+n),e.arcTo(t,a+n,t,a+n-r,r),e.closePath()}_cssClasses(){const e={"esri-text-overlay-item":!0};for(const t in En)e[En[t]]=this.anchor===t;return e}};d([_()],ae.prototype,"x",void 0),d([_()],ae.prototype,"y",void 0),d([_()],ae.prototype,"position",null),d([_()],ae.prototype,"text",void 0),d([_()],ae.prototype,"fontSize",void 0),d([_()],ae.prototype,"anchor",void 0),d([_()],ae.prototype,"visible",void 0),d([_()],ae.prototype,"backgroundColor",void 0),d([_()],ae.prototype,"textColor",void 0),d([_()],ae.prototype,"_textShadowSize",void 0),d([_()],ae.prototype,"_textShadowColor",null),d([_()],ae.prototype,"_textShadow",null),d([_()],ae.prototype,"_padding",null),d([_()],ae.prototype,"_borderRadius",null),ae=d([Q("esri.views.overlay.TextOverlayItem")],ae);const yc={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},fs=[];for(let e=0;e<360;e+=360/16)fs.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);const bc=ae,Mc=3025,Sc={default:15,far:25};let Ne=class extends Ni{constructor(e){super(e),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){const e=Wo(async a=>{const s=await dl("esri/core/t9n/Units");Zo(a),this._messagesUnits=s}),t=()=>ss(this.context,a=>a.editGeometryOperations);this.addHandles([I(()=>[h(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(a=>Ho(t,a,()=>this._update())),Ct(()=>e.abort())])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return g(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map(e=>e.label.text)}}get _edgeDistancePixels(){return Sc[this.edgeDistance]}_update(){this._nextLabelIndex=0;const e=this.context;if(g(e))return void this._destroyUnusedLabels();const{components:t,geometry:a,coordinateHelper:s}=e.editGeometryOperations.data;if(!a)return void this._destroyUnusedLabels();const n=t.length;for(let r=0;r<n;++r){const o=[];if(t[r].iterateVertices(f=>{o.push(s.toXYZ(f.pos))}),r===0&&h(this.stagedVertex)&&o.push(s.toXYZ(this.stagedVertex)),o.length<2)continue;const l=o[0],c=o[o.length-1];a.type==="polygon"&&o.length>2&&!ko(l,c)&&o.push(l);const p=n===1&&!hl(o,!1,!1);let u=wc,m=xc;this.toScreenPointArray(e,l,u);for(let f=1;f<o.length;++f){const v=o[f-1],b=o[f];this.toScreenPointArray(e,b,m),this._addLabel(e,v,u,b,m,p),[u,m]=[m,u]}}this._destroyUnusedLabels()}_addLabel(e,t,a,s,n,r){const{label:o}=this._getOrCreateLabel(e);if(!this.visible||Pr(a,n)<Mc)return void(o.visible=!1);const l=h(e.graphicState)?e.graphicState.isDraped?"on-the-ground":"absolute-height":Er(e.editGeometryOperations.data.geometry,e.elevationInfo),{spatialReference:c}=e.editGeometryOperations.data,p=qo(t,s,c,l),u=this._messagesUnits,m=il(e.view);o.text=h(u)&&h(p)?Qo(u,p,m):"",o.visible=!0;const f=n[0]-a[0],v=n[1]-a[1];r?re(Te,-v,f):re(Te,v,-f),ba(Te,Te),ti(Te,Te,this._edgeDistancePixels),nl(gi,a,n,.5),ft(gi,gi,Te),o.position=[gi[0],gi[1]],Math.abs(Te[0])>Math.abs(Te[1])?o.anchor=Te[0]>0?"left":"right":o.anchor=-Te[1]<0?"top":"bottom"}_getOrCreateLabel(e){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const t=new bc({fontSize:10,anchor:"center"});e.view.overlay.items.add(t);const a={label:t};return this._labelInfos.push(a),this._nextLabelIndex=this._labelInfos.length,a}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:e}){ss(this.context,t=>t.view.overlay.items.remove(e)),e.destroy()}};d([_()],Ne.prototype,"context",void 0),d([_()],Ne.prototype,"stagedVertex",void 0),d([_()],Ne.prototype,"visible",void 0),d([_()],Ne.prototype,"edgeDistance",void 0),d([_()],Ne.prototype,"updating",null),d([_()],Ne.prototype,"_messagesUnits",void 0),d([_()],Ne.prototype,"_edgeDistancePixels",null),Ne=d([Q("esri.views.interactive")],Ne);const Te=Lt(),gi=Lt(),wc=we(),xc=we();let Ta=class extends Ne{getCameraOrExtent({view:e}){return e.state.camera}toScreenPointArray({view:e,elevationInfo:t,editGeometryOperations:a},s,n=we()){const{spatialReference:r}=a.data.coordinateHelper;return pl(s,r,t,e,On),e.state.camera.projectToScreen(On,n),n}};Ta=d([Q("esri.views.3d.interactive.SegmentLabels3D")],Ta);const On=M();let po=class{constructor(e){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e,this._handle=I(()=>this.view.ready,t=>{this._resourcesCreated&&(t?this._createResources():this._destroyResources())})}applyProps(e){let t=!1;for(const a in e)a in this?a==="attached"?t=e[a]:this[a]=e[a]:console.error("Cannot set unknown property",a);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}};function uo(i,e){i.extensions.add("GL_OES_standard_derivatives");const t=i.fragment;t.include(ch),i.include(uh),t.uniforms.add([new he("globalAlpha",a=>a.globalAlpha),new it("glowColor",a=>a.glowColor),new he("glowWidth",(a,s)=>a.glowWidth*s.camera.pixelRatio),new he("glowFalloff",a=>a.glowFalloff),new it("innerColor",a=>a.innerColor),new he("innerWidth",(a,s)=>a.innerWidth*s.camera.pixelRatio),new ps("depthMap",(a,s)=>s.linearDepthTexture),new Dt("nearFar",(a,s)=>s.camera.nearFar),new ps("frameColor",(a,s)=>s.mainColorTexture)]),t.code.add(P`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),t.code.add(P`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),t.code.add(P`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),t.code.add(P`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),e.contrastControlEnabled?(t.uniforms.add(new he("globalAlphaContrastBoost",a=>h(a.globalAlphaContrastBoost)?a.globalAlphaContrastBoost:1)),t.code.add(P`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`)):t.code.add(P`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}function Ec(i){const e=new Xi;e.include(uo,i);const{vertex:t,fragment:a}=e;return t.uniforms.add([new gn("modelView",(s,n)=>xa(Ac,n.camera.viewMatrix,s.origin)),new gn("proj",(s,n)=>n.camera.projectionMatrix),new he("glowWidth",(s,n)=>s.glowWidth*n.camera.pixelRatio),new Dt("pixelToNDC",(s,n)=>re(Oc,2/n.camera.fullViewport[2],2/n.camera.fullViewport[3]))]),e.attributes.add(O.START,"vec3"),e.attributes.add(O.END,"vec3"),e.attributes.add(O.UP,"vec3"),e.attributes.add(O.EXTRUDE,"vec2"),e.varyings.add("uv","vec2"),e.varyings.add("vViewStart","vec3"),e.varyings.add("vViewEnd","vec3"),e.varyings.add("vViewPlane","vec4"),t.code.add(P`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = modelView * vec4(pos, 1);
vec4 projPos = proj * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (modelView * vec4(start, 1)).xyz;
vViewEnd = (modelView * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),a.uniforms.add(new he("perScreenPixelRatio",(s,n)=>n.camera.perScreenPixelRatio)),a.code.add(P`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),e}const Oc=Lt(),Ac=ge(),Tc=Object.freeze(Object.defineProperty({__proto__:null,build:Ec},Symbol.toStringTag,{value:"Module"}));let zs=class extends ki{initializeProgram(e){return new Ui(e.rctx,zs.shader.get().build(this.configuration),_o)}initializePipeline(){return Wi({blending:$s(Ue.ONE,Ue.ONE_MINUS_SRC_ALPHA),colorWrite:Zi})}};zs.shader=new ji(Tc,()=>Bi(()=>import("./LaserlinePath.glsl-5d452fae.js"),["assets/LaserlinePath.glsl-5d452fae.js","assets/mat4-7dde83b1.js","assets/vec3f64-6cd30318.js","assets/common-c186b691.js","assets/mat4f64-fbeb2cd1.js","assets/vec2-ab9f47bf.js","assets/vec2f64-30dc1443.js","assets/ScreenSpacePass-6db805f2.js","assets/typedArrayUtil-d9bc5fbd.js","assets/Error-57322e92.js","assets/string-480f3e3f.js","assets/VertexAttribute-9c5c630d.js","assets/vec4-46a9b36d.js","assets/vec4f64-939de194.js","assets/cast-a534ae90.js","assets/ensureType-25b8cc06.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-32d9c228.js","assets/reactiveUtils-5869e41a.js","assets/vec3-1863987c.js","assets/elevationInfoUtils-44cce436.js","assets/ElevationInfo-88554f24.js","assets/jsonMap-190c5593.js","assets/Extent-a1a1de42.js","assets/fieldUtils-77ec75e2.js","assets/preload-helper-101896b7.js","assets/arcadeOnDemand-5175e7d9.js","assets/geometry-eec1b371.js","assets/Polyline-b571c705.js","assets/typeUtils-cd52dc20.js","assets/lengthUtils-92fed992.js","assets/unitUtils-dd6fb8ee.js","assets/screenUtils-90993e16.js","assets/asyncUtils-087555fc.js","assets/automaticLengthMeasurementUtils-0fd27163.js","assets/intl-70c09a3c.js","assets/number-2ab8ca0d.js","assets/locale-30120714.js","assets/messages-28bf3b89.js","assets/request-f17a8ddb.js","assets/assets-a5ce5e1a.js","assets/index-7dfdb274.js","assets/Basemap-f70b1b37.js","assets/Collection-7c37b74e.js","assets/Evented-cbf5f368.js","assets/SimpleObservable-8e532943.js","assets/collectionUtils-0365f48b.js","assets/deprecate-0d93948c.js","assets/Loadable-46524a7e.js","assets/Promise-368b703a.js","assets/loadAll-01cdf0a9.js","assets/Portal-51616380.js","assets/PortalGroup-d495847c.js","assets/PortalUser-e16fc7d1.js","assets/PortalItem-6eebfb2b.js","assets/writeUtils-3bde6e49.js","assets/layerUtils-68eea656.js","assets/Color-af6e0c66.js","assets/colorUtils-639f4d25.js","assets/mathUtils-57aba1ea.js","assets/compilerUtils-fefa73ae.js","assets/enumeration-61a13175.js","assets/opacityUtils-1333f803.js","assets/CollectionFlattener-f43a0fce.js","assets/TablesMixin-a4aaaf91.js","assets/Layer-ead8c88c.js","assets/Identifiable-093f90a8.js","assets/Graphic-1859ae71.js","assets/PopupTemplate-52faab17.js","assets/Clonable-9b34e760.js","assets/symbols-75e7a993.js","assets/CIMSymbol-8f02a6e3.js","assets/Symbol-8266348e.js","assets/symbolLayerUtils3D-c8c40895.js","assets/aaBoundingBox-4a83dbbc.js","assets/aaBoundingRect-b340cf8c.js","assets/persistableUrlUtils-56d43b12.js","assets/jsonUtils-c6684c52.js","assets/Cyclical-078b4564.js","assets/workers-5d67fe7a.js","assets/Connection-b756149d.js","assets/Queue-275a6362.js","assets/projection-0af97a56.js","assets/zscale-48bab05e.js","assets/TileInfo-c5c8c8d2.js","assets/widget-09d2e7af.js","assets/uuid-73213768.js","assets/dom-5b7af1bf.js","assets/HandleOwner-2edbba46.js","assets/byteSizeEstimations-90c5a50d.js","assets/executeQueryJSON-0696009a.js","assets/normalizeUtils-6483f6b5.js","assets/query-71223310.js","assets/pbfQueryUtils-c922ef32.js","assets/pbf-8b0546e8.js","assets/OptimizedFeature-73582c6e.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-3c8de33a.js","assets/FeatureSet-9cc47aef.js","assets/Field-1d4f9ca4.js","assets/fieldType-b34e5d2d.js","assets/Query-13124a97.js","assets/TimeExtent-2004eecf.js","assets/RelationshipQuery-c27267ab.js","assets/LegendOptions-2e7b3d70.js","assets/utils-4aa03157.js","assets/BlendLayer-813950f9.js","assets/parser-01f6451e.js","assets/mat4f32-77b3d8ac.js","assets/ItemCache-bf1028d4.js","assets/MemCache-1d2f56ee.js","assets/utils-0c7f5071.js","assets/jsonUtils-559e9000.js","assets/UniqueValueRenderer-30750d31.js","assets/diffUtils-8a8cb5bc.js","assets/colorRamps-8d7efc14.js","assets/sizeVariableUtils-d4870b0d.js","assets/jsonUtils-eb568237.js","assets/styleUtils-015eeecd.js","assets/DictionaryLoader-326d0e17.js","assets/LRUCache-b9228ca3.js","assets/heatmapUtils-3d7c22c5.js","assets/featureConversionUtils-d2229ed4.js","assets/TopFeaturesQuery-9aca00bf.js","assets/FeatureLayer-9a7e04cf.js","assets/MultiOriginJSONSupport-b8792dfa.js","assets/LayerFloorInfo-e7c896e5.js","assets/FeatureLayerBase-d5682b4b.js","assets/HeightModelInfo-34f16d74.js","assets/arcgisLayerUrl-6e9db12f.js","assets/OperationalLayer-1dad72ac.js","assets/editsZScale-12d81957.js","assets/APIKeyMixin-b6e4f897.js","assets/ArcGISService-e571bcff.js","assets/CustomParametersMixin-a5d06ccc.js","assets/EditBusLayer-b5dc3689.js","assets/FeatureReductionLayer-1e5c4045.js","assets/labelingInfo-be3a629c.js","assets/labelUtils-4f4b54c6.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-9623e905.js","assets/PortalLayer-9dd15f09.js","assets/RefreshableLayer-49182ab8.js","assets/ScaleRangeLayer-c072e266.js","assets/TemporalLayer-f784dd83.js","assets/TimeInfo-f76d6c20.js","assets/FeatureTemplate-c4496b93.js","assets/FeatureType-0be9420b.js","assets/fieldProperties-9e220f14.js","assets/FieldsIndex-16707836.js","assets/versionUtils-f229b9a6.js","assets/styleUtils-08eaa4d2.js","assets/popupUtils-88fed094.js","assets/colorUtils-82440b70.js","assets/mat2d-d0b91e3e.js","assets/Scheduler-5e6ccc87.js","assets/GraphicsLayer-a7c6f685.js","assets/ViewingMode-915d19cb.js","assets/unitBezier-881ac1eb.js","assets/mat3-9a8d9db7.js","assets/mat3f32-d3d088e8.js","assets/vec2f32-461e65a9.js","assets/TileStrategy-a5366189.js","assets/TileStore-8f580dbf.js","assets/TileKey-9cae9369.js","assets/rbush-8e36784a.js","assets/quickselect-322ec8e1.js","assets/capabilities-d08b6e58.js","assets/context-util-d4c193b5.js","assets/Subtype-a3103d84.js","assets/datetime-4f774298.js","assets/QueryEngineResult-eb704fb1.js","assets/utils-52ad3c09.js","assets/generateRendererUtils-2f0b667c.js","assets/WhereClause-6c9440a1.js","assets/utils-63166b41.js","assets/json-48e3ea08.js","assets/Util-289ce3b5.js","assets/EffectView-dffeb0bc.js","assets/ExportImageParameters-3714ed4b.js","assets/sublayerUtils-eea48c01.js","assets/webStyleSymbolUtils-6bef877f.js","assets/devEnvironmentUtils-5002a058.js","assets/dehydratedFeatures-3dcd65f1.js","assets/enums-4b2a86a0.js","assets/plane-46a8c767.js","assets/sphere-622880b9.js","assets/quatf64-c94bd656.js","assets/quat-ec16a584.js","assets/index-a8abe695.css","assets/geometryEngine-0f4f9d5a.js","assets/geometryEngineBase-3dd302e0.js","assets/hydrated-00dd97bc.js","assets/vec4f32-2f36231b.js","assets/Octree-8ed6dc77.js","assets/lineSegment-c6f0b9d1.js","assets/glUtil-7aa58841.js","assets/enums-64ab819c.js","assets/VertexElementDescriptor-2925c6af.js","assets/InterleavedLayout-b5930508.js","assets/BufferView-478024d2.js","assets/types-e1c0a5bf.js","assets/SSAOHelper-868f5969.js","assets/OrderIndependentTransparency-68bd812c.js","assets/triangle-8cd02c5d.js","assets/Indices-d9b791ce.js","assets/requestImageUtils-f656eddc.js","assets/SSAO.glsl-3068f7bf.js","assets/Texture-411ca148.js","assets/VertexArrayObject-3630ef4f.js","assets/vec3f32-4322908d.js","assets/SSAOBlur.glsl-ea338452.js","assets/NativeLineMaterial-b37d8d98.js","assets/triangulationUtils-6b510de4.js","assets/earcut-58237617.js","assets/deduplicate-d92c3cc2.js","assets/NestedMap-1b5db22e.js","assets/floatRGBA-090399ba.js","assets/boundedPlane-296928f6.js","assets/DrawGraphicTool-fda764ee.js","assets/automaticAreaMeasurementUtils-065aa71f.js","assets/GraphicManipulator-7a117f97.js","assets/TranslateTooltipInfos-2bd19c7a.js","assets/axisAngleDegrees-700f0205.js","assets/persistable-086be2f7.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/ExtentTooltipInfos-ad414646.js"]));const _o=new Map([[O.START,0],[O.END,1],[O.UP,2],[O.EXTRUDE,3]]);let An=class{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=M(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=new Float64Array(3*e.length);let a=0;for(const s of e)t[a++]=s[0],t[a++]=s[1],t[a++]=s[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const t=this._buffers[0],a=3*Math.floor(t.length/3/2);B(this._origin,t[a+0],t[a+1],t[a+2])}else B(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);h(t)&&(e.bindVAO(t),e.drawArrays(Jr.TRIANGLES,0,this._count))}dispose(){h(this._vao)&&this._vao.dispose()}_ensureVAO(e){return g(this._buffers)?null:(g(this._vao)&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const a=this._createDataBuffer(t);return this._dirty=!1,new kl(e,_o,{data:Hl(Pn)},{data:Mh.createVertex(e,_h.STATIC_DRAW,a)})}_ensureVertexData(e,t){if(!this._dirty)return;const a=this._createDataBuffer(t);e.vertexBuffers.data.setData(a),this._dirty=!1}_numberOfRenderVertices(e){return 3*(2*(e.length/3-1))}_createDataBuffer(e){const t=e.reduce((o,l)=>o+this._numberOfRenderVertices(l),0);this._count=t;const a=Pn.createBuffer(t),s=this._origin;let n=0,r=0;for(const o of e){for(let l=0;l<o.length;l+=3){const c=B(Tn,o[l+0],o[l+1],o[l+2]);l===0?r=this._renderCoordsHelper.getAltitude(c):this._renderCoordsHelper.setAltitude(c,r);const p=this._renderCoordsHelper.worldUpAtPosition(c,Pc),u=n+2*l,m=D(Tn,c,s);if(l<o.length-3){a.up.setVec(u,p),a.up.setVec(u+3,p),a.up.setVec(u+5,p);for(let f=0;f<6;f++)a.start.setVec(u+f,m);a.extrude.setValues(u+0,0,-1),a.extrude.setValues(u+1,1,-1),a.extrude.setValues(u+2,1,1),a.extrude.setValues(u+3,0,-1),a.extrude.setValues(u+4,1,1),a.extrude.setValues(u+5,0,1)}if(l>0){a.up.setVec(u-2,p),a.up.setVec(u-4,p),a.up.setVec(u-5,p);for(let f=-6;f<0;f++)a.end.setVec(u+f,m)}}n+=this._numberOfRenderVertices(o)}return a.buffer}};const Pc=M(),Tn=M(),Pn=Nr().vec3f(O.START).vec3f(O.END).vec3f(O.UP).vec2f(O.EXTRUDE);let Ns=class extends Ul{constructor(){super(...arguments),this.contrastControlEnabled=!1}};d([N()],Ns.prototype,"contrastControlEnabled",void 0);const go=nt(6);function Rc(i){const e=new Xi;e.extensions.add("GL_OES_standard_derivatives"),e.include(dh),e.include(uo,i);const t=e.fragment;if(i.lineVerticalPlaneEnabled||i.heightManifoldEnabled)if(t.uniforms.add(new he("maxPixelDistance",(a,s)=>i.heightManifoldEnabled?2*s.camera.computeScreenPixelSizeAt(a.heightManifoldTarget):2*s.camera.computeScreenPixelSizeAt(a.lineVerticalPlaneSegment.origin))),t.code.add(P`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),i.spherical){const a=(n,r,o)=>ue(n,r.heightManifoldTarget,o.camera.viewMatrix),s=(n,r)=>ue(n,[0,0,0],r.camera.viewMatrix);t.uniforms.add([new vt("heightManifoldOrigin",(n,r)=>(a(He,n,r),s(Zt,r),D(Zt,Zt,He),te(be,Zt),be[3]=me(Zt),be)),new it("globalOrigin",(n,r)=>s(He,r)),new he("cosSphericalAngleThreshold",(n,r)=>1-Math.max(2,ga(r.camera.eye,n.heightManifoldTarget)*r.camera.perRenderPixelRatio)/me(n.heightManifoldTarget))]),t.code.add(P`float globeDistancePixels(float posInGlobalOriginLength) {
float dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}
float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
vec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);
float cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);
vec3 posInGlobalOrigin = globalOrigin - pos;
float posInGlobalOriginLength = length(posInGlobalOrigin);
float sphericalDistance = globeDistancePixels(posInGlobalOriginLength);
float planarDistance = planeDistancePixels(heightPlane, pos);
return cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;
}`)}else t.code.add(P`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
return planeDistancePixels(heightPlane, pos);
}`);if(i.pointDistanceEnabled&&(t.uniforms.add(new he("maxPixelDistance",(a,s)=>2*s.camera.computeScreenPixelSizeAt(a.pointDistanceTarget))),t.code.add(P`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`)),i.intersectsLineEnabled&&(t.uniforms.add(new he("perScreenPixelRatio",(a,s)=>s.camera.perScreenPixelRatio)),t.code.add(P`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`)),(i.lineVerticalPlaneEnabled||i.intersectsLineEnabled)&&t.code.add(P`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),t.code.add(P`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),i.heightManifoldEnabled){t.uniforms.add([new Dt("angleCutoff",s=>ia(s)),new vt("heightPlane",(s,n)=>mo(s.heightManifoldTarget,s.renderCoordsHelper.worldUpAtPosition(s.heightManifoldTarget,He),n.camera.viewMatrix))]);const a=i.spherical?P`normalize(globalOrigin - pos)`:P`heightPlane.xyz`;t.code.add(P`
    {
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, ${a})));
      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);
    }
    `)}return i.pointDistanceEnabled&&(t.uniforms.add([new Dt("angleCutoff",a=>ia(a)),new vt("pointDistanceSphere",(a,s)=>Dc(a,s))]),t.code.add(P`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`)),i.lineVerticalPlaneEnabled&&(t.uniforms.add([new Dt("angleCutoff",a=>ia(a)),new vt("lineVerticalPlane",(a,s)=>$c(a,s)),new it("lineVerticalStart",(a,s)=>Cc(a,s)),new it("lineVerticalEnd",(a,s)=>Lc(a,s))]),t.code.add(P`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`)),i.intersectsLineEnabled&&(t.uniforms.add([new Dt("angleCutoff",a=>ia(a)),new it("intersectsLineStart",(a,s)=>ue(He,a.lineStartWorld,s.camera.viewMatrix)),new it("intersectsLineEnd",(a,s)=>ue(He,a.lineEndWorld,s.camera.viewMatrix)),new it("intersectsLineDirection",(a,s)=>(U(be,a.intersectsLineSegment.vector),be[3]=0,te(He,$r(be,be,s.camera.viewMatrix)))),new he("intersectsLineRadius",a=>a.intersectsLineRadius)]),t.code.add(P`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`)),t.code.add(P`gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),e}function ia(i){return re(Ic,Math.cos(i.angleCutoff),Math.cos(Math.max(0,i.angleCutoff-nt(2))))}function Dc(i,e){return ue(qa,i.pointDistanceOrigin,e.camera.viewMatrix),qa[3]=ga(i.pointDistanceOrigin,i.pointDistanceTarget),qa}function $c(i,e){const t=At(i.lineVerticalPlaneSegment,.5,He),a=i.renderCoordsHelper.worldUpAtPosition(t,Gc),s=te(Zt,i.lineVerticalPlaneSegment.vector),n=Se(be,a,s);return te(n,n),mo(i.lineVerticalPlaneSegment.origin,n,e.camera.viewMatrix)}function Cc(i,e){const t=U(He,i.lineVerticalPlaneSegment.origin);return i.renderCoordsHelper.setAltitude(t,0),ue(t,t,e.camera.viewMatrix)}function Lc(i,e){const t=z(He,i.lineVerticalPlaneSegment.origin,i.lineVerticalPlaneSegment.vector);return i.renderCoordsHelper.setAltitude(t,0),ue(t,t,e.camera.viewMatrix)}function mo(i,e,t){return ue(Rn,i,t),U(be,e),be[3]=0,$r(be,be,t),Nt(Rn,be,Vc)}const Ic=Lt(),He=M(),be=ao(),Gc=M(),Zt=M(),Rn=M(),Vc=hi(),qa=zl(),zc=Object.freeze(Object.defineProperty({__proto__:null,defaultAngleCutoff:go,build:Rc},Symbol.toStringTag,{value:"Module"}));let Nc=class extends ph{constructor(){super(...arguments),this.innerColor=V(1,1,1),this.innerWidth=1,this.glowColor=V(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=nt(6),this.pointDistanceOrigin=M(),this.pointDistanceTarget=M(),this.lineVerticalPlaneSegment=Pi(),this.intersectsLineSegment=Pi(),this.intersectsLineRadius=3,this.heightManifoldTarget=M(),this.lineStartWorld=M(),this.lineEndWorld=M()}},Fs=class extends ki{initializeProgram(e){return new Ui(e.rctx,Fs.shader.get().build(this.configuration),Ps)}initializePipeline(){return Wi({blending:$s(Ue.ONE,Ue.ONE_MINUS_SRC_ALPHA),colorWrite:Zi})}};Fs.shader=new ji(zc,()=>Bi(()=>import("./Laserlines.glsl-0ae68b7f.js"),["assets/Laserlines.glsl-0ae68b7f.js","assets/mathUtils-57aba1ea.js","assets/vec3-1863987c.js","assets/vec3f64-6cd30318.js","assets/common-c186b691.js","assets/vec4-46a9b36d.js","assets/vec2-ab9f47bf.js","assets/vec2f64-30dc1443.js","assets/vec4f64-939de194.js","assets/lineSegment-c6f0b9d1.js","assets/sphere-622880b9.js","assets/string-480f3e3f.js","assets/typedArrayUtil-d9bc5fbd.js","assets/Error-57322e92.js","assets/mat4-7dde83b1.js","assets/nextTick-3ee5a785.js","assets/byteSizeEstimations-90c5a50d.js","assets/quatf64-c94bd656.js","assets/mat4f64-fbeb2cd1.js","assets/plane-46a8c767.js","assets/ScreenSpacePass-6db805f2.js","assets/VertexAttribute-9c5c630d.js","assets/cast-a534ae90.js","assets/ensureType-25b8cc06.js","assets/promiseUtils-32d9c228.js","assets/reactiveUtils-5869e41a.js","assets/elevationInfoUtils-44cce436.js","assets/ElevationInfo-88554f24.js","assets/jsonMap-190c5593.js","assets/Extent-a1a1de42.js","assets/fieldUtils-77ec75e2.js","assets/preload-helper-101896b7.js","assets/arcadeOnDemand-5175e7d9.js","assets/geometry-eec1b371.js","assets/Polyline-b571c705.js","assets/typeUtils-cd52dc20.js","assets/lengthUtils-92fed992.js","assets/unitUtils-dd6fb8ee.js","assets/screenUtils-90993e16.js","assets/asyncUtils-087555fc.js","assets/automaticLengthMeasurementUtils-0fd27163.js","assets/intl-70c09a3c.js","assets/number-2ab8ca0d.js","assets/locale-30120714.js","assets/messages-28bf3b89.js","assets/request-f17a8ddb.js","assets/assets-a5ce5e1a.js","assets/index-7dfdb274.js","assets/Basemap-f70b1b37.js","assets/Collection-7c37b74e.js","assets/Evented-cbf5f368.js","assets/SimpleObservable-8e532943.js","assets/collectionUtils-0365f48b.js","assets/deprecate-0d93948c.js","assets/Loadable-46524a7e.js","assets/Promise-368b703a.js","assets/loadAll-01cdf0a9.js","assets/Portal-51616380.js","assets/PortalGroup-d495847c.js","assets/PortalUser-e16fc7d1.js","assets/PortalItem-6eebfb2b.js","assets/writeUtils-3bde6e49.js","assets/layerUtils-68eea656.js","assets/Color-af6e0c66.js","assets/colorUtils-639f4d25.js","assets/compilerUtils-fefa73ae.js","assets/enumeration-61a13175.js","assets/opacityUtils-1333f803.js","assets/CollectionFlattener-f43a0fce.js","assets/TablesMixin-a4aaaf91.js","assets/Layer-ead8c88c.js","assets/Identifiable-093f90a8.js","assets/Graphic-1859ae71.js","assets/PopupTemplate-52faab17.js","assets/Clonable-9b34e760.js","assets/symbols-75e7a993.js","assets/CIMSymbol-8f02a6e3.js","assets/Symbol-8266348e.js","assets/symbolLayerUtils3D-c8c40895.js","assets/aaBoundingBox-4a83dbbc.js","assets/aaBoundingRect-b340cf8c.js","assets/persistableUrlUtils-56d43b12.js","assets/jsonUtils-c6684c52.js","assets/Cyclical-078b4564.js","assets/workers-5d67fe7a.js","assets/Connection-b756149d.js","assets/Queue-275a6362.js","assets/projection-0af97a56.js","assets/zscale-48bab05e.js","assets/TileInfo-c5c8c8d2.js","assets/widget-09d2e7af.js","assets/uuid-73213768.js","assets/dom-5b7af1bf.js","assets/HandleOwner-2edbba46.js","assets/executeQueryJSON-0696009a.js","assets/normalizeUtils-6483f6b5.js","assets/query-71223310.js","assets/pbfQueryUtils-c922ef32.js","assets/pbf-8b0546e8.js","assets/OptimizedFeature-73582c6e.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-3c8de33a.js","assets/FeatureSet-9cc47aef.js","assets/Field-1d4f9ca4.js","assets/fieldType-b34e5d2d.js","assets/Query-13124a97.js","assets/TimeExtent-2004eecf.js","assets/RelationshipQuery-c27267ab.js","assets/LegendOptions-2e7b3d70.js","assets/utils-4aa03157.js","assets/BlendLayer-813950f9.js","assets/parser-01f6451e.js","assets/mat4f32-77b3d8ac.js","assets/ItemCache-bf1028d4.js","assets/MemCache-1d2f56ee.js","assets/utils-0c7f5071.js","assets/jsonUtils-559e9000.js","assets/UniqueValueRenderer-30750d31.js","assets/diffUtils-8a8cb5bc.js","assets/colorRamps-8d7efc14.js","assets/sizeVariableUtils-d4870b0d.js","assets/jsonUtils-eb568237.js","assets/styleUtils-015eeecd.js","assets/DictionaryLoader-326d0e17.js","assets/LRUCache-b9228ca3.js","assets/heatmapUtils-3d7c22c5.js","assets/featureConversionUtils-d2229ed4.js","assets/TopFeaturesQuery-9aca00bf.js","assets/FeatureLayer-9a7e04cf.js","assets/MultiOriginJSONSupport-b8792dfa.js","assets/LayerFloorInfo-e7c896e5.js","assets/FeatureLayerBase-d5682b4b.js","assets/HeightModelInfo-34f16d74.js","assets/arcgisLayerUrl-6e9db12f.js","assets/OperationalLayer-1dad72ac.js","assets/editsZScale-12d81957.js","assets/APIKeyMixin-b6e4f897.js","assets/ArcGISService-e571bcff.js","assets/CustomParametersMixin-a5d06ccc.js","assets/EditBusLayer-b5dc3689.js","assets/FeatureReductionLayer-1e5c4045.js","assets/labelingInfo-be3a629c.js","assets/labelUtils-4f4b54c6.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-9623e905.js","assets/PortalLayer-9dd15f09.js","assets/RefreshableLayer-49182ab8.js","assets/ScaleRangeLayer-c072e266.js","assets/TemporalLayer-f784dd83.js","assets/TimeInfo-f76d6c20.js","assets/FeatureTemplate-c4496b93.js","assets/FeatureType-0be9420b.js","assets/fieldProperties-9e220f14.js","assets/FieldsIndex-16707836.js","assets/versionUtils-f229b9a6.js","assets/styleUtils-08eaa4d2.js","assets/popupUtils-88fed094.js","assets/colorUtils-82440b70.js","assets/mat2d-d0b91e3e.js","assets/Scheduler-5e6ccc87.js","assets/GraphicsLayer-a7c6f685.js","assets/ViewingMode-915d19cb.js","assets/unitBezier-881ac1eb.js","assets/mat3-9a8d9db7.js","assets/mat3f32-d3d088e8.js","assets/vec2f32-461e65a9.js","assets/TileStrategy-a5366189.js","assets/TileStore-8f580dbf.js","assets/TileKey-9cae9369.js","assets/rbush-8e36784a.js","assets/quickselect-322ec8e1.js","assets/capabilities-d08b6e58.js","assets/context-util-d4c193b5.js","assets/Subtype-a3103d84.js","assets/datetime-4f774298.js","assets/QueryEngineResult-eb704fb1.js","assets/utils-52ad3c09.js","assets/generateRendererUtils-2f0b667c.js","assets/WhereClause-6c9440a1.js","assets/utils-63166b41.js","assets/json-48e3ea08.js","assets/Util-289ce3b5.js","assets/EffectView-dffeb0bc.js","assets/ExportImageParameters-3714ed4b.js","assets/sublayerUtils-eea48c01.js","assets/webStyleSymbolUtils-6bef877f.js","assets/devEnvironmentUtils-5002a058.js","assets/dehydratedFeatures-3dcd65f1.js","assets/enums-4b2a86a0.js","assets/quat-ec16a584.js","assets/index-a8abe695.css","assets/geometryEngine-0f4f9d5a.js","assets/geometryEngineBase-3dd302e0.js","assets/hydrated-00dd97bc.js","assets/vec4f32-2f36231b.js","assets/Octree-8ed6dc77.js","assets/glUtil-7aa58841.js","assets/enums-64ab819c.js","assets/VertexElementDescriptor-2925c6af.js","assets/InterleavedLayout-b5930508.js","assets/BufferView-478024d2.js","assets/types-e1c0a5bf.js","assets/SSAOHelper-868f5969.js","assets/OrderIndependentTransparency-68bd812c.js","assets/triangle-8cd02c5d.js","assets/Indices-d9b791ce.js","assets/requestImageUtils-f656eddc.js","assets/SSAO.glsl-3068f7bf.js","assets/Texture-411ca148.js","assets/VertexArrayObject-3630ef4f.js","assets/vec3f32-4322908d.js","assets/SSAOBlur.glsl-ea338452.js","assets/NativeLineMaterial-b37d8d98.js","assets/triangulationUtils-6b510de4.js","assets/earcut-58237617.js","assets/deduplicate-d92c3cc2.js","assets/NestedMap-1b5db22e.js","assets/floatRGBA-090399ba.js","assets/boundedPlane-296928f6.js","assets/DrawGraphicTool-fda764ee.js","assets/automaticAreaMeasurementUtils-065aa71f.js","assets/GraphicManipulator-7a117f97.js","assets/TranslateTooltipInfos-2bd19c7a.js","assets/axisAngleDegrees-700f0205.js","assets/persistable-086be2f7.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/ExtentTooltipInfos-ad414646.js"]));let qt=class extends Ns{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}};d([N()],qt.prototype,"heightManifoldEnabled",void 0),d([N()],qt.prototype,"pointDistanceEnabled",void 0),d([N()],qt.prototype,"lineVerticalPlaneEnabled",void 0),d([N()],qt.prototype,"intersectsLineEnabled",void 0),d([N()],qt.prototype,"spherical",void 0);let Fc=class{constructor(e,t={contrastControlEnabled:!1}){this._config=t,this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._viewingMode=Ri.Local,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._passParameters=jl(e,new Nc)}get renderSlots(){return[this._config.contrastControlEnabled?Oe.LASERLINES_CONTRAST_CONTROL:Oe.LASERLINES]}get needsLinearDepth(){return!0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){U(this._passParameters.heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){U(this._passParameters.pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){U(this._passParameters.pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){wa(e,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){wa(e,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(e){e!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get viewingMode(){return this._viewingMode}set viewingMode(e){e!==this._viewingMode&&(this._viewingMode=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,h(this._pathVerticalPlaneData)&&this._requestRender())}set pathVerticalPlaneVertices(e){g(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new An(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){g(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new An(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(e){Bl(this._passParameters,e)&&this._requestRender()}initializeRenderContext(e){this._context=e;const t=e.renderContext.rctx;this._quadVAO=Yl(t),this._techniqueRepository=e.shaderTechniqueRepository,this._techniqueConfig=new qt;const a=new Ns;a.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(zs,a)}uninitializeRenderContext(){this._quadVAO=Zs(this._quadVAO),this._technique=qs(this._technique),this._pathVerticalPlaneData=Zs(this._pathVerticalPlaneData),this._pathTechnique=qs(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._techniqueConfig.spherical=this._viewingMode===Ri.Global,this._technique=this._techniqueRepository.releaseAndAcquire(Fs,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}render(e,t){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(e,t),this.pathVerticalPlaneEnabled&&this._renderPath(e)}_renderUnified(e,t){const a=e.rctx;this._updatePassParameters(e),a.bindTechnique(t,this._passParameters,e.bindParameters),a.bindVAO(this._quadVAO),a.drawArrays(Jr.TRIANGLE_STRIP,0,4)}_renderPath(e){if(g(this._pathVerticalPlaneData)||g(this._pathTechnique))return;const t=e.rctx,a=this._pathTechnique;t.bindTechnique(a,{...this._passParameters,origin:this._pathVerticalPlaneData.origin},e.bindParameters),this._pathVerticalPlaneData.draw(e.rctx)}_updatePassParameters(e){if(!this._intersectsLineEnabled)return;const t=e.bindParameters.camera;if(this._intersectsLineInfinite){if(Ir(ls(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),mi),mi.c0=-Number.MAX_VALUE,!Gr(t.frustum,mi))return;Vr(mi,this._passParameters.lineStartWorld),zr(mi,this._passParameters.lineEndWorld)}else U(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),z(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}};const mi=Lr();let Li=class extends po{constructor(e){super(e.view),this._angleCutoff=go,this._style={},this._heightManifoldTarget=M(),this._heightManifoldEnabled=!1,this._intersectsLine=Pi(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(e)}get testData(){return this._renderer}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){h(e)?(U(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(g(e))return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,Hc);this.intersectsLine=Il(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){h(e)?(wa(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=h(e)?wa(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=h(e)?{origin:ma(e.origin),target:ma(e.target)}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||h(this._pointDistanceLine)||h(this._pathVerticalPlaneBuffers))?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){h(this._renderer)||(this._renderer=new Fc({renderCoordsHelper:this.view.renderCoordsHelper},{contrastControlEnabled:!0}),this._renderer.viewingMode=this.view.state.viewingMode,this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer.renderSlots,this._renderer))}_syncStyle(){g(this._renderer)||(this._renderer.setParameters(this._style),this._style.intersectsLineRadius!=null&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){g(this._renderer)||this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){g(this._renderer)||(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){g(this._renderer)||(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){g(this._renderer)||(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){g(this._renderer)||(this._renderer.pathVerticalPlaneEnabled=h(this._pathVerticalPlaneBuffers)&&this.visible,h(this._pathVerticalPlaneBuffers)&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){g(this._renderer)||(this._renderer.lineVerticalPlaneEnabled=h(this._lineVerticalPlaneSegment)&&this.visible,h(this._lineVerticalPlaneSegment)&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){g(this._renderer)||(this._renderer.pointDistanceEnabled=h(this._pointDistanceLine)&&this.visible,h(this._pointDistanceLine)&&(this._renderer.pointDistanceOrigin=this._pointDistanceLine.origin,this._renderer.pointDistanceTarget=this._pointDistanceLine.target))}_disposeRenderer(){h(this._renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}};const Hc=M();let Na=class extends po{constructor(e){super(e.view),this._resources=null,this._transform=ge()}get object(){return h(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(e){Zr(this._transform,e),h(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(g(this._resources))return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new Cs({isPickable:!1,updatePolicy:Ga.SYNC});e.add(t);const a=new Ls({castShadow:!1});a.transformation=this._transform,this.createExternalResources(),this.createGeometries(a),e.addMany(a.geometries),this.forEachExternalMaterial(s=>e.add(s)),e.add(a),t.add(a),this.visible||a.setVisible(!1),this._resources={layer:t,object:a}}destroyResources(){const e=this.view._stage;!g(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial(t=>{e.remove(t),t.dispose()}),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){g(this._resources)||this._resources.object.setVisible(e)}},Fa=class extends Na{constructor(e){super(e),this._ray=Hi(),this._externalResources=null,this._handles=new ot,this._isWorldDown=!1,this._start=M(),this._end=V(1,0,0),this._width=1,this._color=zt(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=zt(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=ye.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=$.OccludeAndTransparent,this._fadedExtensions=Cn,this.applyProps(e)}createExternalResources(){const e=new Ft(this.materialParameters);this._handles.add(I(()=>this.view.state.camera,()=>{this._updateGeometry()}));const t=new Li({view:this.view,attached:this._laserlineEnabled});this._externalResources={material:e,laserline:t}}destroyExternalResources(){h(this._externalResources)&&this._externalResources.laserline.destroy(),this._externalResources=null,this._handles.removeAll()}forEachExternalMaterial(e){h(this._externalResources)&&e(this._externalResources.material)}createGeometries(e){const t=[M(),M()],a=this.extensionType===ye.FADED;a&&t.push(M(),M());const s=a?new Float32Array([1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]):null,n=rt(t,null,s);e.addGeometry(n,C(this._externalResources).material),this._updateVertices(e)}updateVisibility(e){super.updateVisibility(e),h(this._externalResources)&&(this._externalResources.laserline.visible=e)}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,U(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),D(this._end,e,this._end),Wa(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,ni(this._start,e)||(U(this._start,e),Wa(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,ni(this._end,e)||(U(this._end,e),Wa(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Ie(e,this._color)||(Ge(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Ie(e,this._innerColor)||(Ge(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=h(e)!==h(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){(g(e)||g(this._stippleOffColor)||!Ie(e,this._stippleOffColor))&&(this._stippleOffColor=h(e)?Cr(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this._updateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&h(this._laserlineStyle)}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,h(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached,h(e)&&(this._externalResources.laserline.style=e))}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,h(this._externalResources)&&(this._externalResources.laserline.attached=this._laserlineAttached))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=q(e,Cn),this.recreateGeometry()}_updateMaterial(){g(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateGeometry(){h(this.object)&&this._updateVertices(this.object)}_updateVertices(e){const t=this._extensionType===ye.FADED?this._updateLineSegmentFinite(Dn):this._updateLineSegmentInfinite(this._extensionType,Dn);this._updateVertexAttributes(e,t),h(this._externalResources)&&(this._externalResources.laserline.intersectsLine=t)}_updateLineSegmentFinite(e){return wi(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const a=this.view.state.camera;switch(Ir(this._ray,dt),e){case ye.LINE:dt.c0=-Number.MAX_VALUE;break;case ye.RAY:case ye.GROUND_RAY:{const r=this._ray.origin,o=q(this.view.elevationProvider.getElevation(r[0],r[1],r[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),l=this.view.renderCoordsHelper.getAltitude(r);this._isWorldDown&&l<o&&Uo(dt.ray.direction,dt.ray.direction),this._extensionType===ye.GROUND_RAY&&o!=null&&(dt.c1=Math.abs(l-o));break}}if(!Gr(a.frustum,dt))return wi(this._start,this._end,t);const s=Vr(dt,wt),n=zr(dt,kc);return wi(s,n,t)}_updateVertexAttributes(e,t){const a=e.geometries[0].getMutableAttribute(O.POSITION).data;if(this.extensionType===ye.FADED){const s=At(t,-this.fadedExtensions.start,wt);a[0]=s[0],a[1]=s[1],a[2]=s[2];const n=At(t,0,wt);a[3]=n[0],a[4]=n[1],a[5]=n[2];const r=At(t,1,wt);a[6]=r[0],a[7]=r[1],a[8]=r[2];const o=At(t,1+this.fadedExtensions.end,wt);a[9]=o[0],a[10]=o[1],a[11]=o[2]}else{const s=At(t,0,wt);a[0]=s[0],a[1]=s[1],a[2]=s[2];const n=At(t,1,wt);a[3]=n[0],a[4]=n[1],a[5]=n[2]}e.geometryVertexAttrsUpdated(e.geometryRecords[0])}};const dt=Lr(),wt=M(),kc=M(),Dn=Pi();var ye;(function(i){i[i.LINE=0]="LINE",i[i.RAY=1]="RAY",i[i.GROUND_RAY=2]="GROUND_RAY",i[i.FADED=3]="FADED"})(ye||(ye={}));const $n=1/3,Cn={start:$n,end:$n};let Uc=class extends Na{constructor(e){super(e),this._handles=new ot,this._location=M(),this._direction=V(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=zt(1,0,1,1),this._renderOccluded=$.OccludeAndTransparent,this.applyProps(e)}get location(){return this._location}set location(e){ni(this._location,e)||(U(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){ni(this._direction,e)||(U(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){te(this._direction,D(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){Ie(e,this._color)||(Ge(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}createExternalResources(){const e=new Ft(this.materialParameters);this._handles.add(I(()=>this.view.state.camera,()=>{this._updateGeometry()})),this._externalResources={material:e}}destroyExternalResources(){this._handles.removeAll(),this._externalResources=null}createGeometries(e){const t=rt([M(),M()]),a=rt([M(),M()]),s=C(this._externalResources).material;e.addGeometry(t,s),e.addGeometry(a,s),this._updateVertices(e)}forEachExternalMaterial(e){h(this._externalResources)&&e(this._externalResources.material)}_updateMaterial(){g(this._externalResources)||this._externalResources.material.setParameters(this.materialParameters)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){const e=this.object;g(e)||this._updateVertices(e)}_updateVertices(e){const t=this.view.state.camera;t.projectToScreen(this.location,aa),z(ze,this.location,this.direction),t.projectToScreen(ze,jt),ba(jt,As(jt,jt,aa)),this._updateVertexAttributes(t,e,0,aa,jt,1),this._updateVertexAttributes(t,e,1,aa,jt,-1)}_updateVertexAttributes(e,t,a,s,n,r){const o=t.geometryRecords[a],l=o.geometry.getMutableAttribute(O.POSITION).data,c=ti(Ln,re(Ln,n[1]*r,n[0]*-r),this.offset+this.width/2),p=ft(sa,ft(sa,ft(sa,s,ti(sa,n,this.length/2)),c),c),u=ft(In,p,ti(In,n,-this.length));e.unprojectFromScreen(p,ze),l[0]=ze[0],l[1]=ze[1],l[2]=ze[2],e.unprojectFromScreen(u,ze),l[3]=ze[0],l[4]=ze[1],l[5]=ze[2],t.geometryVertexAttrsUpdated(o)}};const ze=M(),aa=we(),jt=we(),Ln=we(),sa=we(),In=we();let fo=class{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return h(this._resources)?this._resources.object:null}get resources(){return h(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(g(this._resources)||!e)return;const t=this._resources.object;this._resources.external.forEach(s=>{s.type===Xl.Geometry&&e.remove(s)}),t.removeAllGeometries();const a=this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer);e.addMany(a)}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,a=t._stage;if(!a)return;const s=new Cs({isPickable:!1,updatePolicy:Ga.SYNC});a.add(s);const n=new Ls({castShadow:!1}),r=e.createResources(n,s);r.forEach(l=>{a.add(l),l instanceof Fr&&a.loadImmediate(l)}),a.add(n),s.add(n);const o=e.cameraChanged?I(()=>t.state.camera,l=>e.cameraChanged(l),ke):null;this._resources={layer:s,object:n,external:r,cameraHandle:o},this._syncVisible()}_destroyResources(){if(g(this._resources))return;const e=this._resourceFactory.view._stage;e==null||e.remove(this._resources.object),e==null||e.remove(this._resources.layer),this._resources.external.forEach(t=>{e==null||e.remove(t),"dispose"in t&&t.dispose()}),this._resources.object.dispose(),this._resources.cameraHandle&&this._resources.cameraHandle.remove(),this._resources=null}_syncVisible(){g(this._resources)||this._resources.object.setVisible(this._visible)}},vs=class{constructor(e){this.view=null,this._geometry=null,this._size=3,this._color=We(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=We(1,1,1,1),this._elevationInfo=null,this._resources=new fo({view:e.view,createResources:a=>this._createResources(a),recreateGeometry:(a,s)=>(a.geometry=this._recreateGeometry(s,a.material),h(a.geometry)?[a.geometry]:[])});let t=!0;for(const a in e)a in this?a==="attached"?t=e[a]:this[a]=e[a]:console.error("Cannot set unknown property",a);this.attached=t}destroy(){this._resources.destroy()}get visible(){return this._resources.visible}set visible(e){this._resources.visible=e}get attached(){return this._resources.attached}set attached(e){this._resources.attached=e}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._resources.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?h(this._resources)&&this._resources.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){Ie(e,this._color)||(Ge(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,h(this._resources)&&this._resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Ie(e,this._outlineColor)||(Ge(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._resources&&this._resources.recreateGeometry()}_updateMaterial(){const e=this._resources.resources;g(e)||e.material.setParameters(this._materialParameters(e.texture.id))}_updateSizeAttribute(){const e=this._resources.resources,t=this._resources.object;if(g(e)||g(t))return;const a=e.geometry;if(g(a))return;const s=a.getMutableAttribute(O.SIZE).data,n=this._geometrySize;s[0]=n,s[1]=n,t.geometryVertexAttrsUpdated(t.geometryRecords[0])}_materialParameters(e){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:jc,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:e,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get _geometrySize(){return this._size/Mi}_recreateGeometry(e,t){const a=this._createRenderGeometry();return h(a)&&e.addGeometry(a,t),a}_createResources(e){const t=xh(this._primitive,this._preferredTextureSize),a=new Eh(this._materialParameters(t.id)),s=this._recreateGeometry(e,a);return{material:a,texture:t,geometry:s,forEach(n){n(t),n(a),h(this.geometry)&&n(this.geometry)}}}get _preferredTextureSize(){return Oa(Sh(2*this._geometrySize),16,128)}calculateMapBounds(e){if(g(this._resources.resources)||g(this._resources.resources.geometry))return!1;const t=this._resources.resources.geometry.vertexAttributes.get(O.POSITION);return Aa(t.data,this.view.renderCoordsHelper.spatialReference,Gn,this.view.spatialReference),ms(e,Gn),!0}_createRenderGeometry(){const e=this.geometry;if(g(e))return null;const{renderCoordsHelper:t,elevationProvider:a}=this.view,s=Va(e,a,ci.fromElevationInfo(this.elevationInfo),t),n=B(S.get(),e.x,e.y,s),r=S.get();Aa(n,e.spatialReference,r,t.spatialReference);const o=this._geometrySize;return Oh(null,r,null,[o,o],[0,0,0,1])}};const Mi=Ah,jc=[Mi/2,Mi/2,1-Mi/2,1-Mi/2],Gn=M();let Bc=class extends Na{constructor(e){super(e),this._handles=new ot,this._quadMaterial=null,this._outlineMaterial=null,this._maxSize=0,this._position=M(),this._up=M(),this._right=M(),this._renderOccluded=$.OccludeAndTransparent,this._color=zt(1,0,0,1),this._outlineColor=zt(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=$.Opaque,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){Ge(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){Ge(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=this._outlineSize===0!=(e===0);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry({previous:e,center:t,next:a}){this._maxSize=Math.min(ga(t,e),ga(t,a))/3,te(this._up,D(this._up,e,t)),te(this._right,D(this._right,a,t)),U(this._position,t),this.recreateGeometry()}createExternalResources(){this._quadMaterial=new je(this._quadMaterialParameters),this._outlineMaterial=new Ft(this._outlineMaterialParameters),this._handles.add(I(()=>this.view.state.camera,()=>this._updateTransform()))}destroyExternalResources(){this._quadMaterial=null,this._outlineMaterial=null,this._handles.removeAll()}forEachExternalMaterial(e){e(this._quadMaterial),e(this._outlineMaterial)}createGeometries(e){ni(this._up,Oi)&&ni(this._right,Oi)||(this._createQuadGeometry(e),this._createOutlineGeometry(e),this._updateTransform(e))}_createQuadGeometry(e){const t=this._quadGeometryData(this._up,this._right);e.addGeometry(t,this._quadMaterial)}_createOutlineGeometry(e){if(this._outlineSize===0)return;const t=z(S.get(),this._up,this._right),a=rt([this._up,t,this._right]);e.addGeometry(a,this._outlineMaterial)}_updateTransform(e=this.object){const t=this.view.state.camera,a=this._size*t.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,a);cs(na,this._position),Yi(na,na,[s,s,s]),h(e)&&(e.transformation=na)}_quadGeometryData(e,t){const a=z(S.get(),e,t);return new Hr([[O.POSITION,{size:3,data:[0,0,0,...t,...e,...a],exclusive:!0}]],[[O.POSITION,[0,1,2,1,2,3]]])}get _quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){this._quadMaterial&&this._quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){this._outlineMaterial&&this._outlineMaterial.setParameters(this._outlineMaterialParameters)}};const na=ge();let Ii=class extends ul{visualizeIntersectionPoint(e,t){const{coordinateHelper:a,view:s}=t;return Me(new vs({view:s,primitive:"circle",geometry:a.vectorToPoint(e.intersectionPoint),elevationInfo:q(e.elevationInfo,t.elevationInfo),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:K.toUnitRGBA(ie.orange),pixelSnappingEnabled:!1}))}visualizePoint(e,t){const{view:a,coordinateHelper:s}=t,n=this._alignPoint(e.point,e.domain,t);return Me(new vs({view:a,primitive:"circle",geometry:s.vectorToPoint(n),elevationInfo:this._hintElevationInfo(e,t),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:K.toUnitRGBA(ie.orange),pixelSnappingEnabled:!1}))}visualizeLine(e,t){const{view:a,coordinateHelper:s}=t,n=this._alignPoint(e.lineStart,e.domain,t),r=this._alignPoint(e.lineEnd,e.domain,t);return Me(this._createLineSegmentHintFromMap(e.type,n,r,s,this._hintElevationInfo(e,t),a,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:a,coordinateHelper:s}=t,n=this._hintElevationInfo(e,t),r=this._alignPoint(e.lineStart,e.domain,t),o=this._alignPoint(e.lineEnd,e.domain,t),l=pi(r,s,n,a),c=pi(o,s,n,a),p=_t(c,l,c,.5),u=new Uc({view:a,attached:!1,offset:ie.parallelLineHintOffset,length:ie.parallelLineHintLength,width:ie.parallelLineHintWidth,color:K.toUnitRGBA(ie.orange),location:p,renderOccluded:$.Opaque});return u.setDirectionFromPoints(l,p),u.attached=!0,Me(u)}visualizeRightAngleQuad(e,t){const{view:a,coordinateHelper:s}=t,n=this._hintElevationInfo(e,t),r=this._alignPoint(e.previousVertex,e.domain,t),o=this._alignPoint(e.centerVertex,e.domain,t),l=this._alignPoint(e.nextVertex,e.domain,t);return Me(new Bc({view:a,attached:!0,color:K.toUnitRGBA(ie.orange),renderOccluded:$.Transparent,outlineRenderOccluded:$.Opaque,outlineColor:K.toUnitRGBA(ie.orange),outlineSize:ie.rightAngleHintOutlineSize,size:ie.rightAngleHintSize,geometry:{previous:pi(r,s,n,a),center:pi(o,s,n,a),next:pi(l,s,n,a)}}))}_createLineSegmentHintFromMap(e,t,a,s,n,r,o=!0,l=!0){const c=M(),p=M();return _l(t,a,s,n,r,c,p),this._createLineSegmentHint(e,r,c,p,o,l)}_createLineSegmentHint(e,t,a,s,n=!0,r=!0){const o=new Fa({view:t,extensionType:ye.FADED,start:a,end:s,color:K.toUnitRGBA(ie.orange),renderOccluded:$.Opaque});switch(e){case Xa.TARGET:o.width=ie.lineHintWidthTarget,o.fadedExtensions={start:0,end:ie.lineHintFadedExtensions};break;case Xa.REFERENCE_EXTENSION:o.width=ie.lineHintWidthReference,o.fadedExtensions={start:0,end:0};break;case Xa.REFERENCE:o.width=ie.lineHintWidthReference,o.fadedExtensions={start:n?ie.lineHintFadedExtensions:0,end:r?ie.lineHintFadedExtensions:0}}return o.attached=!0,o}_alignPoint(e,t,a){const s=this._getSelfSnappingZ(t,a);if(g(s))return e;const n=a.coordinateHelper,r=n.vectorToPoint(e,Yc);return r.z=s,n.pointToVector(r)}_hintElevationInfo(e,t){return h(this._getSelfSnappingZ(e.domain,t))?C(t.selfSnappingZ).elevationInfo:q(e.elevationInfo,t.elevationInfo)}_getSelfSnappingZ(e,{selfSnappingZ:t}){return e===gl.SELF&&h(t)?t.value:null}};const Yc=new It,T={main:new K([255,127,0]),selected:new K([255,255,255]),staged:new K([12,207,255]),outline:new K([0,0,0,.5]),selectedOutline:new K([255,255,255])},ii=.3;function Gi(i,e){const t=i.clone();return t.a*=e,t}function Xc(i,e){const t=i.clone(),a=Xh(t);a.s*=e;const s=Wh(a);return t.r=s.r,t.g=s.g,t.b=s.b,t}function Ae(i,e){if(e)for(const t in e)i[t]=e[t]}let Wc=class{constructor(e){this.color=T.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=$.Opaque,Ae(this,e)}},Qa=class{constructor(e){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=T.main,this.outlineColor=T.outline,this.renderOccluded=$.Opaque,this.hoverOutlineColor=T.selectedOutline,Ae(this,e)}apply(e,t){const a=this[e];t.setParameters({color:yt(a),transparent:e!=="color"||a.a<1,renderOccluded:this.renderOccluded})}},Zc=class{constructor(e){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Gi(T.main,.5),this.hoverColor=T.main,this.renderOccluded=$.Transparent,this.minSquaredEdgeLength=900,Ae(this,e)}apply(e,t){const a=this[e];t.setParameters({color:yt(a),transparent:a.a<1,renderOccluded:this.renderOccluded})}},qc=class{constructor(e){this.vertex=new Qa({color:T.main,outlineColor:T.outline}),this.edge=new Qa({color:Xc(Gi(T.main,2/3),.5),outlineColor:Gi(T.outline,.5),size:8,collisionPadding:8}),this.selected=new Qa({color:T.selected,outlineColor:T.outline}),this.edgeOffset=new Zc,Ae(this,e)}},ys=class{constructor(e){this.color=T.selected,this.width=1.5,this.stipplePattern=us(5),this.stippleOffColor=T.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=T.selected,this.renderOccluded=$.OccludeAndTransparent,Ae(this,e)}apply(e){e.color=yt(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=yt(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=yt(this.innerColor),e.renderOccluded=this.renderOccluded}},Qc=class{constructor(e){this.color=T.selected,this.size=4,this.outlineSize=1,this.outlineColor=T.outline,this.shape="square",Ae(this,e)}apply(e){e.color=yt(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=yt(this.outlineColor),e.primitive=this.shape}},Pa=class{constructor(e){this.innerColor=T.selected,this.innerWidth=1,this.glowColor=T.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=ii,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=T.main,Ae(this,e)}apply(e,t=1){const a={glowColor:K.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:K.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=a:e.laserlineStyle=a}},Jc=class{constructor(e){this.outline=new ys({color:T.outline,renderOccluded:$.OccludeAndTransparentStencil,stippleOffColor:T.selected,stipplePattern:us(5),width:1.5,innerWidth:0}),this.staged=new ys({color:T.selected,renderOccluded:$.OccludeAndTransparentStencil,innerColor:T.staged,stippleOffColor:T.outline,stipplePattern:us(5),width:1.5}),this.shadowStyle=new Pa({globalAlpha:ii,glowColor:T.main,glowFalloff:8,glowWidth:8,innerColor:T.selected,innerWidth:1}),Ae(this,e)}},Kc=class{constructor(e){this.outline=new Qc({color:T.selected,outlineColor:T.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new Pa({globalAlpha:ii,glowColor:T.main,glowFalloff:1.5,glowWidth:6,innerColor:T.selected,innerWidth:1,radius:2}),Ae(this,e)}},ed=class extends ys{constructor(e){super(),this.extensionType=ye.GROUND_RAY,Ae(this,e)}},td=class{constructor(e){this.lineGraphics=new Jc,this.pointGraphics=new Kc,this.heightPlane=new Pa({globalAlpha:ii,glowColor:T.main,glowFalloff:8,glowWidth:8,innerColor:T.selected,innerWidth:1}),this.heightBox=new Pa({globalAlpha:ii,glowColor:T.main,glowFalloff:8,glowWidth:8,innerColor:T.selected,innerWidth:0,heightFillColor:T.main}),this.zVerticalLine=new ed({color:Gi(T.main,5*ii/3),falloff:2,innerColor:Gi(T.selected,0),renderOccluded:$.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:ye.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,Ae(this,e)}},id=class{constructor(e){this.visualElements=new td,this.reshapeManipulators=new qc,this.zManipulator=new Wc,Ae(this,e)}colorToVec4(e){return yt(e)}};function yt(i){return Ut(K.toUnitRGBA(i))}const y=new id;let ad=class{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get resources(){return h(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?g(this._resources)||(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?g(this._resources)&&this._createResources():this._destroyResources()}_createResources(){var s;this._destroyResources();const e=this._resourceFactory.createResources(),t=new Kt({view:this._resourceFactory.view}),a=(s=this._resourceFactory.view.basemapTerrain)==null?void 0:s.overlayManager;this._resources={layerView:new Kt({view:this._resourceFactory.view}),external:e,geometriesAdded:!1},a&&(this._resources.drapeSourceRenderer=a.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}_destroyResources(){var t;if(g(this._resources))return;this._ensureRenderGeometriesRemoved();const e=(t=this._resourceFactory.view.basemapTerrain)==null?void 0:t.overlayManager;e&&e.unregisterDrapeSource(this._resources.layerView),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){g(this._resources)||g(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,yn.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){g(this._resources)||g(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,yn.UPDATE),this._resources.geometriesAdded=!0)}},Kt=class extends qh(Ni){constructor(e){super(e),this.drapeSourceType=Th.Features,this.updatePolicy=Ga.SYNC}};d([_({constructOnly:!0})],Kt.prototype,"view",void 0),d([_({readOnly:!0})],Kt.prototype,"drapeSourceType",void 0),Kt=d([Q("DrapedVisualElementLayerView")],Kt);let Ht=class{constructor(e){this.view=null,this._attachmentOrigin=Qi(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new Ze,this._isDraped=!1,this._geometry=null,this._width=1,this._color=zt(1,0,1,1),this._innerWidth=0,this._innerColor=zt(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=$.OccludeAndTransparentStencil,this._resources=new fo({view:e.view,createResources:a=>this._createResources(a),recreateGeometry:(a,s)=>(a.geometries.length=0,this._recreateGeometry(s,a.material,a.geometries),a.geometries)}),this._attachmentOrigin.spatialReference=e.view.spatialReference,this._drapedResources=new ad({view:e.view,createResources:()=>this._createDrapedResources(),recreateGeometry:a=>{a.geometries=this._createRenderGeometriesDraped(a.material),this._attachmentOriginChanged()}});let t=!0;this._laserline=new Li({view:e.view});for(const a in e)a in this?a==="attached"?t=e[a]:this[a]=e[a]:console.error("Cannot set unknown property",a);this.attached=t}destroy(){this._resources.destroy(),this._drapedResources.destroy(),this._laserline.destroy()}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this._updateAttached(this.attached),this._laserline.attached=this._laserlineAttached)}get _laserlineAttached(){return this.attached&&this.visible&&h(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}get visible(){return this._resources.visible}set visible(e){this._resources.visible=e,this._drapedResources.visible=e,this._laserline.attached=this._laserlineAttached}get attached(){return this._resources.attached||this._drapedResources.attached}set attached(e){this._updateAttached(e)}_updateAttached(e){this._resources.attached=!this.isDraped&&e,this._drapedResources.attached=this.isDraped&&e,this._laserline.attached=this._laserlineAttached,this.attached&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this._resources.recreateGeometry(),this._drapedResources.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){Ie(e,this._color)||(Ge(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){Ie(e,this._innerColor)||(Ge(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=h(e)!==h(this._stipplePattern);this._stipplePattern=e,t?this._resources.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){e&&this._stippleOffColor&&Ie(e,this._stippleOffColor)||(this._stippleOffColor=e?Cr(e):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._resources.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,h(e)&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const e=h(this._resources.resources)?this._resources.resources.geometries:null;if(!e||e.length===0)return null;B(Bt,0,0,0);let t=0;for(const a of e){const s=a.vertexAttributes.get(O.POSITION),n=a.indices.get(O.POSITION),r=C(this._resources.resources).material.isClosed(s.data,n);Wl(s,n,r,Vn)&&(z(Bt,Bt,Vn),t++)}return t===0?null:(W(Bt,Bt,1/t),this.view.renderCoordsHelper.fromRenderCoords(Bt,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){h(this._resources.resources)&&this._resources.resources.material.setParameters(this._materialParameters),h(this._drapedResources.resources)&&this._drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return h(this.geometry)&&this.geometry.type==="polygon"}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===$.OccludeAndTransparentStencil?$.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(e,t,a){const s=this._createRenderGeometries();for(const n of s)e.addGeometry(n,t),a.push(n);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_createResources(e){const t=new Ft(this._materialParameters),a=[];return this._recreateGeometry(e,t,a),{material:t,geometries:a,forEach:s=>{s(t),a.forEach(s)}}}_createDrapedResources(){const e=new Ft(this._materialParameters);return{material:e,geometries:this._createRenderGeometriesDraped(e)}}_createRenderGeometriesDraped(e){const t=this.geometry;if(g(t)||g(this.view.basemapTerrain.spatialReference))return[];const a=Ph(t,this.view.basemapTerrain.spatialReference),s=[];for(const{position:n}of a.lines){const r={overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:n},removeDuplicateStartEnd:this._isClosed},o=new Rh(bn(r),e),l=oo(sd);ms(l,n),Ll(o.boundingSphere,.5*(l[0]+l[3]),.5*(l[1]+l[4]),0,.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]))),s.push(o)}return s}calculateMapBounds(e){if(g(this._resources.resources))return!1;const t=this.view.renderCoordsHelper;for(const a of this._resources.resources.geometries){const s=a.vertexAttributes.get(O.POSITION),n=new Float64Array(s.data.length);Nh(s.data,t.spatialReference,0,n,this.view.spatialReference,0,s.data.length/3),ms(e,n)}return!0}_createRenderGeometries(){const e=this.geometry;if(g(e))return[];const t=Dh(e,this.view.elevationProvider,this.view.renderCoordsHelper,ci.fromElevationInfo(this.elevationInfo??new Ar({mode:Er(e,null)}))),a=[],s=[];for(const{position:n,mapPosition:r}of t.lines){const o={attributeData:{position:n,mapPosition:r},removeDuplicateStartEnd:this._isClosed};a.push(bn(o)),s.push(n)}return this._laserline.pathVerticalPlane=s,a}};const sd=ro(),Vn=M(),Bt=M();function nd(i,e,t,a,s){const n=new Float64Array(3*i.length),r=new Float64Array(n.length);i.forEach((c,p)=>{n[3*p+0]=c[0],n[3*p+1]=c[1],n[3*p+2]=c.length>2?c[2]:0});const o=$h(n,e,0,r,0,n,0,n.length/3,t,a,s),l=o!=null;return{numVertices:i.length,position:n,mapPosition:r,projectionSuccess:l,sampledElevation:o}}function rd(i,e){if(!e.screenSizeEnabled)return;const t=i.vertex;Zl(t,e),t.uniforms.add(new he("perScreenPixelRatio",(a,s)=>s.camera.perScreenPixelRatio)),t.uniforms.add(new he("screenSizeScale",a=>a.screenSizeScale)),t.code.add(P`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}function od(i){const e=new Xi,t=i.hasMultipassTerrain&&(i.output===j.Color||i.output===j.Alpha);e.include(kr,i),e.include(rd,i),e.include(Ur,i);const{vertex:a,fragment:s}=e;return s.include(jr),Rs(a,i),s.uniforms.add(new vt("uColor",n=>n.color)),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vWorldPosition","vec3"),t&&e.varyings.add("depth","float"),i.screenSizeEnabled&&e.attributes.add(O.OFFSET,"vec3"),i.shadingEnabled&&(ql(a),e.attributes.add(O.NORMAL,"vec3"),e.varyings.add("vViewNormal","vec3")),a.code.add(P`
    void main(void) {
      vWorldPosition = ${i.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),i.shadingEnabled&&a.code.add(P`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),a.code.add(P`
    ${t?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),t&&e.include(Br,i),s.code.add(P`
    void main() {
      discardBySlice(vWorldPosition);
      ${t?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),i.shadingEnabled?(s.uniforms.add(new it("shadingDirection",n=>n.shadingDirection)),s.uniforms.add(new vt("shadedColor",n=>ld(n.shadingTint,n.color))),s.code.add(P`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`)):s.code.add(P`vec4 finalColor = uColor;`),s.code.add(P`
      if (finalColor.a < ${P.float(Ql)}) {
        discard;
      }
      ${i.output===j.Alpha?P`gl_FragColor = vec4(finalColor.a);`:""}

      ${i.output===j.Color?P`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${i.transparencyPassType===Xe.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),e}function ld(i,e){const t=1-i[3],a=i[3]+e[3]*t;return a===0?(xt[3]=a,xt):(xt[0]=(i[0]*i[3]+e[0]*e[3]*t)/a,xt[1]=(i[1]*i[3]+e[1]*e[3]*t)/a,xt[2]=(i[2]*i[3]+e[2]*e[3]*t)/a,xt[3]=e[3],xt)}const xt=ao(),hd=Object.freeze(Object.defineProperty({__proto__:null,build:od},Symbol.toStringTag,{value:"Module"}));let Hs=class extends ki{initializeProgram(e){return new Ui(e.rctx,Hs.shader.get().build(this.configuration),vo)}_setPipelineState(e){const t=this.configuration,a=e===Xe.NONE,s=e===Xe.FrontFace;return Wi({blending:t.output!==j.Color&&t.output!==j.Alpha||!t.transparent?null:a?gh:Kr(e),culling:eo(t.cullFace),depthTest:{func:s?pa.LESS:t.shadingEnabled?pa.LEQUAL:pa.LESS},depthWrite:a?t.writeDepth&&to:io(e),colorWrite:Zi,polygonOffset:a||s?null:mh})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};Hs.shader=new ji(hd,()=>Bi(()=>import("./ShadedColorMaterial.glsl-157e88d2.js"),["assets/ShadedColorMaterial.glsl-157e88d2.js","assets/vec4f64-939de194.js","assets/SSAOHelper-868f5969.js","assets/typedArrayUtil-d9bc5fbd.js","assets/OrderIndependentTransparency-68bd812c.js","assets/enums-64ab819c.js","assets/cast-a534ae90.js","assets/string-480f3e3f.js","assets/Error-57322e92.js","assets/ensureType-25b8cc06.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-32d9c228.js","assets/vec3-1863987c.js","assets/vec3f64-6cd30318.js","assets/common-c186b691.js","assets/Util-289ce3b5.js","assets/vec2f64-30dc1443.js","assets/vec4-46a9b36d.js","assets/triangle-8cd02c5d.js","assets/sphere-622880b9.js","assets/mathUtils-57aba1ea.js","assets/mat4-7dde83b1.js","assets/byteSizeEstimations-90c5a50d.js","assets/quatf64-c94bd656.js","assets/mat4f64-fbeb2cd1.js","assets/lineSegment-c6f0b9d1.js","assets/Indices-d9b791ce.js","assets/VertexAttribute-9c5c630d.js","assets/ScreenSpacePass-6db805f2.js","assets/vec2-ab9f47bf.js","assets/compilerUtils-fefa73ae.js","assets/Evented-cbf5f368.js","assets/request-f17a8ddb.js","assets/preload-helper-101896b7.js","assets/requestImageUtils-f656eddc.js","assets/SSAO.glsl-3068f7bf.js","assets/assets-a5ce5e1a.js","assets/Texture-411ca148.js","assets/context-util-d4c193b5.js","assets/VertexArrayObject-3630ef4f.js","assets/mat4f32-77b3d8ac.js","assets/BufferView-478024d2.js","assets/aaBoundingBox-4a83dbbc.js","assets/Extent-a1a1de42.js","assets/aaBoundingRect-b340cf8c.js","assets/ViewingMode-915d19cb.js","assets/mat3-9a8d9db7.js","assets/quat-ec16a584.js","assets/vec3f32-4322908d.js","assets/SSAOBlur.glsl-ea338452.js","assets/VertexElementDescriptor-2925c6af.js","assets/reactiveUtils-5869e41a.js","assets/elevationInfoUtils-44cce436.js","assets/ElevationInfo-88554f24.js","assets/jsonMap-190c5593.js","assets/fieldUtils-77ec75e2.js","assets/arcadeOnDemand-5175e7d9.js","assets/geometry-eec1b371.js","assets/Polyline-b571c705.js","assets/typeUtils-cd52dc20.js","assets/lengthUtils-92fed992.js","assets/unitUtils-dd6fb8ee.js","assets/screenUtils-90993e16.js","assets/asyncUtils-087555fc.js","assets/automaticLengthMeasurementUtils-0fd27163.js","assets/intl-70c09a3c.js","assets/number-2ab8ca0d.js","assets/locale-30120714.js","assets/messages-28bf3b89.js","assets/index-7dfdb274.js","assets/Basemap-f70b1b37.js","assets/Collection-7c37b74e.js","assets/SimpleObservable-8e532943.js","assets/collectionUtils-0365f48b.js","assets/deprecate-0d93948c.js","assets/Loadable-46524a7e.js","assets/Promise-368b703a.js","assets/loadAll-01cdf0a9.js","assets/Portal-51616380.js","assets/PortalGroup-d495847c.js","assets/PortalUser-e16fc7d1.js","assets/PortalItem-6eebfb2b.js","assets/writeUtils-3bde6e49.js","assets/layerUtils-68eea656.js","assets/Color-af6e0c66.js","assets/colorUtils-639f4d25.js","assets/enumeration-61a13175.js","assets/opacityUtils-1333f803.js","assets/CollectionFlattener-f43a0fce.js","assets/TablesMixin-a4aaaf91.js","assets/Layer-ead8c88c.js","assets/Identifiable-093f90a8.js","assets/Graphic-1859ae71.js","assets/PopupTemplate-52faab17.js","assets/Clonable-9b34e760.js","assets/symbols-75e7a993.js","assets/CIMSymbol-8f02a6e3.js","assets/Symbol-8266348e.js","assets/symbolLayerUtils3D-c8c40895.js","assets/persistableUrlUtils-56d43b12.js","assets/jsonUtils-c6684c52.js","assets/Cyclical-078b4564.js","assets/workers-5d67fe7a.js","assets/Connection-b756149d.js","assets/Queue-275a6362.js","assets/projection-0af97a56.js","assets/zscale-48bab05e.js","assets/TileInfo-c5c8c8d2.js","assets/widget-09d2e7af.js","assets/uuid-73213768.js","assets/dom-5b7af1bf.js","assets/HandleOwner-2edbba46.js","assets/executeQueryJSON-0696009a.js","assets/normalizeUtils-6483f6b5.js","assets/query-71223310.js","assets/pbfQueryUtils-c922ef32.js","assets/pbf-8b0546e8.js","assets/OptimizedFeature-73582c6e.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-3c8de33a.js","assets/FeatureSet-9cc47aef.js","assets/Field-1d4f9ca4.js","assets/fieldType-b34e5d2d.js","assets/Query-13124a97.js","assets/TimeExtent-2004eecf.js","assets/RelationshipQuery-c27267ab.js","assets/LegendOptions-2e7b3d70.js","assets/utils-4aa03157.js","assets/BlendLayer-813950f9.js","assets/parser-01f6451e.js","assets/ItemCache-bf1028d4.js","assets/MemCache-1d2f56ee.js","assets/utils-0c7f5071.js","assets/jsonUtils-559e9000.js","assets/UniqueValueRenderer-30750d31.js","assets/diffUtils-8a8cb5bc.js","assets/colorRamps-8d7efc14.js","assets/sizeVariableUtils-d4870b0d.js","assets/jsonUtils-eb568237.js","assets/styleUtils-015eeecd.js","assets/DictionaryLoader-326d0e17.js","assets/LRUCache-b9228ca3.js","assets/heatmapUtils-3d7c22c5.js","assets/featureConversionUtils-d2229ed4.js","assets/TopFeaturesQuery-9aca00bf.js","assets/FeatureLayer-9a7e04cf.js","assets/MultiOriginJSONSupport-b8792dfa.js","assets/LayerFloorInfo-e7c896e5.js","assets/FeatureLayerBase-d5682b4b.js","assets/HeightModelInfo-34f16d74.js","assets/arcgisLayerUrl-6e9db12f.js","assets/OperationalLayer-1dad72ac.js","assets/editsZScale-12d81957.js","assets/APIKeyMixin-b6e4f897.js","assets/ArcGISService-e571bcff.js","assets/CustomParametersMixin-a5d06ccc.js","assets/EditBusLayer-b5dc3689.js","assets/FeatureReductionLayer-1e5c4045.js","assets/labelingInfo-be3a629c.js","assets/labelUtils-4f4b54c6.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-9623e905.js","assets/PortalLayer-9dd15f09.js","assets/RefreshableLayer-49182ab8.js","assets/ScaleRangeLayer-c072e266.js","assets/TemporalLayer-f784dd83.js","assets/TimeInfo-f76d6c20.js","assets/FeatureTemplate-c4496b93.js","assets/FeatureType-0be9420b.js","assets/fieldProperties-9e220f14.js","assets/FieldsIndex-16707836.js","assets/versionUtils-f229b9a6.js","assets/styleUtils-08eaa4d2.js","assets/popupUtils-88fed094.js","assets/colorUtils-82440b70.js","assets/mat2d-d0b91e3e.js","assets/Scheduler-5e6ccc87.js","assets/GraphicsLayer-a7c6f685.js","assets/unitBezier-881ac1eb.js","assets/mat3f32-d3d088e8.js","assets/vec2f32-461e65a9.js","assets/TileStrategy-a5366189.js","assets/TileStore-8f580dbf.js","assets/TileKey-9cae9369.js","assets/rbush-8e36784a.js","assets/quickselect-322ec8e1.js","assets/capabilities-d08b6e58.js","assets/Subtype-a3103d84.js","assets/datetime-4f774298.js","assets/QueryEngineResult-eb704fb1.js","assets/utils-52ad3c09.js","assets/generateRendererUtils-2f0b667c.js","assets/WhereClause-6c9440a1.js","assets/utils-63166b41.js","assets/json-48e3ea08.js","assets/EffectView-dffeb0bc.js","assets/ExportImageParameters-3714ed4b.js","assets/sublayerUtils-eea48c01.js","assets/webStyleSymbolUtils-6bef877f.js","assets/devEnvironmentUtils-5002a058.js","assets/dehydratedFeatures-3dcd65f1.js","assets/enums-4b2a86a0.js","assets/plane-46a8c767.js","assets/index-a8abe695.css","assets/geometryEngine-0f4f9d5a.js","assets/geometryEngineBase-3dd302e0.js","assets/hydrated-00dd97bc.js","assets/vec4f32-2f36231b.js","assets/Octree-8ed6dc77.js","assets/glUtil-7aa58841.js","assets/InterleavedLayout-b5930508.js","assets/types-e1c0a5bf.js","assets/NativeLineMaterial-b37d8d98.js","assets/triangulationUtils-6b510de4.js","assets/earcut-58237617.js","assets/deduplicate-d92c3cc2.js","assets/NestedMap-1b5db22e.js","assets/floatRGBA-090399ba.js","assets/boundedPlane-296928f6.js","assets/DrawGraphicTool-fda764ee.js","assets/automaticAreaMeasurementUtils-065aa71f.js","assets/GraphicManipulator-7a117f97.js","assets/TranslateTooltipInfos-2bd19c7a.js","assets/axisAngleDegrees-700f0205.js","assets/persistable-086be2f7.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/ExtentTooltipInfos-ad414646.js"]));let Pe=class extends Yr{constructor(){super(...arguments),this.output=j.Color,this.cullFace=ee.None,this.transparencyPassType=Xe.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};d([N({count:j.COUNT})],Pe.prototype,"output",void 0),d([N({count:ee.COUNT})],Pe.prototype,"cullFace",void 0),d([N({count:Xe.COUNT})],Pe.prototype,"transparencyPassType",void 0),d([N()],Pe.prototype,"hasSlicePlane",void 0),d([N()],Pe.prototype,"transparent",void 0),d([N()],Pe.prototype,"writeDepth",void 0),d([N()],Pe.prototype,"screenSizeEnabled",void 0),d([N()],Pe.prototype,"shadingEnabled",void 0),d([N()],Pe.prototype,"hasMultipassTerrain",void 0),d([N()],Pe.prototype,"cullAboveGround",void 0);const vo=new Map([[O.POSITION,0],[O.NORMAL,1],[O.OFFSET,2]]);let bs=class extends Xr{constructor(e){super(e,new dd),this.supportsEdges=!0,this._configuration=new Pe,this._vertexAttributeLocations=vo}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,a,s,n,r,o){if(this.parameters.screenSizeEnabled){const l=e.vertexAttributes.get(O.OFFSET);hs(e,t,s,n,r,{applyToVertex:(p,u,m,f)=>{const v=B(zn,l.data[3*f+0],l.data[3*f+1],l.data[3*f+2]),b=B(ud,p,u,m);return W(v,v,this.parameters.screenSizeScale*s.camera.computeRenderPixelSizeAt(v)),z(b,b,v),[b[0],b[1],b[2]]},applyToAabb:p=>{const u=jh(p,zn);return Bh(p,this.parameters.screenSizeScale*s.camera.computeRenderPixelSizeAt(u))}},o)}else hs(e,t,s,n,r,void 0,o)}requiresSlot(e,t){if(t===j.Highlight)return e===Oe.OPAQUE_MATERIAL;if(t===j.Color||t===j.Alpha||t===j.ObjectAndLayerIdColor){let a=Oe.OPAQUE_MATERIAL;return this.parameters.transparent&&(a=this.parameters.writeDepth?Oe.TRANSPARENT_MATERIAL:Oe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===a||e===Oe.DRAPED_MATERIAL}return!1}createGLMaterial(e){return new cd(e)}createBufferWriter(){return new pd(this.parameters.screenSizeEnabled)}},cd=class extends Jl{beginSlot(e){return this.ensureTechnique(Hs,e)}},dd=class extends Wr{constructor(){super(...arguments),this.color=We(1,1,1,1),this.shadingTint=We(0,0,0,.25),this.shadingDirection=te(M(),[.5,-.5,-.5]),this.screenSizeScale=14,this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=ee.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}};class pd{constructor(e){this.screenSizeEnabled=e;const t=Nr().vec3f(O.POSITION).vec3f(O.NORMAL);this.screenSizeEnabled&&t.vec3f(O.OFFSET),this.vertexBufferLayout=t}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){return e.indices.get(O.POSITION).length}write(e,t,a,s,n){if(Kl(a,this.vertexBufferLayout,e,t,s,n),this.screenSizeEnabled){if(!a.vertexAttributes.has(O.OFFSET))throw new Error(`${O.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const r=a.vertexAttributes.get(O.OFFSET),o=a.indices.get(O.OFFSET);Jh(r.size===3);const l=s.getField(O.OFFSET,Qh);if(!l)throw new Error("unable to acquire view for "+O.OFFSET);eh(o,r.data,t,l,n)}}}}const zn=M(),ud=M();let Nn=class extends Na{constructor(e){super(e),this.view=null,this._renderOccluded=$.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=y.colorToVec4(y.reshapeManipulators.vertex.color),this._size=y.reshapeManipulators.vertex.size,this._outlineColor=y.colorToVec4(y.reshapeManipulators.vertex.outlineColor),this._outlineSize=y.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(e)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(e){this._vertices=e,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(e){this._spatialReference=e,this.recreateGeometry()}get color(){return this._color}set color(e){Ie(e,this._color)||(Ge(this._color,e),this._updateMaterial())}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){Ie(e,this._outlineColor)||(Ge(this._outlineColor,e),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const e=this.vertices;if(g(e)||e.length===0)return[];const t=.5,a=.5,s=nd(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,ci.fromElevationInfo(this.elevationInfo)),n=[],r=s.numVertices,o=s.position;for(let l=0;l<r;++l){const c=B(_d,o[3*l+0],o[3*l+1],o[3*l+2]),p=Fn(t,c),u=Fn(a,c);n.push({vertexGeometry:p,vertexOutlineGeometry:u})}return n}createGeometries(e){const t=this._createRenderGeometries();for(const{vertexGeometry:a,vertexOutlineGeometry:s}of t)e.addGeometry(a,this._vertexMaterial),e.addGeometry(s,this._vertexOutlineMaterial)}createExternalResources(){this._vertexMaterial=new bs({...this._vertexMaterialParameters,writeDepth:!0,cullFace:ee.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new bs({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:ee.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}};const _d=M();function Fn(i,e){return bi(i,16,16,{offset:e})}let Tt=class extends Kh{constructor(e){super(e),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:e,offset:t}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new Ar({mode:e,offset:t})}normalizeCtorArgs(e){if(!e.elevationInfo){const t=e.hasZ??!0;return{...e,elevationInfo:Yo(t)}}return e}initializeGraphic(e){const t=this._createGraphicState=new kt({graphic:e});return _e([this.view.maskOccludee(e),this.view.trackGraphicState(t),I(()=>({element:this._outlineVisualElement,isDraped:t.isDraped}),({element:a,isDraped:s})=>{ss(a,n=>n.isDraped=s)},ke)])}makeDrawOperation(){const{geometryType:e}=this,t=e!=="circle"&&e!=="rectangle";return new ml({view:this.view,manipulators:this.manipulators,geometryType:ec(e),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new fl(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new vl(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new Ii,segmentLabels:t?new Ta:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:h(this._createGraphicState)?this._createGraphicState.isDraped:en(this.hasZ,this.elevationInfo)==="on-the-ground"})}onActiveVertexChanged(e){const{view:t}=this;return h(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[e],this._updateVerticalLineVisualElement(e),null):(this._activeVertexVisualElement=new Nn({view:t,spatialReference:t.spatialReference,vertices:[e],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:y.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=y.colorToVec4(y.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,this._verticalLineVisualElement=new Fa({view:t,extensionType:y.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:$.OccludeAndTransparent}),y.visualElements.zVerticalLine.apply(this._verticalLineVisualElement),Ct(()=>{this._activeVertexVisualElement=k(this._activeVertexVisualElement),this._verticalLineVisualElement=k(this._verticalLineVisualElement)}))}_updateVerticalLineVisualElement(e){const t=this._verticalLineVisualElement;if(g(t))return;const{renderCoordsHelper:a,spatialReference:s,elevationProvider:n}=this.view;B(Yt,e[0],e[1],e[2]),Hn.setFromElevationInfo(this.elevationInfo),Yt[2]=Va(Yt,n,Hn,a),a.toRenderCoords(Yt,s,Yt)?(t.setStartEndFromWorldDownAtLocation(Yt),t.attached=!0):t.attached=!1}onOutlineChanged(e){if(h(this._outlineVisualElement))return this._outlineVisualElement.geometry=e,null;const t=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new Ht({view:this.view,geometry:e,elevationInfo:t,isDraped:h(this._createGraphicState)?this._createGraphicState.isDraped:en(this.hasZ,t)==="on-the-ground",attached:!1}),y.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),y.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,Ct(()=>{this._outlineVisualElement=k(this._outlineVisualElement)})}onRegularVerticesChanged(e){return h(this._verticesVisualElement)?(this._verticesVisualElement.vertices=e,null):(this._verticesVisualElement=new Nn({view:this.view,spatialReference:this.view.spatialReference,vertices:e,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:y.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,Ct(()=>{this._verticesVisualElement=k(this._verticesVisualElement)}))}};d([_({constructOnly:!0})],Tt.prototype,"elevationInfo",void 0),d([_({constructOnly:!0})],Tt.prototype,"geometryType",void 0),d([_()],Tt.prototype,"type",void 0),d([_({constructOnly:!0})],Tt.prototype,"view",void 0),Tt=d([Q("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Tt);const Hn=new ci,Yt=M();function ai(i,e,t){return gd(i,i.screenToRender(e,ns(S.get())),t)}function gd(i,e,t){const a=ns(nn(S.get(),e));if(a[2]=0,!i.unprojectFromRenderScreen(a,t.origin))return null;const s=ns(nn(S.get(),e));s[2]=1;const n=i.unprojectFromRenderScreen(s,S.get());return g(n)?null:(D(t.direction,n,t.origin),t)}class ce{constructor(e){this._camera=new Ch,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=[],this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=ge(),this._worldFrame=null,this._renderLocation=M(),this._renderLocationDirty=!0,this._location=new It({x:0,y:0,z:0}),this._elevationAlignedLocation=new It,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=J.None,this._focused=!1,this.events=new Ze.EventEmitter,this._screenLocation={screenPointArray:we(),renderScreenPointArray:rs(),pixelSize:0},this._screenLocationDirty=!0,this._applyObjectTransform=null,this._engineResourcesAddedToStage=!1,this._engineResources=null,this._attached=!1,this._engineLayer=null,this._materialIdReferences=null,this._location.spatialReference=e.view.spatialReference;for(const t in e)this[t]=e[t];this.view.state&&this.view.state.camera&&this._camera.copyFrom(this.view.state.camera)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,this._noDisplayCount===1&&this._updateEngineObject(),{remove:Io(()=>{this._noDisplayCount--,this._noDisplayCount===0&&this._updateEngineObject()})}}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){kn(e)&&(this._screenLocationDirty=!0),Zr(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=ge()),md(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){ln(e,this._location),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){ln(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y;const e=h(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=yl(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:e===!0?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1;let e;if(kn(this._modelTransform)){const t=this._calculateModelTransformOffset(yd);e=z(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;const a=fa(e,fd),s=this._getCollisionRadius(t),n=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if(Pr(this.screenLocation.screenPointArray,a)<s*s)return this.screenLocation.renderScreenPointArray[2]+n;break;case"line":{const r=this.collisionType.paths,o=this._getWorldToScreenObjectScale(),l=this._calculateObjectTransform(o,ra),c=s*this.screenLocation.pixelSize,p=ai(this._camera,a,Ja);if(g(p))return null;for(const u of r){if(u.length===0)continue;const m=ue(xi,u[0],l);for(let f=1;f<u.length;f++){const v=ue(Bn,u[f],l),b=Vl(wi(m,v,Un),p);if(b!=null&&b<c*c){const x=z(S.get(),m,v);W(x,x,.5);const w=tn(S.get());return this._camera.projectToRenderScreen(x,w),w[2]+n}U(m,v)}}break}case"disc":{const r=this.collisionType.direction,o=this.collisionType.offset??Oi,l=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(l,ra),p=s*this.screenLocation.pixelSize,u=ai(this._camera,a,Ja);if(g(u))return null;const m=Mn(jn,c),f=Js(Xn,r,m),v=ue(Wn,o,c);Nt(v,f,oa);const b=Yn;if(ri(oa,u,b)&&wr(b,v)<p*p)return this.screenLocation.renderScreenPointArray[2]+n;break}case"ribbon":{const{paths:r,direction:o}=this.collisionType,l=this._getWorldToScreenObjectScale(),c=this._calculateObjectTransform(l,ra),p=s*this._camera.computeScreenPixelSizeAt(this.renderLocation),u=ai(this._camera,a,Ja);if(g(u))return null;const m=Mn(jn,c),f=Js(Xn,o,m),v=this._calculateModelTransformPosition(Wn);Nt(v,f,oa);const b=Yn;if(!ri(oa,u,b))break;for(const x of r){if(x.length===0)continue;const w=ue(xi,x[0],c);for(let R=1;R<x.length;R++){const H=ue(Bn,x[R],c),fe=Gl(wi(w,H,Un),b);if(fe!=null&&fe<p*p){const qe=z(S.get(),w,H);W(qe,qe,.5);const xe=tn(S.get());return this._camera.projectToRenderScreen(qe,xe),xe[2]+n}U(w,H)}}break}default:ic(this.collisionType)}return null}attach(e={manipulator3D:{}}){var a;if(!this.view._stage)return;const t=e.manipulator3D;if(g(t.engineLayerId)){const s=new Cs({isPickable:!1,updatePolicy:Ga.SYNC});this.view._stage.add(s),t.engineLayerId=s.id,this._engineLayer=s}else(a=this.view._stage)!=null&&a.getObject&&(this._engineLayer=this.view._stage.getObject(t.engineLayerId));t.engineLayerReferences=(t.engineLayerReferences||0)+1,this._materialIdReferences=t.materialIdReferences,g(this._materialIdReferences)&&(this._materialIdReferences=new Map,t.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),Fh(this._location.spatialReference,this.view.spatialReference)||(this.location=new It({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(e={manipulator3D:{}}){const t=e.manipulator3D;t.engineLayerReferences--;const a=t.engineLayerReferences===0;a&&(t.engineLayerId=null),this._removeResourcesFromStage(a),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){gs(this.location,Zn,e.spatialReference),sc(e.extent,Zn)&&(this.location=this._location)}_evaluateElevationAlignment(e=this.location){if(g(this.elevationInfo))return!1;let t=null,a=0;const s=q(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":t=q(Za(this.view.elevationProvider,e,"ground"),0);break;case"relative-to-ground":a=q(Za(this.view.elevationProvider,e,"ground"),0)+s;break;case"relative-to-scene":a=q(Za(this.view.elevationProvider,e,"scene"),0)+s;break;case"absolute-height":a=s}return(a!==this._elevation.offset||t!==this._elevation.override)&&(this._elevation.offset=a,this._elevation.override=t,!0)}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=ra;if(this.autoScaleRenderObjects===!0){const r=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(r,t)}else this._calculateObjectTransform(e,t);const{objectsByState:a}=this._ensureEngineResources(),s=(this.focused?E.Focused:E.Unfocused)|(this.selected?E.Selected:E.Unselected),n=this._noDisplayCount>0;for(const{stateMask:r,objects:o}of a){if(n){for(const m of o)m.setVisible(!1);continue}const l=(r&E.All)!==E.None,c=(r&J.All)!==J.None,p=!l||(s&r)==(r&E.All),u=!c||(this.state&r)==(r&J.All);if(p&&u)for(const m of o)m.setVisible(!0),m.transformation=t;else for(const m of o)m.setVisible(!1)}}_ensureEngineResources(){if(g(this._engineResources)){const e=C(this._engineLayer),t=[],a=new Set;this.renderObjects.forEach(({material:o})=>{a.has(o)||(t.push(o),a.add(o))});const s=(o,l)=>{const{geometry:c,material:p,transform:u}=l;Array.isArray(c)?c.forEach(m=>o.addGeometry(m,p,u)):o.addGeometry(c,p,u)},n=new Map;this._renderObjects.forEach(o=>{const l=new Ls({castShadow:!1});s(l,o);const c=o.stateMask||0,p=n.get(c)||[];p.push(l),n.set(c,p)});const r=[];n.forEach((o,l)=>r.push({stateMask:l,objects:o})),this._engineResources={objectsByState:r,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){if(this._engineResourcesAddedToStage||g(this._engineResources))return;const{objectsByState:e,layer:t,materials:a}=this._engineResources;a.forEach(s=>{const n=C(this._materialIdReferences),r=n.get(s.id)||0;r===0&&this.view._stage.add(s),n.set(s.id,r+1)}),e.forEach(({objects:s})=>{t.addMany(s),this.view._stage.addMany(s)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(e=!1){if(!this._engineResourcesAddedToStage||g(this._engineResources)||!this.view._stage)return;const{objectsByState:t,layer:a,materials:s}=this._engineResources;t.forEach(({objects:n})=>{a.removeMany(n),this.view._stage.removeMany(n)}),s.forEach(n=>{const r=C(this._materialIdReferences),o=r.get(n.id);o===1?(this.view._stage.remove(n),r.delete(n.id)):r.set(n.id,o-1)}),e&&this.view._stage.remove(a),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*(e==="touch"?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),a=this._calculateObjectTransform(t,vd);return B(e,a[12],a[13],a[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return D(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return nh(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&Be(t,t,this._worldFrame),Be(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,h(this._applyObjectTransform)&&this._applyObjectTransform(t),t}get test(){let e=!1;if(h(this._engineResources))for(const t in this._engineResources.objectsByState){const a=this._engineResources.objectsByState[t];for(const s of a.objects)if(s.isVisible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function kn(i){return i[12]!==0||i[13]!==0||i[14]!==0}function md(i,e,t){switch(i.viewingMode){case"local":return ds(t),!0;case"global":{const a=al(i.renderCoordsHelper.spatialReference);return Hh(e,0,xi,0,a.radius),kh(nt(xi[0]),nt(xi[1]),t),!0}}}const fd=we(),Un=Pi(),Ja=Hi(),jn=ac(),vd=ge(),ra=ge(),oa=hi(),xi=M(),Bn=M(),Yn=M(),Xn=M(),Wn=M(),yd=M(),Zn=new It({x:0,y:0,z:0,spatialReference:null});function bd(i){const e=new Xi,{vertex:t,fragment:a}=e;return Rs(t,i),e.include(kr,i),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UV0,"vec2"),e.varyings.add("vpos","vec3"),i.hasMultipassTerrain&&e.varyings.add("depth","float"),t.uniforms.add(new Dt("textureCoordinateScaleFactor",s=>h(s.texture)&&h(s.texture.descriptor.textureCoordinateScaleFactor)?s.texture.descriptor.textureCoordinateScaleFactor:ll)),t.code.add(P`
    void main(void) {
      vpos = position;
      ${i.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),e.include(Ur,i),e.include(Br,i),a.uniforms.add([new ps("tex",s=>s.texture),new he("opacity",s=>s.opacity)]),e.varyings.add("vTexCoord","vec2"),i.output===j.Alpha?a.code.add(P`
    void main() {
      discardBySlice(vpos);
      ${i.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${P.float(mn)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(a.include(jr),a.code.add(P`
    void main() {
      discardBySlice(vpos);
      ${i.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${P.float(mn)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${i.transparencyPassType===Xe.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),e}const Md=Object.freeze(Object.defineProperty({__proto__:null,build:bd},Symbol.toStringTag,{value:"Module"}));let ks=class extends ki{initializeProgram(e){return new Ui(e.rctx,ks.shader.get().build(this.configuration),Ps)}_setPipelineState(e,t){const a=this.configuration,s=e===Xe.NONE,n=e===Xe.FrontFace;return Wi({blending:a.output!==j.Color&&a.output!==j.Alpha||!a.transparent?null:s?Sd:Kr(e),culling:eo(a.cullFace),depthTest:{func:fh(e)},depthWrite:s?a.writeDepth&&to:io(e),colorWrite:Zi,stencilWrite:a.hasOccludees?th:null,stencilTest:a.hasOccludees?t?ih:ah:null,polygonOffset:s||n?null:vh(a.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,t){return t?this._occludeePipelineState:super.getPipelineState(e,t)}};ks.shader=new ji(Md,()=>Bi(()=>import("./ImageMaterial.glsl-56e51863.js"),["assets/ImageMaterial.glsl-56e51863.js","assets/vec2f64-30dc1443.js","assets/SSAOHelper-868f5969.js","assets/typedArrayUtil-d9bc5fbd.js","assets/OrderIndependentTransparency-68bd812c.js","assets/enums-64ab819c.js","assets/cast-a534ae90.js","assets/string-480f3e3f.js","assets/Error-57322e92.js","assets/ensureType-25b8cc06.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-32d9c228.js","assets/vec3-1863987c.js","assets/vec3f64-6cd30318.js","assets/common-c186b691.js","assets/Util-289ce3b5.js","assets/vec4-46a9b36d.js","assets/vec4f64-939de194.js","assets/triangle-8cd02c5d.js","assets/sphere-622880b9.js","assets/mathUtils-57aba1ea.js","assets/mat4-7dde83b1.js","assets/byteSizeEstimations-90c5a50d.js","assets/quatf64-c94bd656.js","assets/mat4f64-fbeb2cd1.js","assets/lineSegment-c6f0b9d1.js","assets/Indices-d9b791ce.js","assets/VertexAttribute-9c5c630d.js","assets/ScreenSpacePass-6db805f2.js","assets/vec2-ab9f47bf.js","assets/compilerUtils-fefa73ae.js","assets/Evented-cbf5f368.js","assets/request-f17a8ddb.js","assets/preload-helper-101896b7.js","assets/requestImageUtils-f656eddc.js","assets/SSAO.glsl-3068f7bf.js","assets/assets-a5ce5e1a.js","assets/Texture-411ca148.js","assets/context-util-d4c193b5.js","assets/VertexArrayObject-3630ef4f.js","assets/mat4f32-77b3d8ac.js","assets/BufferView-478024d2.js","assets/aaBoundingBox-4a83dbbc.js","assets/Extent-a1a1de42.js","assets/aaBoundingRect-b340cf8c.js","assets/ViewingMode-915d19cb.js","assets/mat3-9a8d9db7.js","assets/quat-ec16a584.js","assets/vec3f32-4322908d.js","assets/SSAOBlur.glsl-ea338452.js","assets/VertexElementDescriptor-2925c6af.js","assets/reactiveUtils-5869e41a.js","assets/elevationInfoUtils-44cce436.js","assets/ElevationInfo-88554f24.js","assets/jsonMap-190c5593.js","assets/fieldUtils-77ec75e2.js","assets/arcadeOnDemand-5175e7d9.js","assets/geometry-eec1b371.js","assets/Polyline-b571c705.js","assets/typeUtils-cd52dc20.js","assets/lengthUtils-92fed992.js","assets/unitUtils-dd6fb8ee.js","assets/screenUtils-90993e16.js","assets/asyncUtils-087555fc.js","assets/automaticLengthMeasurementUtils-0fd27163.js","assets/intl-70c09a3c.js","assets/number-2ab8ca0d.js","assets/locale-30120714.js","assets/messages-28bf3b89.js","assets/index-7dfdb274.js","assets/Basemap-f70b1b37.js","assets/Collection-7c37b74e.js","assets/SimpleObservable-8e532943.js","assets/collectionUtils-0365f48b.js","assets/deprecate-0d93948c.js","assets/Loadable-46524a7e.js","assets/Promise-368b703a.js","assets/loadAll-01cdf0a9.js","assets/Portal-51616380.js","assets/PortalGroup-d495847c.js","assets/PortalUser-e16fc7d1.js","assets/PortalItem-6eebfb2b.js","assets/writeUtils-3bde6e49.js","assets/layerUtils-68eea656.js","assets/Color-af6e0c66.js","assets/colorUtils-639f4d25.js","assets/enumeration-61a13175.js","assets/opacityUtils-1333f803.js","assets/CollectionFlattener-f43a0fce.js","assets/TablesMixin-a4aaaf91.js","assets/Layer-ead8c88c.js","assets/Identifiable-093f90a8.js","assets/Graphic-1859ae71.js","assets/PopupTemplate-52faab17.js","assets/Clonable-9b34e760.js","assets/symbols-75e7a993.js","assets/CIMSymbol-8f02a6e3.js","assets/Symbol-8266348e.js","assets/symbolLayerUtils3D-c8c40895.js","assets/persistableUrlUtils-56d43b12.js","assets/jsonUtils-c6684c52.js","assets/Cyclical-078b4564.js","assets/workers-5d67fe7a.js","assets/Connection-b756149d.js","assets/Queue-275a6362.js","assets/projection-0af97a56.js","assets/zscale-48bab05e.js","assets/TileInfo-c5c8c8d2.js","assets/widget-09d2e7af.js","assets/uuid-73213768.js","assets/dom-5b7af1bf.js","assets/HandleOwner-2edbba46.js","assets/executeQueryJSON-0696009a.js","assets/normalizeUtils-6483f6b5.js","assets/query-71223310.js","assets/pbfQueryUtils-c922ef32.js","assets/pbf-8b0546e8.js","assets/OptimizedFeature-73582c6e.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-3c8de33a.js","assets/FeatureSet-9cc47aef.js","assets/Field-1d4f9ca4.js","assets/fieldType-b34e5d2d.js","assets/Query-13124a97.js","assets/TimeExtent-2004eecf.js","assets/RelationshipQuery-c27267ab.js","assets/LegendOptions-2e7b3d70.js","assets/utils-4aa03157.js","assets/BlendLayer-813950f9.js","assets/parser-01f6451e.js","assets/ItemCache-bf1028d4.js","assets/MemCache-1d2f56ee.js","assets/utils-0c7f5071.js","assets/jsonUtils-559e9000.js","assets/UniqueValueRenderer-30750d31.js","assets/diffUtils-8a8cb5bc.js","assets/colorRamps-8d7efc14.js","assets/sizeVariableUtils-d4870b0d.js","assets/jsonUtils-eb568237.js","assets/styleUtils-015eeecd.js","assets/DictionaryLoader-326d0e17.js","assets/LRUCache-b9228ca3.js","assets/heatmapUtils-3d7c22c5.js","assets/featureConversionUtils-d2229ed4.js","assets/TopFeaturesQuery-9aca00bf.js","assets/FeatureLayer-9a7e04cf.js","assets/MultiOriginJSONSupport-b8792dfa.js","assets/LayerFloorInfo-e7c896e5.js","assets/FeatureLayerBase-d5682b4b.js","assets/HeightModelInfo-34f16d74.js","assets/arcgisLayerUrl-6e9db12f.js","assets/OperationalLayer-1dad72ac.js","assets/editsZScale-12d81957.js","assets/APIKeyMixin-b6e4f897.js","assets/ArcGISService-e571bcff.js","assets/CustomParametersMixin-a5d06ccc.js","assets/EditBusLayer-b5dc3689.js","assets/FeatureReductionLayer-1e5c4045.js","assets/labelingInfo-be3a629c.js","assets/labelUtils-4f4b54c6.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-9623e905.js","assets/PortalLayer-9dd15f09.js","assets/RefreshableLayer-49182ab8.js","assets/ScaleRangeLayer-c072e266.js","assets/TemporalLayer-f784dd83.js","assets/TimeInfo-f76d6c20.js","assets/FeatureTemplate-c4496b93.js","assets/FeatureType-0be9420b.js","assets/fieldProperties-9e220f14.js","assets/FieldsIndex-16707836.js","assets/versionUtils-f229b9a6.js","assets/styleUtils-08eaa4d2.js","assets/popupUtils-88fed094.js","assets/colorUtils-82440b70.js","assets/mat2d-d0b91e3e.js","assets/Scheduler-5e6ccc87.js","assets/GraphicsLayer-a7c6f685.js","assets/unitBezier-881ac1eb.js","assets/mat3f32-d3d088e8.js","assets/vec2f32-461e65a9.js","assets/TileStrategy-a5366189.js","assets/TileStore-8f580dbf.js","assets/TileKey-9cae9369.js","assets/rbush-8e36784a.js","assets/quickselect-322ec8e1.js","assets/capabilities-d08b6e58.js","assets/Subtype-a3103d84.js","assets/datetime-4f774298.js","assets/QueryEngineResult-eb704fb1.js","assets/utils-52ad3c09.js","assets/generateRendererUtils-2f0b667c.js","assets/WhereClause-6c9440a1.js","assets/utils-63166b41.js","assets/json-48e3ea08.js","assets/EffectView-dffeb0bc.js","assets/ExportImageParameters-3714ed4b.js","assets/sublayerUtils-eea48c01.js","assets/webStyleSymbolUtils-6bef877f.js","assets/devEnvironmentUtils-5002a058.js","assets/dehydratedFeatures-3dcd65f1.js","assets/enums-4b2a86a0.js","assets/plane-46a8c767.js","assets/index-a8abe695.css","assets/geometryEngine-0f4f9d5a.js","assets/geometryEngineBase-3dd302e0.js","assets/hydrated-00dd97bc.js","assets/vec4f32-2f36231b.js","assets/Octree-8ed6dc77.js","assets/glUtil-7aa58841.js","assets/InterleavedLayout-b5930508.js","assets/types-e1c0a5bf.js","assets/NativeLineMaterial-b37d8d98.js","assets/triangulationUtils-6b510de4.js","assets/earcut-58237617.js","assets/deduplicate-d92c3cc2.js","assets/NestedMap-1b5db22e.js","assets/floatRGBA-090399ba.js","assets/boundedPlane-296928f6.js","assets/DrawGraphicTool-fda764ee.js","assets/automaticAreaMeasurementUtils-065aa71f.js","assets/GraphicManipulator-7a117f97.js","assets/TranslateTooltipInfos-2bd19c7a.js","assets/axisAngleDegrees-700f0205.js","assets/persistable-086be2f7.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/ExtentTooltipInfos-ad414646.js"]));const Sd=$s(Ue.ONE,Ue.ONE_MINUS_SRC_ALPHA);let Re=class extends Yr{constructor(){super(...arguments),this.output=j.Color,this.cullFace=ee.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=Xe.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};d([N({count:j.COUNT})],Re.prototype,"output",void 0),d([N({count:ee.COUNT})],Re.prototype,"cullFace",void 0),d([N()],Re.prototype,"hasSlicePlane",void 0),d([N()],Re.prototype,"transparent",void 0),d([N()],Re.prototype,"enableOffset",void 0),d([N()],Re.prototype,"writeDepth",void 0),d([N()],Re.prototype,"hasOccludees",void 0),d([N({count:Xe.COUNT})],Re.prototype,"transparencyPassType",void 0),d([N()],Re.prototype,"hasMultipassTerrain",void 0),d([N()],Re.prototype,"cullAboveGround",void 0);let wd=class extends Xr{constructor(e){super(e,new Ed),this.supportsEdges=!0,this._configuration=new Re}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<yh,this._configuration.hasMultipassTerrain=t.multipassTerrain.enabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,a,s,n,r,o){hs(e,t,s,n,r,void 0,o)}requiresSlot(e,t){return t===j.Color||t===j.Alpha||t===j.Highlight?e===Oe.DRAPED_MATERIAL?!0:t===j.Highlight?e===Oe.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?Oe.TRANSPARENT_MATERIAL:Oe.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:Oe.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new xd(e)}createBufferWriter(){return new Lh(Ih)}},xd=class extends sh{constructor(e){super({...e,...e.material.parameters})}_updateParameters(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(ks,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:e.hasOccludees}),this._updateParameters(e))}beginSlot(e){return this._output!==j.Color&&this._output!==j.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Ed=class extends Wr{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=ee.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}};function at(i,e=$.OccludeAndTransparent,t=!0){const a=We(i[0],i[1],i[2],i.length>3?i[3]:1),s=i[3]<1;return t?new bs({color:a,transparent:s,writeDepth:!0,cullFace:ee.Back,renderOccluded:e}):new je({color:a,transparent:s,writeDepth:!0,cullFace:ee.Back,renderOccluded:e})}function fi(i,e=$.OccludeAndTransparent){const t=We(i[0],i[1],i[2],i.length===4?i[3]:1);return new je({color:t,transparent:!0,writeDepth:!0,cullFace:ee.Front,renderOccluded:e})}const vi=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1,calloutColor:V(1,.5,0)});function Od(i,e){const t=new ce({view:i,autoScaleRenderObjects:!1,collisionPriority:1,metadata:e.metadata});return Ad(t,e),t}function Ad(i,e){var v;const t=e.material??new wd({transparent:!0,writeDepth:!1,textureId:(v=e.texture)==null?void 0:v.id,renderOccluded:$.Opaque}),a=e.focusMultiplier??vi.focusMultiplier,s=e.calloutLength??vi.calloutLength,n=vi.discRadius*(e.discScale??1),r=n*a,o=b=>{const x=[0,1,2,2,3,0];return new Hr([[O.POSITION,{size:3,data:[s-b,-b,0,s+b,-b,0,s+b,b,0,s-b,b,0],exclusive:!0}],[O.UV0,{size:2,data:[0,0,1,0,1,1,0,1]}]],[[O.POSITION,x],[O.UV0,x]])},l=rt([[0,0,0],[s-n,0,0]]),c=rt([[0,0,0],[s-r,0,0]]),p=vi.calloutColor,u=e.calloutWidth??vi.calloutWidth,m=new(u>1?Ft:Is)({width:u,color:We(p[0],p[1],p[2],e.calloutOpacity??1),renderOccluded:$.OccludeAndTransparent}),f=e.customStateMask??J.None;i.collisionType={type:"disc",direction:[0,0,1],offset:[s,0,0]},i.focusMultiplier=a,i.metadata=e.metadata,i.radius=n,i.renderObjects=[{geometry:o(n),material:t,stateMask:E.Unfocused|f},{geometry:l,material:m,stateMask:E.Unfocused|f},{geometry:o(r),material:t,stateMask:E.Focused|f},{geometry:c,material:m,stateMask:E.Focused|f}]}const Td=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function yo(i,e,t,a){const s=D(S.get(),i,t),n=bo(s,Se(S.get(),a,s),t,ne.get());rh(n,n);const r=ue(S.get(),e,n);return Math.atan2(r[1],r[0])}function bo(i,e,t,a){const s=te(S.get(),i),n=te(S.get(),e),r=Se(S.get(),s,n);return a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=0,a[4]=n[0],a[5]=n[1],a[6]=n[2],a[7]=0,a[8]=r[0],a[9]=r[1],a[10]=r[2],a[11]=0,a[12]=t[0],a[13]=t[1],a[14]=t[2],a[15]=1,a}function Ra(i,e){const t=i.getViewForGraphic(e);return h(t)&&"computeAttachmentOrigin"in t?t.computeAttachmentOrigin(e,i.spatialReference):null}function Mo(i,e,t){const a=Ra(i,t);h(a)?e.elevationAlignedLocation=a:Pd(e,t.geometry)}function Pd(i,e){if(g(e))return;const t=e.type==="mesh"?e.anchor:Gh(e);g(t)||(i.location=bl(t))}function Gt(i,e=X(i)){return e.mode!=="on-the-ground"&&!(g(i.geometry)||!i.geometry.hasZ)}var Ce;(function(i){i[i.NONE=0]="NONE",i[i.ANY=1]="ANY",i[i.Z=2]="Z",i[i.XY=4]="XY"})(Ce||(Ce={}));var G;(function(i){i[i.TRANSLATE_Z=0]="TRANSLATE_Z",i[i.TRANSLATE_XY=1]="TRANSLATE_XY",i[i.SCALE=2]="SCALE",i[i.ROTATE=3]="ROTATE",i[i.SCALE_ROTATE=4]="SCALE_ROTATE"})(G||(G={}));let So=class{constructor(){this.grabbingState=Ce.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(e){this.grabbingState=Ce.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,e.forEachManipulator((t,a)=>{if(a===G.TRANSLATE_Z&&(this.zManipulator=t),t instanceof ce&&(t.selected&&(this.numSelected===0&&(this.firstSelected=t),this.numSelected++),g(this.firstGrabbedXY)&&t.grabbing&&a===G.TRANSLATE_XY&&(this.firstGrabbedXY=t)),t.grabbing)switch(this.grabbingState|=Ce.ANY,a){case G.TRANSLATE_Z:this.grabbingState|=Ce.Z;break;case G.TRANSLATE_XY:this.grabbingState|=Ce.XY}})}};function Rd(i){const{view:e,graphic:t}=i,a=new kt({graphic:t}),s=Dd(i,a),n=[s,$d(i,s.visualElement,a),e.maskOccludee(t),e.trackGraphicState(a)];return{visualElement:s.visualElement,remove:()=>_e(n).remove()}}function Dd(i,e){const{view:t,graphic:a}=i,s=new Ht({view:t,geometry:Ms(a)?a.geometry:null,elevationInfo:X(a),attached:!1});y.visualElements.lineGraphics.shadowStyle.apply(s);const n=()=>{s.attached=e.displaying};y.visualElements.lineGraphics.outline.apply(s);const r=[I(()=>e.displaying,n),I(()=>e.isDraped,o=>{s.isDraped=o}),e.on("changed",()=>s.geometry=Ms(a)?a.geometry:null),Me(s)];return n(),{visualElement:s,remove:()=>_e(r).remove()}}function $d(i,e,t){const{graphic:a,view:s}=i,n=[],r=X(a),o=r.mode==="on-the-ground"||!r.offset&&r.mode!=="absolute-height",l=new So,c=new Fa({view:s,extensionType:y.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:$.OccludeAndTransparent});y.visualElements.pointGraphics.shadowStyle.apply(c);const p=nt(y.visualElements.heightPlaneAngleCutoff),u=new Li({view:s,attached:!1,angleCutoff:p});y.visualElements.heightPlane.apply(u);let m=1,f=1;const v=()=>{if(l.update(i),!t.displaying||o&&(t.isDraped||!Ms(a)||!a.geometry.hasZ))return e.laserlineEnabled=!1,c.attached=!1,void(u.attached=!1);e.laserlineEnabled=!0;{const w=l.grabbingState&Ce.XY?y.visualElements.laserlineAlphaMultiplier:1;w!==m&&(m=w,y.visualElements.lineGraphics.shadowStyle.apply(e,w),y.visualElements.pointGraphics.shadowStyle.apply(c,w))}{const w=l.grabbingState&Ce.Z?y.visualElements.laserlineAlphaMultiplier:1;w!==f&&(f=w,y.visualElements.heightPlane.apply(u,w))}Cd(c,l),Ld(i,e,u,l)};y.visualElements.zVerticalLine.apply(c),n.push(t.on("changed",v),I(()=>t.displaying,v),e.events.on("attachment-origin-changed",v),Me(c),Me(u));const b=[],x=()=>{_e(b).remove(),b.length=0,i.forEachManipulator(w=>b.push(w.events.on("grab-changed",v))),i.forEachManipulator(w=>b.push(w.events.on("select-changed",v))),v()};return x(),n.push(i.onManipulatorsChanged(x),Sr(()=>_e(b))),_e(n)}function Cd(i,e){const t=e.numSelected===1?e.firstSelected:e.numSelected>1&&h(e.firstGrabbedXY)?e.firstGrabbedXY:null;h(t)?(i.setStartEndFromWorldDownAtLocation(t.renderLocation),i.attached=!0):i.attached=!1}function Ld(i,e,t,a){if(a.numSelected>0){B(Et,0,0,0);let s=0;i.forEachManipulator((n,r)=>{r===G.TRANSLATE_XY&&n.selected&&n instanceof ce&&(z(Et,Et,n.renderLocation),s++)}),s>0?(t.heightManifoldTarget=W(Et,Et,1/s),t.attached=!0):t.attached=!1}else{const s=e.attachmentOrigin;h(s)&&i.view.renderCoordsHelper.toRenderCoords(s,Et)?(t.heightManifoldTarget=Et,t.attached=!0):t.attached=!1}}function Ms(i){return h(i.geometry)&&(i.geometry.type==="polygon"||i.geometry.type==="polyline")}const Et=M();function Id(i){const{view:e,graphic:t}=i,a=new kt({graphic:t}),s=[],n=Vd(i,a,s);return Gd(i,a,s,n),s.push(e.trackGraphicState(a)),{visualElement:n,remove(){_e(s).remove()}}}function Gd(i,e,t,a){const{view:s,graphic:n}=i,r=new Fa({view:s,extensionType:y.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:$.OccludeAndTransparent});y.visualElements.zVerticalLine.apply(r);const o=new Li({view:s,intersectsLineInfinite:!0,attached:!1});y.visualElements.pointGraphics.shadowStyle.apply(o);const l=nt(y.visualElements.heightPlaneAngleCutoff),c=new Li({view:s,attached:!1,angleCutoff:l});y.visualElements.heightPlane.apply(c);const p=X(i.graphic),u=ci.fromElevationInfo(p),m=p.mode==="on-the-ground"||!p.offset&&p.mode!=="absolute-height",f=new So;let v=1,b=1;const x=()=>{f.update(i);const w=Us(n),R=m&&(e.isDraped||g(w)||!w.hasZ);let H=!0;if(!R&&h(w)){const Y=Va(w,s.elevationProvider,u,s.renderCoordsHelper);B($e,w.x,w.y,Y),Aa($e,w.spatialReference,$e,s.renderCoordsHelper.spatialReference),r.setStartEndFromWorldDownAtLocation($e),o.intersectsWorldUpAtLocation=$e}else H=!1;const fe=f.grabbingState&Ce.Z?y.visualElements.laserlineAlphaMultiplier:1;fe!==v&&(v=fe,y.visualElements.heightPlane.apply(c,fe));const qe=oo(Hd);!R&&e.displaying&&a.calculateMapBounds(qe)&&Aa(Yh(qe,$e),s.spatialReference,$e,s.renderCoordsHelper.spatialReference)?(c.heightManifoldTarget=$e,c.attached=!0):c.attached=!1;const xe=f.grabbingState&Ce.XY?y.visualElements.laserlineAlphaMultiplier:1;xe!==b&&(b=xe,y.visualElements.pointGraphics.shadowStyle.apply(o,xe));const ea=H&&e.displaying&&!R;o.attached=ea,r.attached=ea};t.push(I(()=>[e.displaying,e.isDraped],x),e.on("changed",x)),i.forEachManipulator(w=>{t.push(w.events.on("grab-changed",x))}),t.push(Me(o)),t.push(Me(r)),t.push(Me(c)),x()}function Vd(i,e,t){const{view:a,graphic:s}=i,n=new vs({view:a,geometry:Us(s),elevationInfo:X(s),attached:!1});return zd(i,n,e,t),t.push(Me(n)),n}function Us(i){const e=i.geometry;return g(e)?null:e.type==="point"?e:e.type==="mesh"?e.anchor.clone():null}function zd(i,e,t,a){const s=()=>e.attached=t.displaying;Nd(i,e,t,a),y.visualElements.pointGraphics.outline.apply(e),a.push(I(()=>t.displaying,s,ke))}function Nd(i,e,t,a){const{view:s,graphic:n}=i;let r=null;const o=c=>{h(r)&&(r.remove(),r=null),t.isDraped&&h(c)&&(r=Fd(s,c,()=>{e.geometry=c}))},l=()=>{const c=Us(n);o(c),e.geometry=c};a.push(t.on("changed",l),Sr(()=>r)),l()}function Fd(i,e,t){const a=i.elevationProvider.spatialReference;Uh(e,$e,a);const s=$e[0],n=$e[1];return i.elevationProvider.on("elevation-change",r=>{ho(r.extent,s,n)&&t()})}const $e=M(),Hd=ro();function Ha(i){switch(C(i.graphic.geometry).type){case"point":case"mesh":return Id(i);case"polygon":case"polyline":return Rd(i);default:return null}}const kd=[1,.5,0],wo=128,Ye=70,Ud=80,xo=.02,jd=54,Bd=100,Eo=Math.ceil(Ye/3*2),Pt=160,Ka=.5,es=24,Xt=9,Yd=Pt+30,qn=Pt+53,Xd=60,Wd=23,Zd=5*Math.PI/12,qd=1*Math.PI/3,Qn=10,Jn=.2,Kn=30,er=53,tr=.2,ir=.3,Qd=200,Jd=3,Kd=1e6;let Ji=class{constructor(){this._available=!0}set location(e){this._forEachManipulator3D(t=>t.location=e)}set elevationAlignedLocation(e){this._forEachManipulator3D(t=>t.elevationAlignedLocation=e)}set elevationInfo(e){this._forEachManipulator3D(t=>t.elevationInfo=e)}get renderLocation(){let e;return this._forEachManipulator3D(t=>{e||(e=t.renderLocation)}),e}get available(){return this._available}set available(e){this._available=e,this._forEachManipulator3D(t=>t.available=e)}get hovering(){return this.someManipulator(e=>e.hovering)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}hasManipulator(e){return this.someManipulator(t=>t===e)}someManipulator(e){let t=!1;return this.forEachManipulator(a=>{!t&&e(a)&&(t=!0)}),t}_forEachManipulator3D(e){this.forEachManipulator((t,a)=>{t instanceof ce&&e(t,a)})}};function Da(i,e){return Oo(i,()=>e)}function ep(i){return Oo(i,e=>e.plane)}function Oo(i,e){const t=M(),a=M();let s=!1;return n=>{const r=e(n);if(n.action==="start"){const c=fa(n.screenStart,an(mt.get())),p=ai(i.state.camera,c,sr);h(p)&&(s=ri(r,p,t))}if(!s)return null;const o=fa(n.screenEnd,an(mt.get())),l=ai(i.state.camera,o,sr);return g(l)?null:ri(r,l,a)?{...n,renderStart:t,renderEnd:a,plane:r,ray:l}:null}}function tp(i,e,t,a=null,s=null){let n=null;return r=>{if(r.action==="start"&&(n=i.sceneIntersectionHelper.intersectElevationFromScreen(we(r.screenStart.x,r.screenStart.y),e,t,s),h(n)&&h(a)&&!gs(n,n,a))||g(n))return null;const o=i.sceneIntersectionHelper.intersectElevationFromScreen(we(r.screenEnd.x,r.screenEnd.y),e,t,s);return h(o)?h(a)&&!gs(o,o,a)?null:{...r,mapStart:n,mapEnd:o}:null}}function ka(i,e,t,a=null,s=null){return tp(i,t,Or(e,i,t),a,s)}function Ao(i,e,t,a=null,s=null){return ka(i,t,X(e),a,s)}function ip(i,e,t,a){const s=e.toMap(i.screenStart,{include:[t]});return h(s)?Ao(e,t,s,a):null}function ap(i,e){const t=np,a=rp,s=hi();i.renderCoordsHelper.worldUpAtPosition(e,t);const n=Se(s,t,D(a,e,i.state.camera.eye));return Se(n,n,t),Nt(e,n,s)}function To(i,e,t){let a=null;const s=new Ts;return s.next(Da(i,ap(i,e))).next(sp(i,e)).next(Po(i,t)).next(n=>{n.mapEnd.x=n.mapStart.x,n.mapEnd.y=n.mapStart.y,a=n}),n=>(a=null,s.execute(n),a)}function sp(i,e){const t=M(),a=me(e);i.renderCoordsHelper.worldUpAtPosition(e,t);const s=M(),n=M(),r=o=>(D(o,o,e),Nl(t,o,o),i.viewingMode==="global"&&me(o)*Math.sign(Ei(t,o))<.001-a&&D(o,W(o,t,.001),e),z(o,o,e),o);return o=>(o.renderStart=r(U(s,o.renderStart)),o.renderEnd=r(U(n,o.renderEnd)),o)}function Po(i,e){const t=i.renderCoordsHelper;return a=>{const s=t.fromRenderCoords(a.renderStart,e),n=t.fromRenderCoords(a.renderEnd,e);return h(s)&&h(n)?{...a,mapStart:s,mapEnd:n}:null}}var ar;(function(i){i[i.GROUND=0]="GROUND",i[i.OTHER=1]="OTHER"})(ar||(ar={}));const np=M(),rp=M(),sr=Hi();function Ua(i,e,t,a){const s=i.graphic,n=(r,o)=>e({action:r,graphic:s,dxScreen:o.screenDeltaX,dyScreen:o.screenDeltaY});return t((r,o,l)=>{const c=o.next(p=>(p.action==="start"&&n("start",p),p)).next(Ml(s,a)).next(p=>{switch(p.action){case"start":case"update":(p.translationX||p.translationY||p.translationZ)&&n("update",p);break;case"end":n("end",p)}return p});return l.next(Sl(s)).next(()=>{n("end",{screenDeltaX:0,screenDeltaY:0})}),c})}function Ro(i){if(g(i)||i.type!=="polyline"&&i.type!=="polygon")return 0;const e=(i.type==="polyline"?i.paths:i.rings)[0];if(!e||e.length<2)return 0;const t=e[0],a=e[1];return Math.atan2(a[1]-t[1],a[0]-t[0])}function $a(i){if(g(i)||g(i.axis))return 1;const{mapStart:e,mapEnd:t,axis:a}=i,s=[t.x-e.x,t.y-e.y];return s[0]*a[0]+s[1]*a[1]>0?1:-1}let op=class extends Ji{constructor(e){super(),this._handles=new ot,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=Ye,this._updateAfterDrag=!1,this.events=new Ze,this._tool=e.tool,this._view=e.view,e.radius!=null&&(this._radius=e.radius),this._createManipulators(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}set orthogonalAvailable(e){this._arrowManipulatorInfos[1].manipulator.available=e,this._arrowManipulatorInfos[3].manipulator.available=e}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._handles=k(this._handles),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(e){for(const{manipulator:t}of this._arrowManipulatorInfos)e(t,G.TRANSLATE_XY)}createGraphicDragPipeline(e,t,a){const s=t.graphic,n=X(s),r=C(s.geometry).spatialReference;return Ua(t,a,o=>this.createDragPipeline((l,c,p,u,m)=>o(l,e(l,c,p,u,m),p),n,r,s),this._view.state.viewingMode)}createDragPipeline(e,t,a,s){return _e(this._arrowManipulatorInfos.map(({manipulator:n},r)=>Le(n,(o,l,c,p,u)=>{const m=l.next(f=>({...f,manipulatorType:G.TRANSLATE_XY})).next(Si(this._view,o.elevationAlignedLocation)).next(ka(this._view,o.elevationAlignedLocation,t,a,s)).next(wl(o.location,this.angle+(r+1)*Math.PI*.5)).next(li());e(o,m,c,p,u)})))}get angle(){return this._angle}set angle(e){this._angle=e,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(e){this._radius!==e&&(this._radius=e,this._updateManipulators())}_updateManipulators(){for(let e=0;e<this._arrowManipulatorInfos.length;e++)this._updateArrowManipulator(this._arrowManipulatorInfos[e],e);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:e,transform:t},a){const s=this._radius/Ye,n=jd*s,r=n*Math.sqrt(3)/2,o=$i(r,n/2,n/2,xo);so(o,cs(ne.get(),B(S.get(),0,-r/3,0))),e.renderObjects=[{geometry:o,material:this._opaqueMaterial,stateMask:E.Focused},{geometry:o,material:this._transparentMaterial,stateMask:E.Unfocused}],e.radius=r/3*2*1.2;const l=Ds(ne.get(),a*Math.PI/2),c=cs(ne.get(),B(S.get(),0,Bd*s,0));Be(t,l,c)}_createManipulators(){for(let e=0;e<4;e++){const t=this._createArrowManipulator(e);this._arrowManipulatorInfos.push(t)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const e=this.angle,t=qr(ne.get(),e,V(0,0,1));if(g(t))return;const a=Ea(ne.get(),B(S.get(),this.displayScale,this.displayScale,this.displayScale)),s=Be(ne.get(),a,t);for(const n of this._arrowManipulatorInfos){const r=Be(ne.get(),s,n.transform);n.manipulator.modelTransform=r}}_createArrowManipulator(e){const t=new ce({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:V(0,0,1)}}),a={manipulator:t,transform:ge()};return this._updateArrowManipulator(a,e),this._handles.add(t.events.on("drag",s=>{this._updateAfterDrag&&s.action==="end"&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),a}_createMaterial(e=1){const t=K.toUnitRGBA(T.main);return t[3]*=e,new je({color:t,transparent:e!==1,cullFace:ee.Back,renderOccluded:$.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:e})=>e)}}},lp=class{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this.next=new Ts,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&h(this._lastDragEvent)){const t=this._lastDragEvent.mapEnd,a=this._snap(this._lastDragEvent.screenEnd);if(h(a)){const s={action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:e===!0?a:t,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd};this.next.execute(s)}}this._enabled=e}_snap(e){const t=h(this._view)?this._view.toMap(e,{exclude:[]}):null;return h(t)&&h(this._view)&&(t.z=Or(t,this._view,this._elevationInfo)),t}createDragEventPipelineStep(e,t){return this._view=e,this._elevationInfo=t,this._lastDragEvent=null,a=>{if(this._lastDragEvent=a.action!=="end"?{...a}:null,this._enabled){const s=this._snap(a.screenEnd);return h(s)?{action:a.action,mapStart:a.mapStart,mapEnd:s,screenStart:a.screenStart,screenEnd:a.screenEnd}:null}return{action:a.action,mapStart:a.mapStart,mapEnd:a.mapEnd,screenStart:a.screenStart,screenEnd:a.screenEnd}}}},hp=class extends Ji{constructor(e){super(),this._snapToScene=new lp,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=Ye,this._view=e.view,this._tool=e.tool,e.snapToScene!=null&&(this.snapToScene=e.snapToScene),e.radius!=null&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(e){e(this._manipulator,G.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(e){this._scale=e,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(e){this._snapToScene.enabled=e}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}createGraphicDragPipeline(e,t,a){const s=t.graphic,n=X(s),r=C(s.geometry).spatialReference;return Ua(t,a,o=>this.createDragPipeline((l,c,p,u,m)=>o(l,e(l,c,p,u,m),p),n,r,s),this._view.state.viewingMode)}createDragPipeline(e,t,a,s){const n=this._view;return Le(this._manipulator,(r,o,l,c,p)=>{const u=o.next(Si(n,r.elevationAlignedLocation)).next(ka(n,r.elevationAlignedLocation,t,a,s)).next(this._snapToScene.createDragEventPipelineStep(n,t),this._snapToScene.next).next(m=>({...m,manipulatorType:G.TRANSLATE_XY})).next(li());e(r,u,l,c,p)})}_updateManipulatorTransform(){const e=Ea(ne.get(),B(S.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=e}_createManipulator(){const e=this._view;this._manipulator=new ce({view:e,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:V(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const e=Vh(xo,1,wo,V(0,0,1),V(0,0,0)),t=Ea(ge(),V(this._radius,this._radius,this._radius));this._manipulator.renderObjects=[{geometry:e,material:this._discMaterial,transform:t,stateMask:E.Focused},{geometry:e,material:this._discMaterialTransparent,transform:t,stateMask:E.Unfocused}],this._manipulator.radius=Ud*(this._radius/Ye)}_createMaterial(e=1){const t=K.toUnitRGBA(T.main);return t[3]*=e,new je({color:t,transparent:e!==1,cullFace:ee.Back,renderOccluded:$.Transparent})}get test(){return{discManipulator:this._manipulator}}};class cp extends Ji{constructor(e){super(),this._radius=Ye,this.events=new Ze,this._tool=e.tool,this._view=e.view,e.radius!=null&&(this._radius=e.radius),this._createManipulator(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()})}forEachManipulator(e){e(this._manipulator,G.TRANSLATE_Z)}createGraphicDragPipeline(e,t,a){const s=C(t.graphic.geometry).spatialReference;return Ua(t,a,n=>this.createDragPipeline((r,o,l,c,p)=>n(r,e(r,o,l,c,p),l),s),this._view.state.viewingMode)}createDragPipeline(e,t){const a=this._view;return Le(this._manipulator,(s,n,r,o,l)=>{const c=n.next(p=>({...p,manipulatorType:G.TRANSLATE_Z})).next(To(a,s.renderLocation,t)).next(li());e(s,c,r,o,l)})}get radius(){return this._radius}set radius(e){e!==this._radius&&(this._radius=e,this._updateManipulator())}_updateManipulator(){const e=this._radius/Ye,t=y.zManipulator.height*e,a=y.zManipulator.coneHeight*e,s=y.zManipulator.coneWidth*e,n=y.zManipulator.width*e,r=[V(0,0,0),V(0,0,t)],o=zh(r,n/2,16,!1),l=_s(a,s/2,16,!1),c=[V(0,0,0),V(0,0,t+a)],p=w=>{const R=ge();if(xa(R,R,[0,0,t]),Qr(R,R,Math.PI/2),w){const H=1+2*w/s;Yi(R,R,[H,H,H])}return R},u=p(0),m=(w,R)=>{const H=Zh(y.zManipulator.color,R);return[H.r/255,H.g/255,H.b/255,y.zManipulator.color.a*w]},f=at(m(1,.25),$.Occlude),v=at(m(1,0),$.Occlude),b=at(m(.7,0),y.zManipulator.renderOccluded),x=at(m(.85,0),y.zManipulator.renderOccluded);this._manipulator.renderObjects=[{geometry:l,transform:u,material:f,stateMask:E.Unfocused},{geometry:o,material:f,stateMask:E.Unfocused},{geometry:l,transform:u,material:v,stateMask:E.Focused},{geometry:o,material:v,stateMask:E.Focused},{geometry:l,transform:u,material:b,stateMask:E.Unfocused},{geometry:o,material:b,stateMask:E.Unfocused},{geometry:l,transform:u,material:x,stateMask:E.Focused},{geometry:o,material:x,stateMask:E.Focused}],this._manipulator.radius=n/2+2,this._manipulator.collisionType={type:"line",paths:[c]}}_createManipulator(){const e=new ce({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});e.applyObjectTransform=t=>{const a=this._view.state.camera,s=nr;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,s);const n=jo(a.eye,s),r=a.computeRenderPixelSizeAtDist(n),o=D(Wt,s,a.eye);te(o,o);const l=dp;this._view.renderCoordsHelper.worldUpAtPosition(nr,l);const c=Math.abs(Ei(o,l)),p=Se(Wt,o,l),u=Se(Wt,p,l),m=Oa(c,.01,1),f=1-Math.sqrt(1-m*m)/m/a.fullWidth,v=this._radius/Ye,b=y.zManipulator.width*v;W(u,te(u,u),(1/f-1)*n+r*b),t[12]-=Wt[0],t[13]-=Wt[1],t[14]-=Wt[2]},this._manipulator=e,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const nr=M(),Wt=M(),dp=M();let Vt=class extends Ji{constructor(e){super(),this._handles=new ot,this._interactive=!0;const{tool:t,view:a,snapToScene:s,radius:n}=e;this._view=a,this.xyManipulation=new hp({tool:t,view:a,snapToScene:s,radius:n}),this.xyAxisManipulation=new op({tool:t,view:a,radius:n}),this.zManipulation=new cp({tool:t,view:a,radius:n}),this.xyManipulation.available=e.xyAvailable,this.xyAxisManipulation.available=e.xyAxisAvailable,this.zManipulation.available=e.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(r=>{this._handles.add(r.events.on("grab-changed",()=>this._updateManipulatorInteractivity()))})}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(e,t,a){return _e([this.xyManipulation.createGraphicDragPipeline((s,n,r,o,l)=>e(A.XY,s,n,r,o,l),t,a),this.xyAxisManipulation.createGraphicDragPipeline((s,n,r,o,l)=>e(A.XY_AXIS,s,n,r,o,l),t,a),this.zManipulation.createGraphicDragPipeline((s,n,r,o,l)=>e(A.Z,s,n,r,o,l),t,a)])}createDragPipeline(e,t,a,s){return _e([this.xyManipulation.createDragPipeline((n,r,o,l,c)=>e(A.XY,n,r,o,l,c),t,a,s),this.xyAxisManipulation.createDragPipeline((n,r,o,l,c)=>e(A.XY_AXIS,n,r,o,l,c),t,a,s),this.zManipulation.createDragPipeline((n,r,o,l,c)=>e(A.Z,n,r,o,l,c),a)])}set snapToScene(e){this.xyManipulation.snapToScene=e}set angle(e){this.xyAxisManipulation.angle=e}set interactive(e){this._interactive!==e&&(this._interactive=e,this._updateManipulatorInteractivity())}set radius(e){this.xyAxisManipulation.radius=e,this.xyManipulation.radius=e,this.zManipulation.radius=e}set displayScale(e){this.xyManipulation.displayScale=e,this.xyAxisManipulation.displayScale=e}forEachManipulator(e){this.xyManipulation.forEachManipulator(t=>e(t,G.TRANSLATE_XY)),this.xyAxisManipulation.forEachManipulator(t=>e(t,G.TRANSLATE_XY)),this.zManipulation.forEachManipulator(t=>e(t,G.TRANSLATE_Z))}get _xyAxisVisible(){const e=this.xyManipulation.someManipulator(t=>t.focused)||this.xyAxisManipulation.someManipulator(t=>t.focused);return this._view.inputManager&&this._view.inputManager.latestPointerType==="touch"||e}_autoHideXYAxis(){const e=this.xyAxisManipulation,t=this.xyManipulation;if(Tr("esri-mobile"))return;const a=[];t.forEachManipulator(n=>a.push(n)),e.forEachManipulator(n=>a.push(n));const s=()=>{const n=[];this._xyAxisVisible||e.forEachManipulator(r=>n.push(r.disableDisplay())),this._handles.remove(rr),this._handles.add(n,rr)};for(const n of a)this._handles.add(n.events.on("focus-changed",s));this._view.inputManager&&this._handles.add(si(()=>{var n;return(n=this._view.inputManager)==null?void 0:n.latestPointerType},s)),s()}_updateManipulatorInteractivity(){const e=this.grabbing;this.forEachManipulator(t=>{t.interactive=!e&&this._interactive||t.grabbing})}static radiusForSymbol(e){const t=h(e)&&e.type==="point-3d"&&e.symbolLayers;return t&&t.length>0&&t.some(a=>a.type==="icon")?Eo:Ye}};const rr="disable-xy-axis-display";var A;(function(i){i[i.XY=0]="XY",i[i.XY_AXIS=1]="XY_AXIS",i[i.Z=2]="Z"})(A||(A={}));let js=class extends Ji{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphicState=e.graphicState,this._createManipulator(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(e){e(this._manipulator,G.TRANSLATE_XY)}createGraphicDragPipeline(e){return Ua(this._graphicState,e,t=>this.createDragPipeline(t),this._view.state.viewingMode)}createDragPipeline(e){const t=this._view,a=this._graphicState.graphic,s=h(a.geometry)?a.geometry.spatialReference:null;return Le(this._manipulator,(n,r,o,l,c)=>{const p=r.next(ip(c,t,a,s)).next(Qt()).next(li());e(n,p,o,l,c)})}_createManipulator(){const e=this._view,t=this._graphicState.graphic;this._manipulator=new rc({graphic:t,view:e,selectable:!0,cursor:"move"})}};class pp{constructor(e){this.allGraphics=e,this.type="graphic-move-start"}}class up{constructor(e,t,a){this.dx=e,this.dy=t,this.allGraphics=a,this.type="graphic-move"}}let or=class{constructor(e){this.allGraphics=e,this.type="graphic-move-stop"}},Fe=class extends lo(Ze.EventedMixin(La)){constructor(e){super(e),this.graphics=new tc,this.enableZ=!0,this.tooltipOptions=new bt,this.type="move-3d",this._snappingPipeline=new Ma,this._tooltip=null}initialize(){const{graphics:e,view:t}=this;this.addHandles([e.on("change",()=>this._refreshManipulators()),I(()=>this.tooltipOptions.enabled,a=>{this._tooltip=a?new Fi({view:t}):k(this._tooltip)},Os)]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=k(this._tooltip),this._moveManipulation=k(this._moveManipulation),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation&&this._moveManipulation.destroy(),this.manipulators.removeAll();const e=this.graphics.toArray().filter(t=>xl(t)===Rr.SUPPORTED).map(t=>new _p(t));e.length&&(this._createManipulators(e),this._createVisualElements(e),this.handles.add(e.map(t=>this.view.trackGraphicState(t.state))),this._updateMoveManipulation(e))}_createManipulators(e){for(const t of e){const a=t.state;t.manipulationXY=new js({tool:this,view:this.view,graphicState:a}),t.manipulationXY.forEachManipulator(s=>this.handles.add([s.events.on("immediate-click",n=>{this.emit("immediate-click",{...n,graphic:a.graphic}),n.stopPropagation()}),s.events.on("grab-changed",({action:n})=>{const{tooltipOptions:r,_tooltip:o}=this;g(o)||(n==="start"?o.info=new Ci({tooltipOptions:r}):o.clear())})])),this.handles.add(t.manipulationXY.createDragPipeline((s,n,r,o)=>this._buildDragEventPipeline(e,A.XY,s,n,r,o)))}this._createMoveManipulation(e)}_createMoveManipulation(e){const t=new Vt({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:e.length===1?Vt.radiusForSymbol(e[0].graphic.symbol):Ye});this._moveManipulation=t,t.elevationInfo={mode:"absolute-height",offset:0},t.forEachManipulator(r=>{this.handles.add(r.events.on("immediate-click",o=>{t.zManipulation.hasManipulator(r)||this.graphics.length!==1||this.emit("immediate-click",{...o,graphic:this.graphics.getItemAt(0)}),o.stopPropagation()}))});const a=r=>o=>{this.handles.add(o.events.on("focus-changed",({action:l})=>{const c=this._tooltip;g(c)||(l==="focus"?this._updateMoveTooltip(e,r):c.clear())}))};this._moveManipulation.xyManipulation.forEachManipulator(a(A.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(a(A.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(a(A.Z));const s=()=>this._updateMoveManipulation(e);for(const r of e)this.handles.add([r.state.on("changed",s),I(()=>r.state.displaying,s)]);const n=e[e.length-1];this.handles.add(n.state.on("changed",()=>this._updateMoveManipulationAngle(n))),this.handles.add(t.createDragPipeline((r,o,l,c,p)=>this._buildDragEventPipeline(e,r,o,l,c,p),X(n.graphic),C(n.graphic.geometry).spatialReference,n.graphic)),this._updateMoveManipulationAngle(n)}_createVisualElements(e){for(const t of e){const a=t.graphic,s=Ha({view:this.view,graphic:a,forEachManipulator:n=>{t.manipulationXY.forEachManipulator(n),this._moveManipulation.forEachManipulator(n)},onManipulatorsChanged:()=>Ct()});g(s)||(t.geometryRepresentation=s.visualElement,t.geometryRepresentation instanceof Ht&&this.handles.add([t.geometryRepresentation.events.on("attachment-origin-changed",()=>{t.state.isDraped||this._updateMoveManipulation(e)}),I(()=>t.state.isDraped,()=>this._updateMoveManipulation(e))]),this.handles.add(s))}}_updateMoveManipulationAngle(e){this._moveManipulation.angle=Ro(e.graphic.geometry)}_updateMoveManipulation(e){const t=Qi(0,0,0,this.view.spatialReference);let a=0,s=!1;const n=this._moveManipulation;for(const r of e){if(!r.state.displaying)continue;const o=r.state.graphic;this.enableZ&&Gt(o)&&(s=!0);const l=r.geometryRepresentation instanceof Ht&&!r.state.isDraped?r.geometryRepresentation.attachmentOrigin:Ra(this.view,o);h(l)&&(t.x+=l.x,t.y+=l.y,t.z+=l.z,a++)}a>0?(t.x/=a,t.y/=a,t.z/=a,n.location=t,n.xyManipulation.available=!0,n.xyAxisManipulation.available=!0,n.zManipulation.available=s):n.available=!1}_buildDragEventPipeline(e,t,a,s,n,r){const o=[],l=[];let c=null,p=null;const u=()=>{for(const m of o)m.dragging=!1;o.length=0,l.length=0,c=null,p=null,this._moveManipulation.interactive=!0};if(n=n.next(m=>p(m)).next(()=>{if(this.emit("graphic-move-stop",new or(l)),this.destroyed)return null;u()}),e.length===1&&t===A.XY){const m=e[0].graphic;s=this._buildSnappingPipelineSteps(m,X(m),s,n,r)}return s.next(m=>{if(m.action==="start"){o.length=0,l.length=0;for(const f of e)f.dragging||!f.manipulationXY.hasManipulator(a)&&f.manipulationXY.grabbing||(o.push(f),l.push(f.graphic),f.dragging=!0);if(l.length!==0&&(this._moveManipulation.interactive=!1,c=El(l,this.view.state.viewingMode),p=Ol(l),this.emit("graphic-move-start",new pp(l)),this.destroyed))return null}return l.length!==0?m:null}).next(m=>c(m)).next(m=>(this._updateMoveTooltip(e,t,m),m)).next(m=>{switch(m.action){case"start":case"update":if(m.translationX||m.translationY||m.translationZ){const f=this.view.toScreen(m.mapStart),v=this.view.toScreen(m.mapEnd),b=v.x-f.x,x=v.y-f.y;if(this.emit("graphic-move",new up(b,x,l)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new or(l)),this.destroyed)return null;u()}})}_updateMoveTooltip(e,t,a){const{tooltipOptions:s,_tooltip:n}=this;if(g(n))return;n.clear();const r=e.length===0?"absolute-height":e[0].state.isDraped?"on-the-ground":"absolute-height";switch(t){case A.XY:n.info=new Ci({tooltipOptions:s}),this._updateMoveTooltipDistance(n.info,a,(o,l)=>st(o,l,r));break;case A.XY_AXIS:n.info=new Vs({tooltipOptions:s}),this._updateMoveTooltipDistance(n.info,a,(o,l)=>{const c=st(o,l,r);return ya(c,$a(a))});break;case A.Z:n.info=new za({tooltipOptions:s}),this._updateMoveTooltipDistance(n.info,a,va)}}_updateMoveTooltipDistance(e,t,a){if(h(t)&&t.action!=="end"){const{mapStart:s,mapEnd:n}=t,r=a(s,n);e.distance=h(r)?r:Ai}}_buildSnappingPipelineSteps(e,t,a,s,n){const r=e.geometry;if(g(r)||r.type!=="point"&&r.type!=="mesh")return a;const o=(r.type==="point"?r:r.anchor).clone(),l=new Sa({elevationInfo:t,pointer:n,editGeometryOperations:Ia.fromGeometry(o,this.view.state.viewingMode),visualizer:new Ii,excludeFeature:e}),c=this.snappingManager;return a.next(p=>(o.z=Xo(this.view,o,X(e),{mode:"absolute-height",offset:0}),{...p,snapOrigin:l.coordinateHelper.pointToVector(o)})).next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:l,snappingManager:c,cancel:s,updatingHandles:this.updatingHandles}),this._snappingPipeline.next)}get test(){return{tooltip:this._tooltip}}};d([_({constructOnly:!0,nonNullable:!0})],Fe.prototype,"view",void 0),d([_()],Fe.prototype,"graphics",void 0),d([_({constructOnly:!0,nonNullable:!0})],Fe.prototype,"enableZ",void 0),d([_({constructOnly:!0,type:bt})],Fe.prototype,"tooltipOptions",void 0),d([_({constructOnly:!0})],Fe.prototype,"snappingManager",void 0),d([_()],Fe.prototype,"type",void 0),d([_()],Fe.prototype,"updating",null),Fe=d([Q("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],Fe);let _p=class{constructor(e){this.state=null,this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new kt({graphic:e})}get graphic(){return this.state.graphic}};function lr(i,e,t){const a=t.mode==="on-the-ground"?hn.XY:hn.XYZ;return new Al(i,a,e,0)}function hr(i,e,t){const a=M();if(!i.renderCoordsHelper.toRenderCoords(e,a))return null;const s=cr(i,e,qi(t.plane)),n=cr(i,e,t.edgeDirection);if(g(s)||g(n))return null;const r=Se(M(),s,n);return Nt(a,r,hi())}function cr(i,e,t){const a=Qi(e.x+t[0],e.y+t[1],e.z+t[2],e.spatialReference),s=M(),n=M();return i.renderCoordsHelper.toRenderCoords(e,s)&&i.renderCoordsHelper.toRenderCoords(a,n)?xr(n,s,n):null}function gp(i,e,t){const a=qi(i),s=xr(M(),e,t),n=Se(M(),s,a),r=Se(M(),s,n);return lh(s[0],s[1],s[2],0,n[0],n[1],n[2],0,r[0],r[1],r[2],0,0,0,0,1)}function mp(i,e,t){const a=t.projectToRenderScreen(i,rs()),s=t.projectToRenderScreen(e,rs());return h(a)&&h(s)?Bo(D(a,a,s)):0}let gt=class extends Ca{constructor(e){super(e),this.type="reshape-edge-offset",this.distance=Ai,this.area=null,this.totalLength=null}};d([_()],gt.prototype,"type",void 0),d([_()],gt.prototype,"distance",void 0),d([_()],gt.prototype,"area",void 0),d([_()],gt.prototype,"totalLength",void 0),gt=d([Q("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],gt);let Z=class extends Ze.EventedMixin(Gs){constructor(i){super(i),this._vertexManipulatorMaterial=at(y.colorToVec4(y.reshapeManipulators.vertex.color),y.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=fi(y.colorToVec4(y.reshapeManipulators.vertex.outlineColor),y.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=fi(y.colorToVec4(y.reshapeManipulators.vertex.hoverOutlineColor),y.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=at(y.colorToVec4(y.reshapeManipulators.edge.color),y.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=fi(y.colorToVec4(y.reshapeManipulators.edge.outlineColor),y.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=at(y.colorToVec4(y.reshapeManipulators.edgeOffset.color),y.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=at(y.colorToVec4(y.reshapeManipulators.edgeOffset.hoverColor),y.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=at(y.colorToVec4(y.reshapeManipulators.selected.color),y.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=fi(y.colorToVec4(y.reshapeManipulators.selected.outlineColor),y.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=fi(y.colorToVec4(y.reshapeManipulators.selected.hoverOutlineColor),y.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._vertexManipulatorGeometry=null,this._vertexManipulatorOutlineGeometry=null,this._edgeManipulatorGeometry=null,this._edgeManipulatorOutlineGeometry=null,this._edgeOffsetManipulatorGeometryInside=null,this._edgeOffsetManipulatorGeometryOutside=null,this._manipulatorHandles=new ot,this._manipulatorInfos=[],this._editGeometryOperations=null,this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=F.NONE,this._outlineVisualElement=null,this._segmentLabels=null,this.outputGeometry=null,this._snappingPipeline=new Ma,this._snappingPipelineHandle=new Ma,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:i,view:e}=this,t=this._graphicState=new kt({graphic:i});this._tooltip=new Fi({view:e}),this.addHandles([I(()=>t.displaying,a=>{for(const s of this._manipulatorInfos)s.manipulator.available=a}),I(()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:a,enabled:s,edgeOffsetEnabled:n})=>{h(a)&&(a.visible=s,a.edgeDistance=n?"far":"default")},ke),si(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),ke),this.view.trackGraphicState(t)])}destroy(){this._segmentLabels=k(this._segmentLabels),this._tooltip=k(this._tooltip),this._removeManipulators()}get inputGeometry(){return h(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(i){this._recreateEditGeometryAndManipulators(i)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const i=this._manipulatorInfos.filter(e=>e.manipulator.selected&&e.type==="vertex");this._removeVertices(i)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=k(this._moveManipulation),this._graphicMoveManipulation=k(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(){if(g(this._editGeometryOperations))return;const i=X(this.graphic);for(const e of this._editGeometryOperations.data.components){for(const t of e.vertices)this._createVertexOrEdgeManipulator(t,i);for(const t of e.edges)this._createVertexOrEdgeManipulator(t,i)}this._createGraphicMoveManipulation(),this._createMoveManipulation(i),this._createVisualElements()}get canRedo(){return h(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return h(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if(g(this._editGeometryOperations))return null;const i=this._editGeometryOperations.redo();return h(i)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),i}undo(){if(g(this._editGeometryOperations))return null;this.emit("undo");const i=this._editGeometryOperations.undo();return h(i)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),i}_recreateManipulators(){this._removeManipulators(),this._tooltip.clear(),this._createManipulators()}_recreateEditGeometryAndManipulators(i=this.inputGeometry){this._removeManipulators(),this._tooltip.clear(),g(i)||(k(this._editGeometryOperations),this._editGeometryOperations=Ia.fromGeometry(i,this.view.state.viewingMode),this._createManipulators(),k(this._segmentLabels),this._segmentLabels=new Ta({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:X(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled}))}_perGraphicManipulatorDragAction(i,e){if(e.action==="end")return e;let t=0;const a=[],s=this._manipulatorInfos.some(r=>r.type==="vertex"&&r.manipulator.selected),n=i===ei.SELECTED_OR_ALL&&s;for(const r of this._manipulatorInfos)r.type==="vertex"&&(r.manipulator.grabbing||n&&!r.manipulator.selected||a.push(r),t++);if(a.length===0)return e;if(this._moveVertices(a,e),a.length===t){if(this._updateEventState(F.MOVING),this.destroyed)return e;this.emit("move",{type:"move",dx:e.screenDeltaX,dy:e.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(F.RESHAPING),this.destroyed)return e;this.emit("reshape",{type:"reshape",mover:this.graphic})}return e}_isMultiVertexSelection(){let i=0;for(const e of this._manipulatorInfos)e.type==="vertex"&&e.manipulator.selected&&i++;return i>1}_perVertexManipulatorDragAction(i){if(this._updateEventState(F.RESHAPING),this.destroyed)return;const{mapDeltaX:e,mapDeltaY:t,mapDeltaZ:a}=i;if(!e&&!t&&!a)return;const s=[];for(const n of this._manipulatorInfos)n.type==="vertex"&&(n.manipulator.selected&&!n.manipulator.grabbing||n===i.info)&&s.push(n);this._moveVertices(s,i,tt.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(i){if(i===this._reshapeEventState)return!1;switch(i){case F.NONE:if(this._numGrabbing!==0||this._numDragging!==0)return!1;switch(this._reshapeEventState){case F.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case F.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case F.MOVING:switch(this._reshapeEventState){case F.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case F.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case F.RESHAPING:switch(this._reshapeEventState){case F.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case F.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const e=this._reshapeEventState!==i;return this._reshapeEventState=i,e}_createGraphicMoveManipulation(){const{tool:i,view:e}=this,t=this._graphicState;if(this._graphicMoveManipulation=new js({tool:i,view:e,graphicState:t}),this.enableMoveGraphic){let a=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((s,n,r)=>{n.next(o=>this._trackNumDragging(o)).next(o=>(o.action==="start"&&(a=C(this._editGeometryOperations).createUndoGroup()),o)).next(o=>this._perGraphicManipulatorDragAction(ei.ALL,o)).next(o=>(this._updateTranslateGraphicTooltip(A.XY,o),o)).next(o=>{o.action==="end"&&(this._tooltip.clear(),a=St(a))}),r.next(()=>this._onDragCancel(!0,()=>a=St(a)))})),this._graphicMoveManipulation.forEachManipulator(s=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(s,!1)))}else this._graphicMoveManipulation.forEachManipulator(a=>{a.grabbable=!1,a.cursor=null});this._graphicMoveManipulation.forEachManipulator(a=>this._manipulatorHandles.add(a.events.on("immediate-click",s=>{this._manipulatorInfos.some(n=>n.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...s,graphic:this.graphic}),s.stopPropagation()})))}_createMoveManipulation(i){const{graphic:e,handles:t,tool:a,view:s}=this,n=this._graphicState;this._moveManipulation=new Vt({tool:a,view:s,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Gt(e),snapToScene:!1,radius:Vt.radiusForSymbol(e.symbol)}),this._moveManipulation.forEachManipulator(l=>t.add([l.events.on("immediate-click",c=>{this._moveManipulation.zManipulation.hasManipulator(l)||this._manipulatorInfos.some(p=>p.manipulator.selected)||this.emit("immediate-click",{...c,graphic:e}),c.stopPropagation()}),this._watchAndUpdateGrabState(l,!1)]));const r=l=>c=>{t.add(c.events.on("focus-changed",({action:p})=>{p==="focus"&&this._tooltipOptions.enabled?this._updateTranslateTooltip(l):this._tooltip.clear()}))};this._moveManipulation.xyManipulation.forEachManipulator(r(A.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(r(A.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(r(A.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const o=C(e.geometry).spatialReference;t.add([this._moveManipulation.createDragPipeline((l,c,p,u,m)=>(u=u.next(f=>(this._onDragCancel(),f)),p.next(f=>this._trackNumDragging(f)).next(f=>{const v=this._manipulatorInfos.filter(b=>b.type==="vertex"&&b.manipulator.selected);return f.manipulatorType===G.TRANSLATE_XY&&v.length===1?{...f,info:v[0],snapOrigin:v[0].handle.pos}:f}).next(cn(this.view,i,e)).next(this._snappingPipelineHandle.createSnapDragEventPipelineStep({predicate:f=>!!f.info,cancel:u,snappingManager:a.snappingManager,snappingContext:new Sa({editGeometryOperations:C(this._editGeometryOperations),elevationInfo:i,pointer:m,excludeFeature:e,visualizer:new Ii}),updatingHandles:this.updatingHandles,useZ:!1}),this._snappingPipelineHandle.next).next(Qt()).next(f=>this._perGraphicManipulatorDragAction(ei.SELECTED_OR_ALL,f)).next(f=>(this._updateTranslateTooltip(l,f),f))),i,o,e),I(()=>n.displaying,()=>{this._updateMoveManipulationPosition()},ke),n.on("changed",()=>this._updateMoveManipulationPosition()),I(()=>n.isDraped,l=>{this._updateMoveManipulationPosition();const c="align-move-manipulation";l?t.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),c):t.remove(c)},ke)])}_createVisualElements(){const{graphic:i,view:e}=this,t=Ha({view:e,graphic:i,forEachManipulator:a=>{if(!this.destroyed){this._graphicMoveManipulation.forEachManipulator(a),this._moveManipulation.forEachManipulator(a);for(const s of this._manipulatorInfos)a(s.manipulator,G.TRANSLATE_XY)}},onManipulatorsChanged:a=>this.on("manipulators-changed",a)});h(t)&&(this._outlineVisualElement=t.visualElement instanceof Ht?t.visualElement:null),h(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._manipulatorHandles.add(t)}_createEdgeOffsetManipulator(i,e=X(this.graphic)){const t=y.reshapeManipulators.edgeOffset,a=t.size/2,s=a+t.collisionPadding;if(g(this._edgeOffsetManipulatorGeometryInside)||g(this._edgeOffsetManipulatorGeometryOutside)){const u=a/s,m=u*Math.sqrt(3)/2;this._edgeOffsetManipulatorGeometryInside=$i(m,u/2,u/2,t.height,t.offset),this._edgeOffsetManipulatorGeometryOutside=$i(-m,u/2,u/2,t.height,-t.offset)}const n=[{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorMaterial,stateMask:E.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryInside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:E.Focused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorMaterial,stateMask:E.Unfocused},{geometry:this._edgeOffsetManipulatorGeometryOutside,material:this._edgeOffsetManipulatorHoverMaterial,stateMask:E.Focused}],r=new ce({view:this.view,renderObjects:n,elevationInfo:e.mode!=="on-the-ground"||Sn(this.graphic.symbol)?{mode:"absolute-height",offset:0}:e,worldOriented:!1,focusMultiplier:1,radius:s,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionType:{type:"disc",direction:V(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),o=new ce({view:this.view,renderObjects:[],worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),l={manipulator:r,handle:i,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:o,elevationInfo:e,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(l,t.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(l);const c=[];for(const u of[l.handle.leftVertex,l.handle.rightVertex]){const m=this._getManipulatorInfoFromHandle(u);h(m)&&c.push(m.manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(l)))}l.locationUpdateHandle=_e(c),this._manipulatorHandles.add(l.locationUpdateHandle,r),this._manipulatorHandles.add([this._watchAndUpdateGrabState(r,!0),this._watchAndUpdateGrabState(o,!0)],r),this._manipulatorHandles.add(Le(r,this._createEdgeOffsetPipeline(l,e)),r),this._manipulatorHandles.add(Le(o,(u,m,f,v)=>{if(v==="touch")this._createEdgeOffsetPipeline(l,e)(u,m,f);else if(this.enableMoveGraphic){const b=this.graphic,x=h(b.geometry)?b.geometry.spatialReference:null;m.next(w=>this._trackNumDragging(w)).next(Si(this.view,u.elevationAlignedLocation)).next(ka(this.view,u.elevationAlignedLocation,e,x,b)).next(li()).next(Qt()).next(w=>this._perGraphicManipulatorDragAction(ei.ALL,w)).next(w=>(this._updateTranslateGraphicTooltip(A.XY,w),w)).next(w=>{w.action==="end"&&this._tooltip.clear()}),f.next(()=>this._onDragCancel(!u.metadata.deleting))}}),r);const p=u=>{this._manipulatorInfos.some(m=>m.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...u,graphic:this.graphic}),u.stopPropagation()};return this._manipulatorHandles.add([r.events.on("immediate-click",p),o.events.on("immediate-click",p),r.events.on("focus-changed",({action:u})=>{const m=this._tooltipOptions;if(u==="focus"&&m.enabled){const f=this._tooltip.info=new gt({tooltipOptions:m});this._updateTooltipAreaOrTotalLength(f)}else this._tooltip.clear()})],r),this._manipulatorInfos.push(l),this.manipulators.add(r),this.manipulators.add(o),this.emit("manipulators-changed"),l}_autoHideEdgeOffsetManipulator(i,e){const t=i.manipulator,a=i.edgeManipulator,s=()=>{i.visibilityHandle=St(i.visibilityHandle);const n=this._getManipulatorInfoFromHandle(i.handle.leftVertex),r=this._getManipulatorInfoFromHandle(i.handle.rightVertex),o=h(n)&&h(r)&&mp(n.manipulator.renderLocation,r.manipulator.renderLocation,this.view.state.camera)<e;(!t.focused&&!a.focused||o)&&(t.grabbable=!o,a.grabbable=!o,i.visibilityHandle=_e([t.disableDisplay(),{remove:()=>{t.grabbable=!0,a.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([t.events.on("focus-changed",s),a.events.on("focus-changed",s),{remove:()=>{St(i.visibilityHandle),a.metadata.deleting=!0,this.manipulators.remove(a)}}],t),s()}_updateEdgeOffsetManipulator(i){this._updateManipulatorPosition(i);const{coordinateHelper:e}=C(this._editGeometryOperations).data,t=hr(this.view,i.manipulator.elevationAlignedLocation,lr(e,i.handle,C(i.manipulator.elevationInfo))),a=this._getManipulatorInfoFromHandle(i.handle.leftVertex),s=this._getManipulatorInfoFromHandle(i.handle.rightVertex);if(g(a)||g(s))return;const n=a.manipulator.renderLocation,r=s.manipulator.renderLocation,o=h(t)?gp(t,n,r):hh;i.manipulator.modelTransform=o,i.edgeManipulator.elevationAlignedLocation=i.manipulator.elevationAlignedLocation,i.edgeManipulator.modelTransform=o;const l=me(D(la,n,r))/2;i.edgeManipulator.collisionType={type:"line",paths:[[[-l,0,0],[l,0,0]]]}}_createEdgeOffsetPipeline(i,e){return(t,a,s)=>{this._clearSelection();const{step:n,cleanup:r}=this._initializeEdgeOffset(i,e);a.next(o=>this._trackNumDragging(o)).next(Si(this.view,t.elevationAlignedLocation)).next(n).next(ep(this.view)).next(Po(this.view,C(this._editGeometryOperations).data.spatialReference)).next(Qt()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(i)).next(this._showEdgeOffsetTooltip()).next(o=>{o.action==="end"&&r()}),s.next(()=>{t.metadata.deleting||(r(),this._onDragCancel())})}}_initializeEdgeOffset(i,e){const t=C(this._editGeometryOperations),a=lr(t.data.coordinateHelper,i.handle,e),s=t.createUndoGroup(),n=hr(this.view,i.manipulator.elevationAlignedLocation,a);if(a.requiresSplitEdgeLeft){const u=this._getManipulatorInfoFromHandle(i.handle.leftVertex.leftEdge);h(u)&&this._splitEdgeManipulator(u,1)}if(a.requiresSplitEdgeRight){const u=this._getManipulatorInfoFromHandle(i.handle.rightVertex.rightEdge);h(u)&&this._splitEdgeManipulator(u,0)}const r=()=>new cl({paths:[[i.handle.leftVertex.pos,i.handle.rightVertex.pos]],spatialReference:t.data.spatialReference}),o=new Ht({view:this.view,isDraped:this._graphicState.isDraped,geometry:r(),elevationInfo:i.elevationInfo,width:y.visualElements.lineGraphics.outline.width,color:y.colorToVec4(T.main),attached:!0});let l;const c=()=>{this._cleanEdgeOffsetCollapsedEdges(i),l=St(l)},p=this.on("undo",c);return l=_e([Me(o),I(()=>this._graphicState.isDraped,u=>o.isDraped=u),this._graphicState.on("changed",()=>o.geometry=r()),s,p]),{step:u=>g(a)||g(n)?(c(),null):{...u,operation:a,plane:n},cleanup:c}}_applyEdgeOffsetStep(i){return e=>{if(this.destroyed||g(e.operation))return e;this._updateEventState(F.RESHAPING);const{mapDeltaX:t,mapDeltaY:a,mapDeltaZ:s}=e;return(t||a||s)&&(this._offsetEdge(i,e),this.emit("reshape",{type:"reshape",mover:this.graphic})),e}}_applyComputeEdgeOffsetDistanceStep(){return i=>{const{operation:e,mapEnd:t}=i;return g(e)||g(t)?i:(i.action==="start"&&e.selectArrowFromStartPoint(t),{...i,signedDistance:e.signedDistanceToPoint(t)})}}_showEdgeOffsetTooltip(){return i=>{const{mapEnd:e,signedDistance:t,operation:a}=i,s=this._tooltip,n=this._tooltipOptions;if(!n.enabled||g(t))return s.clear(),i;let r=s.info;(g(r)||r.type!=="reshape-edge-offset")&&(r=s.info=new gt({tooltipOptions:n}));const{coordinateHelper:o}=C(this._editGeometryOperations).data;return r.distance=i.action==="end"?Ai:fp(this._graphicState.isDraped,t*a.selectedArrow,e,a.plane,o),this._updateTooltipAreaOrTotalLength(r),i}}_cleanEdgeOffsetCollapsedEdges(i){var o,l;const e=(o=i.handle.leftVertex.leftEdge)==null?void 0:o.leftVertex,t=i.handle.leftVertex,a=(l=i.handle.rightVertex.rightEdge)==null?void 0:l.rightVertex,s=i.handle.rightVertex,n=C(this._editGeometryOperations).data.coordinateHelper,r=[];if(e&&n.distance(e.pos,t.pos)<ts){const c=this._getManipulatorInfoFromHandle(t);h(c)&&r.push(c)}if(n.distance(t.pos,s.pos)<ts||a&&n.distance(a.pos,s.pos)<ts){const c=this._getManipulatorInfoFromHandle(s);h(c)&&r.push(c)}r.length&&this._removeVertices(r)}_computeVertexManipulatorSizeAndOutline(i){const e=i.size/2,t=e+i.collisionPadding;return{size:e/t,outlineSize:(e+i.outlineSize)/t}}_createVertexOrEdgeManipulator(i,e=X(this.graphic)){if(i.type==="edge"){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(i,e);if(!this.enableMidpoints)return null}if(g(this._vertexManipulatorGeometry)||g(this._vertexManipulatorOutlineGeometry)){const{size:r,outlineSize:o}=this._computeVertexManipulatorSizeAndOutline(y.reshapeManipulators.vertex);this._vertexManipulatorGeometry=bi(r,16,16),this._vertexManipulatorOutlineGeometry=bi(o,16,16)}if(g(this._edgeManipulatorGeometry)||g(this._edgeManipulatorOutlineGeometry)){const{size:r,outlineSize:o}=this._computeVertexManipulatorSizeAndOutline(y.reshapeManipulators.edge);this._edgeManipulatorGeometry=bi(r,16,16),this._edgeManipulatorOutlineGeometry=bi(o,16,16)}const t=h(this.graphic.geometry)&&this.graphic.geometry.type==="point"?[]:[{geometry:this._vertexManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:De.Vertex|E.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorOutlineMaterial,stateMask:De.Vertex|E.Unfocused|E.Unselected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:De.Vertex|E.Focused|E.Unselected},{geometry:this._vertexManipulatorGeometry,material:this._selectedManipulatorMaterial,stateMask:E.Selected},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorOutlineMaterial,stateMask:E.Selected|E.Unfocused},{geometry:this._vertexManipulatorOutlineGeometry,material:this._selectedManipulatorHoverOutlineMaterial,stateMask:E.Selected|E.Focused}];this.enableMidpoints&&t.push({geometry:this._edgeManipulatorGeometry,material:this._vertexManipulatorMaterial,stateMask:De.Edge|E.Focused|E.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._vertexManipulatorHoverOutlineMaterial,stateMask:De.Edge|E.Focused|E.Unselected},{geometry:this._edgeManipulatorGeometry,material:this._edgeManipulatorMaterial,stateMask:De.Edge|E.Unfocused|E.Unselected},{geometry:this._edgeManipulatorOutlineGeometry,material:this._edgeManipulatorOutlineMaterial,stateMask:De.Edge|E.Unfocused|E.Unselected});const a=new ce({view:this.view,renderObjects:t,elevationInfo:e,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer.visible),metadata:{deleting:!1}});this._setTypeSpecificManipulatorSettings(a,i,e);const s=i.type==="edge"?{manipulator:a,handle:i,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:a,handle:i,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(s),this.manipulators.add(a),this._updateManipulatorPosition(s),s.type==="edge"){const r=[];for(const o of[s.handle.leftVertex,s.handle.rightVertex]){const l=this._getManipulatorInfoFromHandle(o);h(l)&&r.push(l.manipulator.events.on("location-update",()=>this._updateManipulatorPosition(s)))}s.locationUpdateHandle=_e(r),this._manipulatorHandles.add(s.locationUpdateHandle,a)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(a,!0),a);const n=Le(a,(r,o,l,c)=>{let p=null;l=l.next(u=>(this._onDragCancel(!r.metadata.deleting,()=>p=St(p)),u)),o.next(u=>this._trackNumDragging(u)).next(u=>{if(u.action==="start"&&(p=C(this._editGeometryOperations).createUndoGroup()),s.type==="edge"){const m=this._splitEdgeManipulator(s);return{...u,info:m,snapOrigin:m.handle.pos}}return{...u,info:s,snapOrigin:s.handle.pos}}).next(Si(this.view,r.elevationAlignedLocation)).next(Ao(this.view,this.graphic,r.elevationAlignedLocation,r.location.spatialReference,this.graphic)).next(cn(this.view,e,this.graphic)).next(this._snappingPipeline.createSnapDragEventPipelineStep({predicate:()=>!this._isMultiVertexSelection(),cancel:l,snappingManager:this.tool.snappingManager,snappingContext:new Sa({editGeometryOperations:C(this._editGeometryOperations),elevationInfo:e,pointer:c,excludeFeature:this.graphic,visualizer:new Ii}),updatingHandles:this.updatingHandles,useZ:!1}),this._snappingPipeline.next).next(Qt()).next(u=>{this._perVertexManipulatorDragAction(u),u.action==="end"&&(p=St(p)),this._updateTranslateVertexTooltip(r,A.XY,u)})});return this._manipulatorHandles.add([n,a.events.on("immediate-click",r=>this._manipulatorClickCallback(r,s)),a.events.on("select-changed",()=>{s.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}),a.events.on("focus-changed",({action:r})=>{r==="focus"&&s.type!=="edge"?this._updateTranslateVertexTooltip(a,A.XY):this._tooltip.clear()})],a),this.emit("manipulators-changed"),s}_trackNumDragging(i){switch(i.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return i}_onDragCancel(i=!0,e){switch(this._numDragging--,i&&(this.undo(),this.outputGeometry=h(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null),h(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case F.NONE:break;case F.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case F.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}e&&e(),this.destroyed||this._updateEventState(F.NONE)}_setTypeSpecificManipulatorSettings(i,e,t){switch(e.type){case"vertex":i.state=De.Vertex,i.selectable=!0,i.cursor="move",i.collisionPriority=2,i.radius=y.reshapeManipulators.vertex.size/2+y.reshapeManipulators.vertex.collisionPadding,i.elevationInfo=t,i.interactive=h(this.graphic.geometry)&&this.graphic.geometry.type!=="point";break;case"edge":i.state=De.Edge,i.selectable=!1,i.cursor="copy",i.collisionPriority=-1,i.radius=y.reshapeManipulators.edge.size/2+y.reshapeManipulators.edge.collisionPadding,i.elevationInfo=t.mode!=="on-the-ground"||Sn(this.graphic.symbol)?{mode:"absolute-height",offset:0}:t}}_watchAndUpdateGrabState(i,e){return i.events.on("grab-changed",t=>this._onGrabStateChanged(i,e,t.action,t.pointerType))}_onGrabStateChanged(i,e,t,a="mouse"){if(t==="start")e&&this._updateSelection(i),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(F.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,(a!=="touch"||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(s=>{s.manipulator.interactive=s.manipulator.grabbing||!this._numGrabbing&&h(this.graphic.geometry)&&this.graphic.geometry.type!=="point","edgeManipulator"in s&&(s.edgeManipulator.interactive=s.edgeManipulator.grabbing||!this._numGrabbing)}),this._graphicMoveManipulation.forEachManipulator(s=>{s.interactive=s.grabbing||!this._numGrabbing}))}_clearSelection(){for(const i of this._manipulatorInfos)i.manipulator.grabbing||(i.manipulator.selected=!1)}_updateSelection(i){i.grabbing&&!i.selected&&i.selectable&&(this._clearSelection(),i.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(i){g(i)||(i.manipulator.metadata.deleting=!0,this.manipulators.remove(i.manipulator),this._manipulatorHandles.remove(i.manipulator),zo(this._manipulatorInfos,i),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(i){if(i){for(const e of this._manipulatorInfos)if(i===e.handle)return e}return null}_updateManipulatorPosition(i){if(g(i))return;const e=C(this._editGeometryOperations);if(i.type==="vertex")i.manipulator.location=e.data.coordinateHelper.vectorToDehydratedPoint(i.handle.pos,yi),i.manipulator.grabbing&&h(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=i.manipulator.renderLocation);else if(i.type==="edge"){const t=this._getManipulatorInfoFromHandle(i.handle.leftVertex),a=this._getManipulatorInfoFromHandle(i.handle.rightVertex);if(g(t)||g(a))return;const s=t.manipulator,n=a.manipulator;if(h(i.manipulator.elevationInfo)&&i.manipulator.elevationInfo.mode==="on-the-ground"){const r=s.location,o=n.location,l=.5,c=r.x+l*(o.x-r.x),p=r.y+l*(o.y-r.y),u=r.hasZ&&o.hasZ?0:void 0;i.manipulator.location=Qi(c,p,u,e.data.spatialReference)}else _t(la,s.renderLocation,n.renderLocation,.5),i.manipulator.renderLocation=la}}_splitEdgeManipulator(i,e=.5){const t=C(this._editGeometryOperations),a=C(t.splitEdge(i.handle,e).createdVertex);i.locationUpdateHandle.remove(),i.locationUpdateHandle=void 0;const s=X(this.graphic);let n;this.enableEdgeOffset?(this._removeManipulator(i),n=this._createVertexOrEdgeManipulator(a)):(n=i,n.handle=a,n.type="vertex",this._setTypeSpecificManipulatorSettings(i.manipulator,i.handle,s)),a.leftEdge&&this._createVertexOrEdgeManipulator(a.leftEdge),a.rightEdge&&this._createVertexOrEdgeManipulator(a.rightEdge),this.outputGeometry=t.data.geometry,this._updateManipulatorPosition(n),this.enableEdgeOffset||this._updateTranslateVertexTooltip(n.manipulator,A.XY),this._updateSelection(i.manipulator);const r=this._updateEventState(F.RESHAPING),o=t.data.coordinateHelper.vectorToArray(n.handle.pos),l=t.data.components.indexOf(a.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:o,componentIndex:l,vertexIndex:C(a.index)}],added:o}),r&&this._updateEventState(F.NONE),n}_updateMoveManipulationPosition(){const i=B(la,0,0,0);let e=0,t=!1,a=null,s=null;for(const n of this._manipulatorInfos)n.type==="vertex"&&(n.manipulator.selected?(e++,z(i,i,n.manipulator.renderLocation),g(a)||n.selectedIndex>a.selectedIndex?(s=a,a=n):(g(s)||n.selectedIndex>s.selectedIndex)&&(s=n)):t=!0);if(e!==0){const n=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=n,this._moveManipulation.xyAxisManipulation.available=n,this._moveManipulation.zManipulation.available=n&&this.enableZVertex&&Gt(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=n&&e!==1}else{const n=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=n,this._moveManipulation.xyAxisManipulation.available=n,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=n,this._moveManipulation.zManipulation.available=n&&this.enableZShape&&Gt(this.graphic)}if(e!==0){let n=0;if(h(a)){const r=a.handle.pos,o=h(s)?s.handle.pos:a.handle.leftEdge&&a.handle.leftEdge.leftVertex?a.handle.leftEdge.leftVertex.pos:null,l=g(s)&&a.handle.rightEdge&&a.handle.rightEdge.rightVertex?a.handle.rightEdge.rightVertex.pos:null;o&&l?this._moveManipulation.xyAxisManipulation.available=!1:o?n=dr(o,r):l&&(n=dr(r,l))}this._moveManipulation.angle=n,this._moveManipulation.radius=Eo}else this._moveManipulation.angle=Ro(C(this.graphic.geometry)),this._moveManipulation.radius=Vt.radiusForSymbol(this.graphic.symbol);e!==0&&t?(W(i,i,1/e),yi.spatialReference=C(this._editGeometryOperations).data.spatialReference,yi.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(i,yi),this._moveManipulation.elevationAlignedLocation=yi):h(this._outlineVisualElement)&&!this._graphicState.isDraped&&h(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:Mo(this.view,this._moveManipulation,this.graphic)}_removeVertices(i){const e=[],t=C(this._editGeometryOperations);for(const a of i)if(a.type==="vertex"&&t.canRemoveVertex()){e.push(a.handle),this._removeManipulator(a),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(a.handle.rightEdge));const s=C(t.removeVertices([a.handle]).removedVertices[0].createdEdge);s&&this._createVertexOrEdgeManipulator(s)}if(e.length>0){const a=e.map(n=>{const r=t.data.components.indexOf(n.component);return{coordinates:t.data.coordinateHelper.vectorToArray(n.pos),componentIndex:r,vertexIndex:C(n.index)}});this.outputGeometry=t.data.geometry;const s=this._updateEventState(F.RESHAPING);if(this.destroyed||(this.emit("vertex-remove",{type:"vertex-remove",removed:a.map(n=>n.coordinates),vertices:a}),this.destroyed)||s&&(this._updateEventState(F.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(i,e,t=e.action==="start"?tt.NEW_STEP:tt.ACCUMULATE_STEPS){const a=C(this._editGeometryOperations);a.moveVertices(i.map(s=>s.handle),e.mapDeltaX,e.mapDeltaY,e.mapDeltaZ,t),this.outputGeometry=a.data.geometry;for(const s of i)this._updateManipulatorPosition(s)}_offsetEdge(i,e){if(g(e.operation)||g(e.signedDistance))return;const t=C(this._editGeometryOperations),a=e.operation.clone();a.distance=e.signedDistance,t.updateVertices([i.handle.leftVertex,i.handle.rightVertex],a),this.outputGeometry=t.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(i.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(i.handle.rightVertex))}_manipulatorClickCallback(i,e){i.shiftKey||this._clearSelection(),e.type==="vertex"&&(e.manipulator.selected=!e.manipulator.selected,i.button===dn.Right&&this._removeVertices([e])),e.type==="edge"&&i.button===dn.Left&&this._splitEdgeManipulator(e),i.stopPropagation()}_updateTranslateTooltip(i,e){const t=this._manipulatorInfos.filter(a=>a.type==="vertex"&&a.manipulator.selected);t.length===1?this._updateTranslateVertexTooltip(t[0].manipulator,i,e):this._updateTranslateGraphicTooltip(i,e)}_updateTranslateGraphicTooltip(i,e){const t=this._tooltipOptions;if(!t.enabled)return;const a=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(i){case A.XY:this._tooltip.info=new Ci({tooltipOptions:t}),this._updateTranslateTooltipDistance(this._tooltip.info,e,(s,n)=>st(s,n,a));break;case A.XY_AXIS:this._tooltip.info=new Vs({tooltipOptions:t}),this._updateTranslateTooltipDistance(this._tooltip.info,e,(s,n)=>{const r=st(s,n,a);return ya(r,$a(e))});break;case A.Z:this._tooltip.info=new za({tooltipOptions:t}),this._updateTranslateTooltipDistance(this._tooltip.info,e,va)}}_updateTranslateVertexTooltip(i,e,t){const a=this._tooltipOptions;if(!a.enabled)return;let s;const n=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(e){case A.XY:s=new hc({tooltipOptions:a}),this._updateTranslateTooltipDistance(s,t,(o,l)=>st(o,l,n)),this._updateTooltipAreaOrTotalLength(s);break;case A.XY_AXIS:s=new lc({tooltipOptions:a}),this._updateTranslateTooltipDistance(s,t,(o,l)=>{const c=st(o,l,n);return ya(c,$a(t))}),this._updateTooltipAreaOrTotalLength(s);break;case A.Z:s=new oc({tooltipOptions:a}),this._updateTranslateTooltipDistance(s,t,va)}const r=Jo(i.elevationAlignedLocation);h(r)&&(s.elevation={mode:"absolute-height",...r}),this._tooltip.info=s}_updateTranslateTooltipDistance(i,e,t){if(h(e)&&e.action!=="end"){const{mapStart:a,mapEnd:s}=e,n=t(a,s);i.distance=h(n)?n:Ai}}_updateTooltipAreaOrTotalLength(i){const{geometry:e}=this.graphic;if(g(e))return;const t=this._graphicState.isDraped?"on-the-ground":"absolute-height";i.area=e.type==="polygon"?cc(e,t):null,i.totalLength=e.type==="polyline"?Ko(e,t):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function dr(i,e){return Math.atan2(e[1]-i[1],e[0]-i[0])+Math.PI/2}function fp(i,e,t,a,s){if(i){const n=s.toXYZ(s.pointToVector(t)),r=wh(a,n,S.get()),o=el(r,n,s.spatialReference);if(h(o))return Ti(o.value*Math.sign(e),o.unit)}return Ti(e*os(t.spatialReference),"meters")}d([_()],Z.prototype,"_segmentLabels",void 0),d([_({constructOnly:!0})],Z.prototype,"tool",void 0),d([_()],Z.prototype,"_tooltip",void 0),d([_()],Z.prototype,"inputGeometry",null),d([_()],Z.prototype,"outputGeometry",void 0),d([_({readOnly:!0})],Z.prototype,"updating",null),d([_()],Z.prototype,"manipulators",null),d([_()],Z.prototype,"view",null),d([_()],Z.prototype,"graphic",null),d([_()],Z.prototype,"enableZShape",null),d([_()],Z.prototype,"enableZVertex",null),d([_()],Z.prototype,"enableMoveGraphic",null),d([_()],Z.prototype,"enableMidpoints",null),d([_()],Z.prototype,"enableEdgeOffset",null),d([_()],Z.prototype,"_labelOptions",null),d([_()],Z.prototype,"_tooltipOptions",null),Z=d([Q("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Z);const yi=Qi(0,0,null,null),la=M(),ts=1e-6;var De,F,ei;(function(i){i.Vertex=J.Custom1,i.Edge=J.Custom2})(De||(De={})),function(i){i[i.NONE=0]="NONE",i[i.MOVING=1]="MOVING",i[i.RESHAPING=2]="RESHAPING"}(F||(F={})),function(i){i[i.ALL=0]="ALL",i[i.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(ei||(ei={}));let se=class extends Ze.EventedMixin(La){constructor(i){super(i),this._handles=new ot,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new Dr,this.tooltipOptions=new bt,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const i=this._reshapeOperation=new Z({tool:this});this.addHandles([i.on("reshape",e=>{e.type==="reshape"&&this._onReshapeGeometryChanged(),this.emit("reshape",e)}),i.on("move",e=>{e.type==="move"&&this._onReshapeGeometryChanged(),this.emit("move",e)}),i.on("vertex-add",e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)}),i.on("vertex-remove",e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)}),i.on("immediate-click",e=>this.emit("immediate-click",e)),this.view.on("pointer-down",["Shift"],e=>{e.stopPropagation()}),I(()=>this.graphic,()=>this._updateGraphic(),Os)]),this.finishToolCreation()}destroy(){this._handles=k(this._handles),this._reshapeOperation=k(this._reshapeOperation)}get updating(){var i;return((i=this._reshapeOperation)==null?void 0:i.updating)??!1}_updateGeometry(){const i=Tl(this.graphic);this._reshapeOperation.inputGeometry=h(i)?i.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),Pl(this.graphic)!==Rr.SUPPORTED)return;const i=I(()=>{var e;return(e=this.graphic)==null?void 0:e.geometry},()=>{this._internalGeometryUpdate===!1&&this._updateGeometry()},_a);this._handles.add(i,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(i){this._internalGeometryUpdate=!0,this.graphic.geometry=i,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){g(this.graphic)||this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){h(this.snappingManager)&&this.snappingManager.doneSnapping(),h(this._reshapeOperation.undo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){h(this.snappingManager)&&this.snappingManager.doneSnapping(),h(this._reshapeOperation.redo())&&this._updateGeometryInternally(this._reshapeOperation.outputGeometry.clone())}onInputEvent(i){i.type!=="key-down"||i.key!=="Delete"&&i.key!=="Backspace"||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};d([_()],se.prototype,"_reshapeOperation",void 0),d([_({constructOnly:!0,nonNullable:!0})],se.prototype,"view",void 0),d([_({constructOnly:!0})],se.prototype,"graphic",void 0),d([_({constructOnly:!0,nonNullable:!0})],se.prototype,"enableZShape",void 0),d([_({constructOnly:!0,nonNullable:!0})],se.prototype,"enableZVertex",void 0),d([_({constructOnly:!0,nonNullable:!0})],se.prototype,"enableMoveGraphic",void 0),d([_({constructOnly:!0,nonNullable:!0})],se.prototype,"enableMidpoints",void 0),d([_({constructOnly:!0,nonNullable:!0})],se.prototype,"enableEdgeOffset",void 0),d([_()],se.prototype,"type",void 0),d([_({constructOnly:!0,type:Dr})],se.prototype,"labelOptions",void 0),d([_({constructOnly:!0,type:bt})],se.prototype,"tooltipOptions",void 0),d([_({constructOnly:!0})],se.prototype,"snappingManager",void 0),d([_()],se.prototype,"updating",null),d([_()],se.prototype,"automaticManipulatorSelection",void 0),se=d([Q("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],se);let Qe=class extends Ca{constructor(e){super(e),this.type="transform-rotate",this.rotationType="geographic"}};d([_()],Qe.prototype,"type",void 0),d([_()],Qe.prototype,"rotation",void 0),d([_()],Qe.prototype,"rotationPrecision",void 0),d([_()],Qe.prototype,"orientation",void 0),d([_()],Qe.prototype,"orientationPrecision",void 0),d([_()],Qe.prototype,"rotationType",void 0),Qe=d([Q("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Qe);let ut=class extends Ca{constructor(e){super(e),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};d([_()],ut.prototype,"type",void 0),d([_()],ut.prototype,"scale",void 0),d([_()],ut.prototype,"size",void 0),d([_()],ut.prototype,"sizeUnit",void 0),d([_()],ut.prototype,"sizePrecision",void 0),ut=d([Q("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],ut);let Ee=class extends Ca{constructor(i){super(i),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};d([_()],Ee.prototype,"type",void 0),d([_()],Ee.prototype,"orientation",void 0),d([_()],Ee.prototype,"orientationEnabled",void 0),d([_()],Ee.prototype,"orientationPrecision",void 0),d([_()],Ee.prototype,"rotationType",void 0),d([_()],Ee.prototype,"size",void 0),d([_()],Ee.prototype,"sizeUnit",void 0),d([_()],Ee.prototype,"sizeEnabled",void 0),d([_()],Ee.prototype,"sizePrecision",void 0),Ee=d([Q("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],Ee);var L,oi;(function(i){i.ScaleIn=J.Custom2,i.ScaleOut=J.Custom3,i.RotateLeft=J.Custom4,i.RotateRight=J.Custom5,i.Unlocked=J.Custom7,i.DelayedFocused=J.Custom8,i.TouchInput=J.Custom12})(L||(L={}));class vp{constructor({adapter:e,tooltipOptions:t,mode:a,tool:s}){this._mode=null,this._handles=new ot,this._scaleRotateDragData=null,this._activeAnimation=null,this.events=new Ze,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>h(this._scaleRotateDragData)&&this._scaleRotateDragData.mode==="scale"?this._adapter.scale:1,this.tool=s,this._mode=a,this._adapter=e,this._tooltipOptions=t,this._tooltip=new Fi({view:s.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add(si(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),ke))}get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(e){this._ringManipulator.location=e}set elevationAlignedLocation(e){this._ringManipulator.elevationAlignedLocation=e}get grabbing(){return this._ringManipulator.grabbing}set interactive(e){this._ringManipulator.interactive=e}destroy(){h(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=k(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=k(this._tooltip)}startAnimation(e){this.cancelActiveAnimation(),e.start();const t=Go({update:({deltaTime:a})=>{e.update(a)&&this.cancelActiveAnimation()}});this._activeAnimation={...e,frameTask:t}}cancelActiveAnimation(){h(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=k(this._activeAnimation))}forEachManipulator(e){e(this._ringManipulator,G.SCALE_ROTATE)}_createManipulator(){const e=this._createRingManipulator();this._ringManipulator=e,this.tool.manipulators.add(e);const t=this.tool.graphicState.graphic,a=Le(e,(s,n,r)=>{this._scaleRotateDragData=null;const o=this._adapter.startInteraction(),l={mode:"none",origin:ma(s.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=l,this._updateDragState();const c=S.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(s.renderLocation,c),n.next(Da(this.tool.view,Nt(s.renderLocation,c,hi()))).next(p=>{const u=qi(p.plane),m=yo(p.renderStart,p.renderEnd,l.origin,u),f=dc.shortestSignedDiff(l.angle,m);l.angleDir=Oa(l.angleDir+f,-ir,ir),l.angle=m;const v=yp(l,p),b=v-this._adapter.scale;if(l.scaleDir=Oa(l.scaleDir+b,-tr,tr),this._onScaleChanged(),l.mode==="none"){const x=this._mode||bp(p,p.plane,l.origin,this.tool.view.state.camera);if(h(x)){switch(x){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:t,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:t,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()})}l.mode=x}}switch(l.mode){case"rotate":o.state.angle=l.initialAngle+m;break;case"scale":o.state.scale=v,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),p.action){case"start":case"update":switch(l.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:t,angle:Di(l.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:t,xScale:v,yScale:v})}break;case"end":switch(l.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:Di(l.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:v,yScale:v})}}return p.action==="end"&&(this.startAnimation(pr(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),o.done()),p}).next(this._updateTooltipPipelineStep(l)),r.next(()=>{if(o.cancel(),h(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:t,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:t,xScale:1,yScale:1})}this.startAnimation(pr(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()})});this._handles.add([a,e.events.on("focus-changed",s=>{s.action==="focus"?this.startAnimation(Mp(this,()=>this._updateDelayedFocusedState())):this._updateDelayedFocusedState()}),e.events.on("immediate-click",s=>{s.stopPropagation()}),I(()=>{var s;return(s=this.tool.graphicState)==null?void 0:s.displaying},s=>this._ringManipulator.available=s,ke)])}_updateTooltipPipelineStep(e){return t=>{const a=this._tooltipOptions;if(!a.enabled)return t;if(t.action==="end")return this._updateFocusTooltip(),t;const s=this._tooltip,n=this._tooltipOptions.visualVariables,r=h(n)?n.size:null,o=h(n)?n.rotation:null;switch(e.mode){case"scale":s.info=new ut({tooltipOptions:a,scale:{value:this._adapter.scale},size:Ti(q(this._adapter.size,-1),"meters"),sizeUnit:h(r)?r.unit:null,sizePrecision:h(r)?ca(r.valueType):null});break;case"rotate":{const l=h(o)?ca(o.valueType):null,c=h(o)?o.rotationType:"geographic";s.info=new Qe({tooltipOptions:a,rotation:Ya(q(-this._adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:l,orientation:Ya(-this._adapter.angle,"radians","geographic"),orientationPrecision:l,rotationType:c})}}return t}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const e=this._tooltipOptions.visualVariables,t=h(e)?e.rotation:null,a=h(e)?e.size:null;this._tooltip.info=new Ee({tooltipOptions:this._tooltipOptions,orientation:Ya(-this._adapter.angle,"radians","geographic"),orientationEnabled:this._mode==null||this._mode==="rotate",orientationPrecision:h(t)?ca(t.valueType):null,rotationType:h(t)?t.rotationType:"geographic",size:Ti(q(this._adapter.size,-1),"meters"),sizeUnit:h(a)?a.unit:null,sizeEnabled:this._mode==null||this._mode==="scale",sizePrecision:h(a)?ca(a.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(L.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(L.Unlocked,!(h(this._scaleRotateDragData)&&this._scaleRotateDragData.mode!=="none")),h(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(L.ScaleIn|L.ScaleOut,!1),this._ringManipulator.updateStateEnabled(L.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(L.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(L.RotateLeft|L.RotateRight,!1),this._ringManipulator.updateStateEnabled(L.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(L.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(L.ScaleIn|L.ScaleOut|L.RotateLeft|L.RotateRight,!1)}_updateManipulatorTransform(){const e=qr(ne.get(),this._adapter.angle,V(0,0,1));if(g(e))return;const t=this.getScale(),a=Ea(ne.get(),B(S.get(),t,t,t));this._ringManipulator.modelTransform=Be(ne.get(),a,e)}_createRingManipulator(){const e=(Y,Ve,lt)=>{const ht=[],ct=Math.ceil(wo*(Ve-Y)/(2*Math.PI));for(let oe=0;oe<ct+1;oe++){const di=Y+oe*(Ve-Y)/ct;ht.push(V(lt*Math.cos(di),lt*Math.sin(di),0))}return ht},t=Y=>e(0,2*Math.PI,Y),a=Y=>[[-Y/2,0],[Y/2,0],[Y/2,Ka/2],[-Y/2,Ka/2]],s=(Y,Ve)=>no(a(Ve),Y,[],[],!1),n=t(Pt),r=s(n,es),o={left:[],right:[]},l=[];for(let Y=0;Y<2;Y++){const Ve=Y*Math.PI-Math.PI/4,lt=Math.PI/2-Zd,ht=Ve+lt,ct=Ve+Math.PI/2-lt,oe=e(ht,ct,Yd),di=s(oe,Xt);l.push(oe),l.push(e(ht,ct,qn-es/2)),o.left.push(di),o.right.push(di);for(let Ba=0;Ba<2;Ba++){const Ys=Ba===0,ve=ge();if(Ys){Yi(ve,ve,[1,-1,1]),fn(ve,ve,-ht,[0,0,1]);const Mt=Math.round(Jn*(oe.length-1));ve[12]=oe[Mt][0],ve[13]=oe[Mt][1],ve[14]=oe[Mt][2]}else{fn(ve,ve,ct,[0,0,1]);const Mt=Math.round((1-Jn)*(oe.length-1));ve[12]=oe[Mt][0],ve[13]=oe[Mt][1],ve[14]=oe[Mt][2]}const Xs=$i(Xd,0,Wd,Ka);so(Xs,ve),(Ys?o.left:o.right).push(Xs)}}const c=[];for(let Y=0;Y<2;Y++){const Ve=Y*Math.PI-Math.PI/4,lt=Math.PI/2-qd,ht=Ve+lt,ct=Ve+Math.PI/2-lt,oe=e(ht,ct,qn);c.push(s(oe,Xt))}const p=t(Pt+Kn),u=t(Pt+er),m=s(p,Xt),f=s(u,Xt),v=t(Pt-Kn),b=t(Pt-er),x=s(v,Xt),w=s(b,Xt),R=this._createMaterial(),H=this._createMaterial(.66),fe=this._createMaterial(.5),qe=this._createMaterial(.33);let xe=[{geometry:r,material:R,stateMask:L.DelayedFocused},{geometry:r,material:fe,stateMask:E.None}];this._mode&&this._mode!=="scale"||(xe=xe.concat([{geometry:c,material:R,stateMask:L.DelayedFocused|L.Unlocked},{geometry:m,material:H,stateMask:L.DelayedFocused|L.ScaleIn},{geometry:f,material:qe,stateMask:L.DelayedFocused|L.ScaleIn},{geometry:x,material:H,stateMask:L.DelayedFocused|L.ScaleOut},{geometry:w,material:qe,stateMask:L.DelayedFocused|L.ScaleOut}])),this._mode&&this._mode!=="rotate"||(xe=xe.concat([{geometry:o.right,material:R,stateMask:L.DelayedFocused|L.Unlocked},{geometry:o.left,material:R,stateMask:L.DelayedFocused|L.RotateLeft},{geometry:o.right,material:R,stateMask:L.DelayedFocused|L.RotateRight}]));const ea=[n,...l];return new ce({view:this.tool.view,renderObjects:xe,autoScaleRenderObjects:!1,worldOriented:!0,radius:es,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:X(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:ea,direction:V(0,0,1)}})}_createMaterial(e=1){const t=Ut([...kd,e]);return new je({color:t,transparent:e!==1,cullFace:ee.Back,renderOccluded:$.Transparent})}get test(){return{ringManipulator:this._ringManipulator,tooltip:this._tooltip}}}function yp(i,e){const t=D(S.get(),e.renderStart,i.origin),a=D(S.get(),e.renderEnd,i.origin),s=me(t),n=me(a);return s===0?0:n/s}function bp(i,e,t,a){const{renderStart:s,renderEnd:n}=i,r=ha(s,a,S.get()),o=ha(n,a,S.get());if(wr(r,o)<Qn*Qn)return null;const l=D(S.get(),s,t),c=Se(S.get(),l,qi(e)),p=s,u=z(S.get(),p,c),m=ha(t,a,S.get()),f=r,v=ha(u,a,S.get()),b=D(S.get(),v,f),x=D(S.get(),r,m),w=ls(f,b),R=ls(m,x);return un(w,o)<un(R,o)?"rotate":"scale"}function ha(i,e,t){return e.projectToScreen(i,is),B(t,is[0],is[1],0)}function pr(i,e){let t=null,a=1;const s=()=>a;return{start:()=>{a=i.getScale(),t=i.getScale,i.getScale=s,e()},update:n=>(a+=((a+1)/2-a)*Math.min(n*Jd,1),e(),Math.abs(a-1)<.01?oi.STOP:oi.CONTINUE),destroy:()=>{i.getScale=t,e()}}}function Mp(i,e){let t=0,a=null;const s=()=>!1;return{start:()=>{a=i.getFocused,i.getFocused=s,t=0,e()},update:n=>(t+=n,!a()||t>Qd?oi.STOP:oi.CONTINUE),destroy:()=>{i.getFocused=a,e()}}}function ca(i){switch(i){case"integer":case"long":return 0;default:return null}}(function(i){i[i.CONTINUE=0]="CONTINUE",i[i.STOP=1]="STOP"})(oi||(oi={}));const is=we();function Do(i){return h(i.geometry)&&i.geometry.type==="mesh"?Sp(i.geometry):wp(i)}function Sp(i){return h(i.transform)?xp(i,i.transform):Ep(i)}function wp(i){let e=i.geometry,t=No;return{undo(a){t=a.geometry,a.geometry=e},redo(a){e=a.geometry,a.geometry=t}}}function xp(i,e){let t=e.clone(),a=null;return{undo:s=>{a=h(i.transform)?i.transform.clone():null,i.transform=t,s.notifyGeometryChanged()},redo:s=>{t=h(i.transform)?i.transform.clone():null,i.transform=a,s.notifyGeometryChanged()}}}function Ep(i){let e,t=i.vertexAttributes.clonePositional();return{undo:a=>{e=i.vertexAttributes.clonePositional(),i.vertexAttributes=t,a.notifyGeometryChanged()},redo:a=>{t=i.vertexAttributes.clonePositional(),i.vertexAttributes=e,a.notifyGeometryChanged()}}}let Je=class extends Gs{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([si(()=>h(this._interactionState)&&this._interactionState.angle!==this._interactionState.previousAngle?{interactionState:this._interactionState,angle:this._interactionState.state.angle}:null,({interactionState:e})=>{this._updateMeshRotation(e)},_a),si(()=>h(this._interactionState)&&this._interactionState.scale!==this._interactionState.previousScale?{interactionState:this._interactionState,scale:this._interactionState.state.scale}:null,({interactionState:e})=>{this._updateMeshSize(e)},_a)])}get angle(){const e=this.geometry.transform;if(g(e))return 0;const t=pc(e.rotation)[2];return Math.abs(t)>.999999?nt(uc(e.rotation))*Math.sign(t):0}get scale(){return h(this._interactionState)?this._interactionState.scale:1}startInteraction(){const e=new Ke({angle:this.angle});this._interactionState=e;const t=()=>this._interactionState=null;return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return Do(this.graphic)}_updateMeshRotation(e){const t=this.geometry.anchor,a=this.viewingMode===Ri.Global,{angle:s,previousAngle:n}=e;this.geometry.rotate(0,0,Di(s-n),{origin:t,geographic:a}),e.previousAngle=s,h(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(e){const t=this.geometry.anchor,a=this.viewingMode===Ri.Global,{scale:s,previousScale:n}=e;this.geometry.scale(s/n,{origin:t,geographic:a}),e.previousScale=s,h(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};d([_({constructOnly:!0})],Je.prototype,"graphic",void 0),d([_({constructOnly:!0})],Je.prototype,"geometry",void 0),d([_({constructOnly:!0})],Je.prototype,"viewingMode",void 0),d([_()],Je.prototype,"angle",null),d([_()],Je.prototype,"scale",null),d([_()],Je.prototype,"_interactionState",void 0),Je=d([Q("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Je);let Ke=class extends Ni{constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}cancel(){this.angle=this.initialAngle,this.scale=1}};d([_()],Ke.prototype,"angle",void 0),d([_()],Ke.prototype,"initialAngle",void 0),d([_()],Ke.prototype,"previousAngle",void 0),d([_()],Ke.prototype,"previousScale",void 0),d([_()],Ke.prototype,"scale",void 0),d([_()],Ke.prototype,"state",null),Ke=d([Q("InteractionState")],Ke);let le=class extends Gs{constructor(e){super(e),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles(si(()=>h(this._interactionState)?this._interactionState.state:null,e=>{this._updateSymbol(e)},_a))}get angle(){return h(this._interactionState)?this._interactionState.angle:h(this._orientationReferenceSymbolLayer)?Op(this._orientationReferenceSymbolLayer.heading):0}get scale(){return h(this._interactionState)?this._interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return h(this._interactionState)?this._interactionState.initialAngle:0}get size(){const e=this._sizeReferenceSymbolLayer;if(g(e))return null;const t=this.findLayerView(),a=this._graphicSymbol;if(g(t)||g(a)||a.type!=="point-3d")return null;const s=t.getSymbolLayerSize(a,e);if("size"in s&&h(s.size))return s.size;const n=this.sizeAxis;return"width"in s&&h(s.width)&&(g(n)||n==="width"||n==="all"||n==="width-and-depth")?s.width:"depth"in s&&h(e.depth)&&(g(n)||n==="depth"||n==="all"||n==="width-and-depth")?s.depth:"height"in s&&h(e.height)&&(g(n)||n==="height"||n==="all")?s.height:null}get _sizeReferenceSymbolLayer(){const e=this._graphicSymbol;return g(e)||e.symbolLayers.length===0?null:e.symbolLayers.find(t=>t.type==="object")}get _orientationReferenceSymbolLayer(){const e=this._graphicSymbol;return g(e)||e.symbolLayers.length===0?null:e.symbolLayers.find(t=>t.type==="object"&&h(t.heading))}get _graphicSymbol(){return h(this.graphic)&&h(this.graphic.symbol)&&this.graphic.symbol.type==="point-3d"?this.graphic.symbol:null}set _graphicSymbol(e){this.graphic.symbol=e}startInteraction(){const e=this._graphicSymbol,t=this.findLayerView();if(h(this._interactionState)||g(e)||g(t))return Ap;const a=e.symbolLayers.map(l=>l.type==="object"?t.getSymbolLayerSize(e,l):null).toArray(),s=e.clone(),n=this.angle,r=new et({originalSymbol:s,angle:n,initialSizes:a});this._interactionState=r;const o=()=>this._interactionState=null;return{state:r,done:o,cancel:()=>{this._graphicSymbol=s,o()}}}createUndoRecord(){let e=this.graphic.symbol,t=null;return{undo:a=>{t=a.symbol,a.symbol=e},redo:a=>{e=a.symbol,a.symbol=t}}}_updateSymbol({scale:e,angle:t,originalSymbol:a,initialSizes:s}){const n=this._graphicSymbol;if(g(n)||n.type!=="point-3d")return;const r=n.clone(),o=-Di(t-this.initialAngle);let l=!1;this._forEachObjectSymbolLayerPair(a,r,(c,p,u)=>{const m=q(c.heading,0)+o;p.heading!==m&&(p.heading=m,l=!0);const f=s[u];if(h(f)&&"width"in f){f.width=this.sizeFilter(f.width),f.height=this.sizeFilter(f.height),f.depth=this.sizeFilter(f.depth);const v=f.width*e;p.width!==v&&(p.width=v,l=!0);const b=f.depth*e;p.depth!==b&&(p.depth=b,l=!0);const x=f.height*e;p.height!==x&&(p.height=x,l=!0)}}),l&&(this._graphicSymbol=r)}_forEachObjectSymbolLayerPair(e,t,a){e.symbolLayers.forEach((s,n)=>{const r=t.symbolLayers.getItemAt(n);s.type==="object"&&r.type==="object"&&a(s,r,n)})}};function Op(i){return-nt(i)}d([_()],le.prototype,"angle",null),d([_()],le.prototype,"scale",null),d([_()],le.prototype,"relativeAngle",null),d([_()],le.prototype,"initialAngle",null),d([_()],le.prototype,"size",null),d([_()],le.prototype,"sizeAxis",void 0),d([_({constructOnly:!0})],le.prototype,"graphic",void 0),d([_()],le.prototype,"_interactionState",void 0),d([_({constructOnly:!0})],le.prototype,"findLayerView",void 0),d([_({constructOnly:!0})],le.prototype,"sizeFilter",void 0),d([_()],le.prototype,"_sizeReferenceSymbolLayer",null),d([_()],le.prototype,"_orientationReferenceSymbolLayer",null),d([_()],le.prototype,"_graphicSymbol",null),le=d([Q("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],le);const Ap={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let et=class extends Ni{constructor(e){super(e),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=e.angle}get state(){const{originalSymbol:e,angle:t,initialAngle:a,scale:s,initialSizes:n}=this;return{originalSymbol:e,angle:t,initialAngle:a,scale:s,initialSizes:n}}};d([_()],et.prototype,"originalSymbol",void 0),d([_()],et.prototype,"angle",void 0),d([_()],et.prototype,"initialAngle",void 0),d([_()],et.prototype,"initialSizes",void 0),d([_()],et.prototype,"scale",void 0),d([_()],et.prototype,"state",null),et=d([Q("InteractionState")],et);let de=class extends lo(Ze.EventedMixin(La)){constructor(i){super(i),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new bt,this.type="transform-3d",this._scaleRotate=null,this._snappingPipeline=new Ma,this._tooltip=null}initialize(){const{graphic:i,view:e}=this;this.graphicState=new kt({graphic:i}),this.addHandles(I(()=>this.tooltipOptions.enabled,s=>{this._tooltip=s?new Fi({view:e}):k(this._tooltip)},Os)),this._moveManipulation=new Vt({tool:this,view:e,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Gt(i),radius:Vt.radiusForSymbol(i.symbol)}),this._moveManipulation.forEachManipulator(s=>this.handles.add(s.events.on("immediate-click",n=>{this.emit("immediate-click",{...n,graphic:i}),n.stopPropagation()})));const t=s=>n=>{this.handles.add(n.events.on("focus-changed",({action:r})=>{const o=this._tooltip;g(o)||(r==="focus"?this._updateMoveTooltip(s):o.clear())}))};this._moveManipulation.xyManipulation.forEachManipulator(t(A.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(t(A.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(t(A.Z)),this._moveManipulation.elevationInfo=X(i);const a=i.geometry;if(this._moveManipulation.createGraphicDragPipeline((s,n,r,o,l)=>(h(a)&&s===A.XY&&(r=r.next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new Sa({elevationInfo:X(i),pointer:l,editGeometryOperations:Ia.fromGeometry(new It({spatialReference:a.spatialReference}),e.state.viewingMode),visualizer:new Ii,excludeFeature:i}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:o,useZ:!1}),this._snappingPipeline.next)),r=r.next(c=>(this._updateMoveTooltip(s,c),c))),this.graphicState,s=>{const{action:n,graphic:r,dxScreen:o,dyScreen:l}=s,c={graphic:r,dxScreen:o,dyScreen:l};switch(n){case"start":this.emit("graphic-translate-start",c),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",c);break;case"end":this.emit("graphic-translate-stop",c)}}),this._moveManipulation.angle=h(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add(I(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),this.enableScaling||this.enableRotation){const s=this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate";this._scaleRotate=new vp({tool:this,mode:s,adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()))}this.handles.add([Ha({view:this.view,graphic:this.graphic,forEachManipulator:s=>this._forEachManipulator(s),onManipulatorsChanged:()=>Ct()}),this.graphicState.on("changed",()=>this._onGeometryChanged()),this._hideManipulatorsForGraphicState(),I(()=>e.scale,()=>this._updateMoveAngle())]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(s=>{s instanceof ce&&this.handles.add(s.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))}),this.finishToolCreation()}destroy(){this._tooltip=k(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=k(this._scaleRotate),this._scaleRotateAdapter=k(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){g(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return h(this.graphic.geometry)&&this.graphic.geometry.type==="mesh"?new Je({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new le({graphic:this.graphic,sizeFilter:i=>this._enforceNonZeroSize(i),findLayerView:()=>this.view.allLayerViews.find(i=>i.layer===this.graphic.layer),sizeAxis:h(this.tooltipOptions.visualVariables)&&h(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(i){this._moveManipulation.forEachManipulator(i),h(this._scaleRotate)&&this._scaleRotate.forEachManipulator(i)}_hideManipulatorsForGraphicState(){return I(()=>this.graphicState.displaying,i=>{this._forEachManipulator(e=>e.available=i),this._moveManipulation.zManipulation.available=i&&this.enableZ&&Gt(this.graphic)})}_createGeometryUndoRecord(){return Do(this.graphic)}set snapToScene(i){this._moveManipulation&&(this._moveManipulation.snapToScene=i),this._set("snapToScene",i)}get updating(){return this.updatingHandles.updating}set location(i){this._moveManipulation.location=i,h(this._scaleRotate)&&(this._scaleRotate.location=i)}set elevationAlignedLocation(i){this._moveManipulation.elevationAlignedLocation=i,h(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=i)}reset(){}onHide(){h(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if(g(this._scaleRotate))return;const i=this._scaleRotate.getScale();this._moveManipulation.displayScale=i}_updateMoveAngle(){this.view.state.viewingMode===Ri.Local||this.view.scale<Kd?this._moveManipulation.angle=this._scaleRotateAdapter.angle:this._moveManipulation.angle=0}_onGeometryChanged(){Mo(this.view,this,this.graphic)}_enforceNonZeroSize(i){return i||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(i,e){const{tooltipOptions:t,_tooltip:a}=this;if(g(a))return;a.clear();const s=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(i){case A.XY:a.info=new Ci({tooltipOptions:t}),this._updateMoveTooltipDistance(a.info,e,(n,r)=>st(n,r,s));break;case A.XY_AXIS:a.info=new Vs({tooltipOptions:t}),this._updateMoveTooltipDistance(a.info,e,(n,r)=>{const o=st(n,r,s);return ya(o,$a(e))});break;case A.Z:a.info=new za({tooltipOptions:t}),this._updateMoveTooltipDistance(a.info,e,va)}}_updateMoveTooltipDistance(i,e,t){if(h(e)&&e.action!=="end"){const{mapStart:a,mapEnd:s}=e,n=t(a,s);i.distance=h(n)?n:Ai}}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:h(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};d([_({constructOnly:!0,nonNullable:!0})],de.prototype,"view",void 0),d([_({constructOnly:!0,nonNullable:!0})],de.prototype,"graphic",void 0),d([_({constructOnly:!0,nonNullable:!0})],de.prototype,"enableZ",void 0),d([_()],de.prototype,"enableRotation",void 0),d([_()],de.prototype,"enableScaling",void 0),d([_({constructOnly:!0,type:bt})],de.prototype,"tooltipOptions",void 0),d([_()],de.prototype,"graphicState",void 0),d([_({value:!1})],de.prototype,"snapToScene",null),d([_({constructOnly:!0})],de.prototype,"snappingManager",void 0),d([_({readOnly:!0})],de.prototype,"type",void 0),d([_({readOnly:!0})],de.prototype,"updating",null),de=d([Q("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],de);let pt=class extends _c(Vo){constructor(i){super(i),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(i){return this.heading===i.heading&&this.tilt===i.tilt&&Fo(this.position,i.position)&&this.width===i.width&&this.height===i.height}};d([_({readOnly:!0,json:{read:!1,write:!0}})],pt.prototype,"type",void 0),d([_({type:It}),_i()],pt.prototype,"position",void 0),d([_({type:Number,nonNullable:!0,range:{min:0,max:360}}),_i(),Ws(i=>wn.normalize(Qs(i),0,!0))],pt.prototype,"heading",void 0),d([_({type:Number,nonNullable:!0,range:{min:0,max:360}}),_i(),Ws(i=>wn.normalize(Qs(i),0,!0))],pt.prototype,"tilt",void 0),d([_({type:Number,nonNullable:!0}),_i()],pt.prototype,"width",void 0),d([_({type:Number,nonNullable:!0}),_i()],pt.prototype,"height",void 0),pt=d([Q("esri.analysis.SlicePlane")],pt);Tr("mac");const Tp=2,Pp=1.15,Rp=1.15,Dp=.7,Ki=V(1,.5,0);Ut([...Ki,Dp]);Ut([...Ki,.5]);const $p=We(1,1,1,1),Cp=We(1,.8,.6,1),Lp=We(1,.93,.86,1),Ip=Ut([...Ki,1]),Gp=Ut([...Ki,1]),Vp=3,ur=11,Ss=22.5,as=40,_r=48,zp=2.25,Np=Ut([...Ki,1]),Fp=4,gr=1,Hp=.3,kp=6,Up=4;function jp(i){const e=new Xi;e.extensions.add("GL_OES_standard_derivatives");const{vertex:t,fragment:a,attributes:s,varyings:n}=e;return Rs(t,i),s.add(O.POSITION,"vec3"),s.add(O.UV0,"vec2"),n.add("vUV","vec2"),t.code.add(P`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),a.uniforms.add([new vt("backgroundColor",r=>r.backgroundColor),new vt("gridColor",r=>r.gridColor),new he("gridWidth",r=>r.gridWidth)]),a.code.add(P`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),e}const Bp=Object.freeze(Object.defineProperty({__proto__:null,build:jp},Symbol.toStringTag,{value:"Module"}));class Bs extends ki{initializeProgram(e){return new Ui(e.rctx,Bs.shader.get().build(this.configuration),Ps)}initializePipeline(){return Wi({blending:bh(Ue.ONE,Ue.ONE,Ue.ONE_MINUS_SRC_ALPHA,Ue.ONE_MINUS_SRC_ALPHA),depthTest:{func:pa.LESS},colorWrite:Zi})}}Bs.shader=new ji(Bp,()=>Bi(()=>import("./SlicePlaneMaterial.glsl-77bd6ce8.js"),["assets/SlicePlaneMaterial.glsl-77bd6ce8.js","assets/SSAOHelper-868f5969.js","assets/typedArrayUtil-d9bc5fbd.js","assets/OrderIndependentTransparency-68bd812c.js","assets/enums-64ab819c.js","assets/cast-a534ae90.js","assets/string-480f3e3f.js","assets/Error-57322e92.js","assets/ensureType-25b8cc06.js","assets/nextTick-3ee5a785.js","assets/promiseUtils-32d9c228.js","assets/vec3-1863987c.js","assets/vec3f64-6cd30318.js","assets/common-c186b691.js","assets/Util-289ce3b5.js","assets/vec2f64-30dc1443.js","assets/vec4-46a9b36d.js","assets/vec4f64-939de194.js","assets/triangle-8cd02c5d.js","assets/sphere-622880b9.js","assets/mathUtils-57aba1ea.js","assets/mat4-7dde83b1.js","assets/byteSizeEstimations-90c5a50d.js","assets/quatf64-c94bd656.js","assets/mat4f64-fbeb2cd1.js","assets/lineSegment-c6f0b9d1.js","assets/Indices-d9b791ce.js","assets/VertexAttribute-9c5c630d.js","assets/ScreenSpacePass-6db805f2.js","assets/vec2-ab9f47bf.js","assets/compilerUtils-fefa73ae.js","assets/Evented-cbf5f368.js","assets/request-f17a8ddb.js","assets/preload-helper-101896b7.js","assets/requestImageUtils-f656eddc.js","assets/SSAO.glsl-3068f7bf.js","assets/assets-a5ce5e1a.js","assets/Texture-411ca148.js","assets/context-util-d4c193b5.js","assets/VertexArrayObject-3630ef4f.js","assets/mat4f32-77b3d8ac.js","assets/BufferView-478024d2.js","assets/aaBoundingBox-4a83dbbc.js","assets/Extent-a1a1de42.js","assets/aaBoundingRect-b340cf8c.js","assets/ViewingMode-915d19cb.js","assets/mat3-9a8d9db7.js","assets/quat-ec16a584.js","assets/vec3f32-4322908d.js","assets/SSAOBlur.glsl-ea338452.js","assets/VertexElementDescriptor-2925c6af.js","assets/reactiveUtils-5869e41a.js","assets/elevationInfoUtils-44cce436.js","assets/ElevationInfo-88554f24.js","assets/jsonMap-190c5593.js","assets/fieldUtils-77ec75e2.js","assets/arcadeOnDemand-5175e7d9.js","assets/geometry-eec1b371.js","assets/Polyline-b571c705.js","assets/typeUtils-cd52dc20.js","assets/lengthUtils-92fed992.js","assets/unitUtils-dd6fb8ee.js","assets/screenUtils-90993e16.js","assets/asyncUtils-087555fc.js","assets/automaticLengthMeasurementUtils-0fd27163.js","assets/intl-70c09a3c.js","assets/number-2ab8ca0d.js","assets/locale-30120714.js","assets/messages-28bf3b89.js","assets/index-7dfdb274.js","assets/Basemap-f70b1b37.js","assets/Collection-7c37b74e.js","assets/SimpleObservable-8e532943.js","assets/collectionUtils-0365f48b.js","assets/deprecate-0d93948c.js","assets/Loadable-46524a7e.js","assets/Promise-368b703a.js","assets/loadAll-01cdf0a9.js","assets/Portal-51616380.js","assets/PortalGroup-d495847c.js","assets/PortalUser-e16fc7d1.js","assets/PortalItem-6eebfb2b.js","assets/writeUtils-3bde6e49.js","assets/layerUtils-68eea656.js","assets/Color-af6e0c66.js","assets/colorUtils-639f4d25.js","assets/enumeration-61a13175.js","assets/opacityUtils-1333f803.js","assets/CollectionFlattener-f43a0fce.js","assets/TablesMixin-a4aaaf91.js","assets/Layer-ead8c88c.js","assets/Identifiable-093f90a8.js","assets/Graphic-1859ae71.js","assets/PopupTemplate-52faab17.js","assets/Clonable-9b34e760.js","assets/symbols-75e7a993.js","assets/CIMSymbol-8f02a6e3.js","assets/Symbol-8266348e.js","assets/symbolLayerUtils3D-c8c40895.js","assets/persistableUrlUtils-56d43b12.js","assets/jsonUtils-c6684c52.js","assets/Cyclical-078b4564.js","assets/workers-5d67fe7a.js","assets/Connection-b756149d.js","assets/Queue-275a6362.js","assets/projection-0af97a56.js","assets/zscale-48bab05e.js","assets/TileInfo-c5c8c8d2.js","assets/widget-09d2e7af.js","assets/uuid-73213768.js","assets/dom-5b7af1bf.js","assets/HandleOwner-2edbba46.js","assets/executeQueryJSON-0696009a.js","assets/normalizeUtils-6483f6b5.js","assets/query-71223310.js","assets/pbfQueryUtils-c922ef32.js","assets/pbf-8b0546e8.js","assets/OptimizedFeature-73582c6e.js","assets/OptimizedFeatureSet-1d1ac4b9.js","assets/queryZScale-3c8de33a.js","assets/FeatureSet-9cc47aef.js","assets/Field-1d4f9ca4.js","assets/fieldType-b34e5d2d.js","assets/Query-13124a97.js","assets/TimeExtent-2004eecf.js","assets/RelationshipQuery-c27267ab.js","assets/LegendOptions-2e7b3d70.js","assets/utils-4aa03157.js","assets/BlendLayer-813950f9.js","assets/parser-01f6451e.js","assets/ItemCache-bf1028d4.js","assets/MemCache-1d2f56ee.js","assets/utils-0c7f5071.js","assets/jsonUtils-559e9000.js","assets/UniqueValueRenderer-30750d31.js","assets/diffUtils-8a8cb5bc.js","assets/colorRamps-8d7efc14.js","assets/sizeVariableUtils-d4870b0d.js","assets/jsonUtils-eb568237.js","assets/styleUtils-015eeecd.js","assets/DictionaryLoader-326d0e17.js","assets/LRUCache-b9228ca3.js","assets/heatmapUtils-3d7c22c5.js","assets/featureConversionUtils-d2229ed4.js","assets/TopFeaturesQuery-9aca00bf.js","assets/FeatureLayer-9a7e04cf.js","assets/MultiOriginJSONSupport-b8792dfa.js","assets/LayerFloorInfo-e7c896e5.js","assets/FeatureLayerBase-d5682b4b.js","assets/HeightModelInfo-34f16d74.js","assets/arcgisLayerUrl-6e9db12f.js","assets/OperationalLayer-1dad72ac.js","assets/editsZScale-12d81957.js","assets/APIKeyMixin-b6e4f897.js","assets/ArcGISService-e571bcff.js","assets/CustomParametersMixin-a5d06ccc.js","assets/EditBusLayer-b5dc3689.js","assets/FeatureReductionLayer-1e5c4045.js","assets/labelingInfo-be3a629c.js","assets/labelUtils-4f4b54c6.js","assets/defaultsJSON-59981e75.js","assets/OrderedLayer-9623e905.js","assets/PortalLayer-9dd15f09.js","assets/RefreshableLayer-49182ab8.js","assets/ScaleRangeLayer-c072e266.js","assets/TemporalLayer-f784dd83.js","assets/TimeInfo-f76d6c20.js","assets/FeatureTemplate-c4496b93.js","assets/FeatureType-0be9420b.js","assets/fieldProperties-9e220f14.js","assets/FieldsIndex-16707836.js","assets/versionUtils-f229b9a6.js","assets/styleUtils-08eaa4d2.js","assets/popupUtils-88fed094.js","assets/colorUtils-82440b70.js","assets/mat2d-d0b91e3e.js","assets/Scheduler-5e6ccc87.js","assets/GraphicsLayer-a7c6f685.js","assets/unitBezier-881ac1eb.js","assets/mat3f32-d3d088e8.js","assets/vec2f32-461e65a9.js","assets/TileStrategy-a5366189.js","assets/TileStore-8f580dbf.js","assets/TileKey-9cae9369.js","assets/rbush-8e36784a.js","assets/quickselect-322ec8e1.js","assets/capabilities-d08b6e58.js","assets/Subtype-a3103d84.js","assets/datetime-4f774298.js","assets/QueryEngineResult-eb704fb1.js","assets/utils-52ad3c09.js","assets/generateRendererUtils-2f0b667c.js","assets/WhereClause-6c9440a1.js","assets/utils-63166b41.js","assets/json-48e3ea08.js","assets/EffectView-dffeb0bc.js","assets/ExportImageParameters-3714ed4b.js","assets/sublayerUtils-eea48c01.js","assets/webStyleSymbolUtils-6bef877f.js","assets/devEnvironmentUtils-5002a058.js","assets/dehydratedFeatures-3dcd65f1.js","assets/enums-4b2a86a0.js","assets/plane-46a8c767.js","assets/index-a8abe695.css","assets/geometryEngine-0f4f9d5a.js","assets/geometryEngineBase-3dd302e0.js","assets/hydrated-00dd97bc.js","assets/vec4f32-2f36231b.js","assets/Octree-8ed6dc77.js","assets/glUtil-7aa58841.js","assets/InterleavedLayout-b5930508.js","assets/types-e1c0a5bf.js","assets/NativeLineMaterial-b37d8d98.js","assets/triangulationUtils-6b510de4.js","assets/earcut-58237617.js","assets/deduplicate-d92c3cc2.js","assets/NestedMap-1b5db22e.js","assets/floatRGBA-090399ba.js","assets/boundedPlane-296928f6.js","assets/DrawGraphicTool-fda764ee.js","assets/automaticAreaMeasurementUtils-065aa71f.js","assets/GraphicManipulator-7a117f97.js","assets/TranslateTooltipInfos-2bd19c7a.js","assets/axisAngleDegrees-700f0205.js","assets/persistable-086be2f7.js","assets/multiOriginJSONSupportUtils-c978f4c3.js","assets/ExtentTooltipInfos-ad414646.js"]));function Yp(i,e){return bo(i.basis1,i.basis2,i.origin,e)}function Xp(i,e,t,a){const s=e.worldUpAtPosition(i.origin,S.get()),n=S.get();switch(t){case Vi.HEADING:U(n,s);break;case Vi.TILT:U(n,i.basis1)}return Nt(i.origin,n,a)}function Wp(i,e,t,a){const s=me(a.basis1),n=me(a.basis2),r=$o(a),o=ws(a),l=B(S.get(),0,0,0);z(l,W(S.get(),a.basis1,e.direction[0]),W(S.get(),a.basis2,e.direction[1])),z(l,a.origin,l);let c=0,p=1;if(ja(e))e.direction[0]===1&&e.direction[1]===-1?c=Es:e.direction[0]===1&&e.direction[1]===1?c=Math.PI:e.direction[0]===-1&&e.direction[1]===1&&(c=3*Math.PI/2),p=o;else{const m=e.direction[0]!==0?1:2;c=m===1?Es:0,p=(m===1?n:s)-r}const u=Ds(ne.get(),c);Yi(u,u,B(S.get(),p,p,p)),Be(u,t,u),u[12]=0,u[13]=0,u[14]=0,i.modelTransform=u,i.renderLocation=l}function Zp(i,e,t,a){const s=a.worldUpAtPosition(t.origin,S.get()),n=qp(t,$t.POSITIVE_X),r=Ds(ne.get(),n.edge*Math.PI/2);Qr(r,r,-iu(t,s)),Be(r,e,r),r[12]=0,r[13]=0,r[14]=0,i.modelTransform=r,i.renderLocation=n.position}var $t;function qp(i,e){switch(e){case $t.POSITIVE_X:return{basis:i.basis1,direction:1,position:z(S.get(),i.origin,i.basis1),edge:e};case $t.POSITIVE_Y:return{basis:i.basis2,direction:1,position:z(S.get(),i.origin,i.basis2),edge:e};case $t.NEGATIVE_X:return{basis:i.basis1,direction:-1,position:D(S.get(),i.origin,i.basis1),edge:e};case $t.NEGATIVE_Y:return{basis:i.basis2,direction:-1,position:D(S.get(),i.origin,i.basis2),edge:e}}}function $o(i){const e=me(i.basis1),t=me(i.basis2);return Hp*Math.min(e,t)}function ws(i){return $o(i)}function ja(i){return i.direction[0]!==0&&i.direction[1]!==0}function Qp(i,e=zi.CENTER_ON_ARROW){const t=e===zi.CENTER_ON_CALLOUT?as:0,a=[V(t,0,-_r/2),V(t,0,_r/2)],s=tu(a,!0),n=(b,x)=>Kp(a,a,{tubeRadius:Vp,tipRadius:ur,tipLength:Ss,tubeFocusMultiplier:Pp,tipFocusMultiplier:Rp,padding:b,bothEnds:!0,flat:null,focusTipLength:!0,addCap:x}),r=n(0,!1),o=n(zp,!0),l=new je({color:$p,cullFace:ee.Back,renderOccluded:$.Opaque}),c=new je({color:Cp,cullFace:ee.Back,renderOccluded:$.Opaque}),p=new je({color:Lp,cullFace:ee.Back,renderOccluded:$.Opaque}),u=new je({color:Gp,transparent:!0,writeDepth:!1,cullFace:ee.Front,renderOccluded:$.Transparent}),m=rt([[t,0,0],[t-as,0,0]]),f=rt([[t,0,0],[t-as,0,0]]),v=new Is({color:Ip,renderOccluded:$.OccludeAndTransparent});return new ce({view:i,renderObjects:[...r.normal.map(({part:b,geometry:x,transform:w})=>({geometry:x,material:b==="tip"?l:b==="cap"?c:p,transform:w,stateMask:E.Unfocused|Ot})),...o.normal.map(({geometry:b,transform:x})=>({geometry:b,material:u,transform:x,stateMask:E.Unfocused|Ot})),{geometry:m,material:v,stateMask:E.Unfocused|Ot|xs},...r.focused.map(({part:b,geometry:x,transform:w})=>({geometry:x,material:b==="tip"?l:b==="cap"?c:p,transform:w,stateMask:E.Focused|Ot})),...o.focused.map(({geometry:b,transform:x})=>({geometry:b,material:u,transform:x,stateMask:E.Focused|Ot})),{geometry:f,material:v,stateMask:E.Focused|Ot|xs}],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[s]},collisionPriority:1,radius:ur,state:Ot})}function Jp(i,e){const t=ja(e),a=t?[V(1,0,0),V(0,0,0),V(0,1,0)]:[V(1,0,0),V(-1,0,0)],s=rt(a),n=Np,r=v=>new Ft({color:n,width:v,renderOccluded:$.OccludeAndTransparent}),o=()=>new Is({color:n,renderOccluded:$.OccludeAndTransparent}),l=t?Fp:gr,c=l*Tp,p=gr,u=v=>v>1?r(v):o(),m=[{geometry:s,material:u(l),stateMask:E.Unfocused|ua},{geometry:s,material:u(c),stateMask:E.Focused|ua},{geometry:s,material:u(p),stateMask:Co}],f=new ce({view:i,renderObjects:m,collisionType:{type:"line",paths:[a]},radius:t?kp:Up,...Td});return f.state=ua,f}function Kp(i,e,t){const a=s=>{const n=(s?e:i).slice(0),r=D(S.get(),n[0],n[1]);te(r,r);const o=D(S.get(),n[n.length-1],n[n.length-2]);if(te(o,o),t.padding>0){const R=W(M(),o,-t.padding);if(n[n.length-1]=z(R,R,n[n.length-1]),t.bothEnds){const H=W(M(),r,-t.padding);n[0]=z(H,H,n[0])}}const l=s?t.tipFocusMultiplier:1,c=t.tipLength*(t.focusTipLength?l:1),p=t.tipRadius*l,u=ds(ne.get());if(t.padding>0){const R=c/4,H=B(S.get(),0,R,0),fe=1+t.padding/R;xa(u,u,H),Yi(u,u,B(S.get(),fe,fe,fe)),xa(u,u,W(H,H,-1/fe))}const m=ds(ge()),f=V(0,1,0),v=vn(ge(),xn(_n.get(),f,o));v[12]=n[n.length-1][0],v[13]=n[n.length-1][1],v[14]=n[n.length-1][2],Be(v,v,u);const b=[{part:"tube",geometry:eu(t.tubeRadius*(s?t.tubeFocusMultiplier:1)+t.padding,t.flat,n),transform:m}];let x,w;if(h(t.flat)?x=$i(c,p,p,t.flat.thickness):(x=_s(c,p,24,!1,!1,!0),w=_s(c,p,24,!1,!0,!1)),b.push({part:"tip",geometry:x,transform:v}),w&&b.push({part:"cap",geometry:w,transform:v}),t.bothEnds){const R=vn(ge(),xn(_n.get(),f,r));R[12]=n[0][0],R[13]=n[0][1],R[14]=n[0][2],Be(R,R,u),b.push({part:"tip",geometry:x,transform:R}),w&&b.push({part:"cap",geometry:w,transform:R})}return b};return{normal:a(!1),focused:a(!0)}}function eu(i,e,t){const a=[];if(h(e))a.push([i,e.thickness/2],[-i,e.thickness/2],[-i,-e.thickness/2],[i,-e.thickness/2]);else for(let n=0;n<12;n++){const r=n/12*2*Math.PI;a.push([Math.cos(r)*i,Math.sin(r)*i])}return no(a,t,[],[],!1)}function tu(i,e){const t=D(M(),i[i.length-1],i[i.length-2]);if(te(t,t),W(t,t,Ss),z(t,t,i[i.length-1]),e){const a=D(M(),i[0],i[1]);return te(a,a),W(a,a,Ss),z(a,a,i[0]),[a,...i,t]}return[...i,t]}function iu(i,e){return Fl(e,i.basis2,i.basis1)+Es}(function(i){i[i.POSITIVE_X=0]="POSITIVE_X",i[i.POSITIVE_Y=1]="POSITIVE_Y",i[i.NEGATIVE_X=2]="NEGATIVE_X",i[i.NEGATIVE_Y=3]="NEGATIVE_Y"})($t||($t={}));const Ot=J.Custom1;var Vi,mr;(function(i){i[i.HEADING=1]="HEADING",i[i.TILT=2]="TILT"})(Vi||(Vi={})),function(i){i[i.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",i[i.HORIZONTAL=1]="HORIZONTAL",i[i.VERTICAL=2]="VERTICAL",i[i.TILTED=3]="TILTED"}(mr||(mr={}));const xs=J.Custom2;Hi();const Es=Math.PI/2,ua=J.Custom1,Co=J.Custom2;var zi;(function(i){i[i.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",i[i.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(zi||(zi={}));const fr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",au={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function su(i){return i.fromData(fr,()=>new Fr(fr,au))}class nu{constructor(){this._lastDragEvent=null,this.next=new Ts,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&h(this._lastDragEvent)){const t={...this._lastDragEvent,action:"update"};e&&this._adjustScaleFactors(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this._lastDragEvent=null,e=>(this._lastDragEvent=e.action!=="end"?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e)}_adjustScaleFactors(e){const t=ja(e.handle)?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):e.handle.direction[0]===0?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-t:t,e.factor2=e.factor2<0?-t:t}get test(){return{_adjustScaleFactors:e=>this._adjustScaleFactors(e)}}}function da(i,e){return Lo(i,e,!1)}function vr(i,e){return Lo(i,e,!0)}function Lo(i,e,t){if(i instanceof Rl){if(i.operation instanceof Dl)return ru(i.operation,e,t),!0;if(i.operation instanceof $l)return ou(i.operation,e,t),!0;if(i.operation instanceof Cl)return lu(i.operation,e,t),!0}return!1}function ru(i,e,t=!1){const a=t?-1:1,s=V(a*i.dx,a*i.dy,a*i.dz);z(e.origin,e.origin,s)}function ou(i,e,t=!1){const a=t?-i.angle:i.angle;Ks(e.basis1,e.basis1,Oi,a),Ks(e.basis2,e.basis2,Oi,a)}function lu(i,e,t=!1){const a=t?1/i.factor1:i.factor1,s=t?1/i.factor2:i.factor2;W(e.basis1,e.basis1,a),W(e.basis2,e.basis2,s),rn(e.origin,e.origin,i.origin,i.axis1,a),rn(e.origin,e.origin,i.origin,i.axis2,s)}function hu(i,e,t,a){a||(a=Jt());const s=re(mt.get(),i[1],-i[0]),n=re(mt.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=re(mt.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),o=mt.get();e.components.forEach(p=>p.vertices.forEach(u=>{const m=u.pos;re(o,on(i,m),on(s,m)),rl(n,n,o),ol(r,r,o)}));const l=1e-6,c=re(mt.get(),r[0]-n[0]<l?t/2:0,r[1]-n[1]<l?t/2:0);return As(n,n,c),ft(r,r,c),ti(a.basis1,i,(r[0]-n[0])/2),ti(a.basis2,s,(r[1]-n[1])/2),re(a.origin,n[0]*i[0]+n[1]*s[0],n[0]*i[1]+n[1]*s[1]),ft(a.origin,a.origin,a.basis1),ft(a.origin,a.origin,a.basis2),a}function cu(i,e,t,a=0,s){s||(s=Jt()),e.toRenderCoords(i.origin,t,s.origin);const n=S.get();z(n,i.origin,i.basis1),z(n,n,i.basis2),e.toRenderCoords(n,t,n);const r=S.get();z(r,i.origin,i.basis1),D(r,r,i.basis2),e.toRenderCoords(r,t,r);const o=S.get();D(o,i.origin,i.basis1),D(o,o,i.basis2),e.toRenderCoords(o,t,o);const l=S.get();D(l,i.origin,i.basis1),z(l,l,i.basis2),e.toRenderCoords(l,t,l);const c=_t(S.get(),n,r,.5);D(c,c,s.origin);const p=_t(S.get(),o,l,.5);D(p,s.origin,p),_t(s.basis1,c,p,.5);const u=_t(S.get(),l,n,.5);D(u,u,s.origin);const m=_t(S.get(),r,o,.5);D(m,s.origin,m),_t(s.basis2,u,m,.5);const f=Se(S.get(),s.basis1,s.basis2),v=Se(f,f,s.basis1);return te(v,v),W(s.basis2,v,Ei(s.basis2,v)),W(s.basis1,s.basis1,1+a/me(s.basis1)),W(s.basis2,s.basis2,1+a/me(s.basis2)),nc(s),s}function yr(i,e,t,a){const s=S.get();D(s,D(s,i.origin,i.basis1),i.basis2);const n=S.get();Rt(n,s,i.basis1,2);const r=S.get();Rt(r,n,i.basis2,2);const o=S.get();Rt(o,s,i.basis2,2),s[2]=n[2]=r[2]=o[2]=e;const l=a?"on-the-ground":"absolute-height",c=sn(ta(s,n,t,l),ta(o,r,t,l)),p=sn(ta(n,r,t,l),ta(s,o,t,l));return g(p)||g(c)?null:[c,p]}let pe=class extends Ze.EventedMixin(La){constructor(i){super(i),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new bt,this._preserveAspectRatio=new nu,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new ot,this._moveZManipulator=null,this._resizeManipulators=null,this._rotateManipulator=null,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=Jt(),this._mapBoundsStart=Jt(),this._zmax=0,this._sizeStart=null,this._displayBounds=Jt(),this._displayBoundsStart=Jt(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=Lt(),this._endScale=Lt()}initialize(){const{view:i,graphic:e,manipulators:t,_handles:a}=this,s=this._graphicState=new kt({graphic:e}),n=e.geometry;this._editGeometryOperations=Ia.fromGeometry(n,i.state.viewingMode),this._graphicMoveManipulation=new js({tool:this,view:i,graphicState:s}),this._moveZManipulator=Qp(i,zi.CENTER_ON_CALLOUT),this._moveZManipulator.state|=xs,a.add([this._createMoveXYGraphicDragPipeline(),I(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._moveZManipulator,G.TRANSLATE_Z)),this._createMoveZDragPipeline()]),t.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map(p=>{const u=Jp(i,p);return a.add([I(()=>this.enableScaling,()=>this._updateManipulatorAvailability(u,G.SCALE)),u.events.on("grab-changed",m=>this._onResizeGrab(m)),this._createResizeDragPipeline(u,p)]),u}),t.addMany(this._resizeManipulators),this._rotateManipulatorTexture=su(i.toolViewManager.textures),this._rotateManipulator=Od(i,{texture:this._rotateManipulatorTexture.texture}),a.add([I(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._rotateManipulator,G.ROTATE)),this._rotateManipulator.events.on("grab-changed",p=>{this._onRotateGrab(p)}),this._createRotateDragPipeline(this._rotateManipulator)]),t.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const r=Ha({view:i,graphic:e,forEachManipulator:p=>this._forEachManipulator(p),onManipulatorsChanged:()=>Ct()});h(r)&&(this._outlineVisualElement=r.visualElement instanceof Ht?r.visualElement:null),h(this._outlineVisualElement)&&a.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>this._updateDisplayBounds())),a.add(r),a.add([s.on("changed",()=>this._onGeometryChanged()),I(()=>s.displaying,()=>this._updateAllManipulatorAvailability()),I(()=>s.isDraped,()=>this._graphicDrapedChanged(),ke),i.trackGraphicState(s)]);const o=i.pointsOfInterest;o&&a.add(I(()=>o.centerOnSurfaceFrequent.location,()=>this._updateDisplayBounds()));const l=p=>{a.add(p.events.on("grab-changed",()=>{this.grabbing=p.grabbing,this._updateAllManipulatorAvailability()}))};this._forEachManipulator(l);const c=(p,u)=>{a.add(p.events.on("immediate-click",m=>{u===G.TRANSLATE_XY&&this.emit("immediate-click",{...m,graphic:e}),m.stopPropagation()}))};this._forEachManipulator(c),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:i,view:e}=this,t=this._tooltip=new Fi({view:e}),a=()=>{t.info=this._getUpdatedTooltipInfo()};i.add([this.on("graphic-translate-start",a),this.on("graphic-translate",a),this.on("graphic-translate-stop",()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()}),this.on("graphic-rotate-start",s=>{this._startAngle=s.angle,a()}),this.on("graphic-rotate",s=>{this._endAngle=s.angle,a()}),this.on("graphic-rotate-stop",()=>{this._startAngle=0,this._endAngle=0,a()}),this.on("graphic-scale-start",s=>{re(this._startScale,s.xScale,s.yScale),re(this._endScale,s.xScale,s.yScale),a()}),this.on("graphic-scale",s=>{re(this._endScale,s.xScale,s.yScale),a()}),this.on("graphic-scale-stop",()=>{re(this._startScale,0,0),re(this._endScale,0,0),a()})]),this._forEachManipulator(s=>{i.add([s.events.on("focus-changed",a),s.events.on("grab-changed",a),s.events.on("drag",n=>{n.action==="cancel"?this._tooltip.clear():a()})])})}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some(i=>i.focused)?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=q(this._moveXYTooltipInfo,()=>new Ci({tooltipOptions:this.tooltipOptions}))}_computeMoveZTooltipInfo(){const i=this._moveZTooltipInfo=q(this._moveZTooltipInfo,()=>new za({tooltipOptions:this.tooltipOptions})),e=this._moveUnit;if(this._moveZManipulator.dragging){const t=this._mapBoundsStart.origin,a=this._mapBounds.origin,s=tl(t,a,this.view.spatialReference);if(g(s))return null;i.distance=s}else i.distance=Ti(0,e);return i}_computeRotateTooltipInfo(){const i=this._rotateTooltipInfo=q(this._rotateTooltipInfo,()=>new gc({tooltipOptions:this.tooltipOptions}));return i.angle=this._startAngle-this._endAngle,i}_computeScaleTooltipInfo(){const i=this.graphic.geometry;if(g(i))return null;const e=this._scaleTooltipInfo=q(this._scaleTooltipInfo,()=>new mc({tooltipOptions:this.tooltipOptions})),t=yr(this._mapBounds,this._zmax,i.spatialReference,this._graphicState.isDraped);return g(t)?null:(e.xSize=t[0],e.ySize=t[1],h(this._sizeStart)&&this._resizeManipulators.some(a=>a.dragging)?(e.xScale=t[0].value/this._sizeStart[0].value,e.yScale=t[1].value/this._sizeStart[1].value):(e.xScale=1,e.yScale=1),e)}_graphicDrapedChanged(){this._handles.remove(br),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",i=>{h(this._attachmentOrigin)&&ho(i.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()}),br)}_updateAllManipulatorAvailability(){this._forEachManipulator((i,e)=>this._updateManipulatorAvailability(i,e))}_updateManipulatorAvailability(i,e){const t=this.grabbing&&!i.grabbing;if(i.interactive=!t,i instanceof ce){const a=this._graphicState.displaying,s=this.enableZ&&Gt(this.graphic);switch(e){case G.ROTATE:i.available=a&&this.enableRotation;break;case G.SCALE:i.available=a&&(this.enableScaling||this.enableRotation||s),i.interactive=!t&&this.enableScaling,i.state=this.enableScaling?ua:Co;break;case G.TRANSLATE_Z:i.available=a&&s;break;default:i.available=a}}}_forEachManipulator(i){this._graphicMoveManipulation.forEachManipulator(i),this._resizeManipulators.forEach(e=>i(e,G.SCALE)),i(this._rotateManipulator,G.ROTATE),i(this._moveZManipulator,G.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(i){this._preserveAspectRatio.enabled=i,this._set("preserveAspectRatio",i)}get _moveUnit(){return q(sl(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const i=this.graphic.geometry,e=this._editGeometryOperations.data,t=e.components[0].edges[0],a=As(mt.get(),t.leftVertex.pos,t.rightVertex.pos);ba(a,a);const s=q(Ra(this.view,this.graphic),()=>i.extent.center);let n=pu*this.view.pixelSizeAt(s);const r=this.view.spatialReference,o=i.spatialReference;r.equals(o)||(n*=os(r)/os(o)),hu(a,e,n,this._mapBounds),this._updateZMax()}_updateZMax(){const i=this._editGeometryOperations.data;if(!i.geometry.hasZ)return void(this._zmax=0);const e=i.coordinateHelper;let t=Number.NEGATIVE_INFINITY;for(const a of i.components)for(const s of a.vertices){const n=e.getZ(s.pos);t=Math.max(n,t)}this._zmax=t}_updateDisplayBounds(){const i=this.graphic.geometry;if(g(i))return;const e=h(this._outlineVisualElement)&&!this._graphicState.isDraped&&h(this._outlineVisualElement.attachmentOrigin)?this._outlineVisualElement.attachmentOrigin:Ra(this.view,this.graphic);this._attachmentOrigin=q(e,i.extent.center);const t=h(e)?e.z:Va(this._mapBounds.origin,this.view.elevationProvider,ci.fromElevationInfo(X(this.graphic)),this.view.renderCoordsHelper),a=ui(this._mapBounds);a.origin[2]=t,cu(a,this.view.renderCoordsHelper,i.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){const i=this.view.pointsOfInterest,e=i?i.centerOnSurfaceFrequent.location:this._editGeometryOperations.data.geometry.extent.center;return du*this.view.pixelSizeAt(e)}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline((i,e,t)=>this._applyGraphicMoveSteps(e,t,A.XY))}_createMoveZDragPipeline(){const i=this.view,e=this._editGeometryOperations.data.spatialReference;return Le(this._moveZManipulator,(t,a,s)=>{const n=ma(t.renderLocation),r=a.next(To(i,n,e)).next(li());this._applyGraphicMoveSteps(r,s,A.Z)})}_applyGraphicMoveSteps(i,e,t){const a=i.next(s=>(s.action==="start"&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:s.screenDeltaX,dyScreen:s.screenDeltaY})),s)).next(Qt()).next(this._moveDragUpdateGeometry()).next(s=>{const n={graphic:this.graphic,dxScreen:s.screenDeltaX,dyScreen:s.screenDeltaY};switch(s.action){case"start":case"update":(s.mapEnd.x-s.mapStart.x||s.mapEnd.y-s.mapStart.y||s.mapEnd.z-s.mapStart.z)&&this.emit("graphic-translate",n);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",n)}return s}).next(s=>this._updateMoveTooltip(s,t));return e.next(()=>{h(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()}),a}_updateOperationStartProperties(){ui(this._displayBounds,this._displayBoundsStart),ui(this._mapBounds,this._mapBoundsStart),g(this.graphic.geometry)?this._sizeStart=null:this._sizeStart=yr(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped)}_moveDragUpdateGeometry(){return i=>{if(g(this.inputState)||this.inputState.type!=="move")return i;const e=[];for(const s of this._editGeometryOperations.data.components)e.push(...s.vertices);const t=i.action==="start"?tt.NEW_STEP:tt.ACCUMULATE_STEPS,a=this._editGeometryOperations.moveVertices(e,i.mapDeltaX,i.mapDeltaY,i.mapDeltaZ,t);return da(a,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,i}}_updateMoveTooltip(i,e){if(e===A.XY||e===A.XY_AXIS){const t=st(i.mapStart,i.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");h(t)&&h(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=t)}return i}_onResizeGrab(i){if(i.action!=="start")return;const e=this._calculatePickRay(i.screenPoint);ri(this._displayBounds.plane,e,S.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(i,e){return Le(i,(t,a,s)=>{g(this.inputState)||(a.next(n=>(n.action==="start"&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),n)).next(Da(this.view,this._displayBoundsStart.plane)).next(n=>({...n,handle:e})).next(this._resizeDragRenderPlaneToFactors()).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(this._resizeDragUpdateGeometry()).next(n=>{const r={graphic:this.graphic,xScale:n.factor1,yScale:n.factor2};switch(n.action){case"start":case"update":this.emit("graphic-scale",r);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",r)}return n}),s.next(()=>{h(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()}))})}_resizeDragRenderPlaneToFactors(){return i=>{const e=this._displayBoundsStart,t=i.handle.direction,a=this._displayBoundsMargin,s=this._displayBoundsMarginStart,n=U(S.get(),e.origin);Rt(n,n,e.basis1,-t[0]),Rt(n,n,e.basis2,-t[1]);const r=D(S.get(),i.renderEnd,n),o=D(S.get(),i.renderStart,n),l=ja(i.handle),c=ws(e),p=ws(this._displayBounds)/c,u=(m,f)=>{if(m===0)return 1;let v=me(f),b=.5*m*Ei(f,r)/v;const x=b<0?-1:1;l&&(b+=(v-.5*m*Ei(f,o)/v)*x*p);const w=v<1.5*s?1:Mr;return v=Math.max(v-s,Mr),x>0&&(b-=a),x*Math.max(x*(b/v),w)};return{...i,factor1:u(t[0],e.basis1),factor2:u(t[1],e.basis2)}}}_resizeDragUpdateGeometry(){return i=>{const e=U(M(),this._mapBoundsStart.origin);Rt(e,e,this._mapBoundsStart.basis1,-i.handle.direction[0]),Rt(e,e,this._mapBoundsStart.basis2,-i.handle.direction[1]);const t=re(Lt(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);ba(t,t);const a=[];for(const r of this._editGeometryOperations.data.components)a.push(...r.vertices);const s=i.action==="start"?tt.NEW_STEP:tt.ACCUMULATE_STEPS,n=this._editGeometryOperations.scaleVertices(a,e,t,i.factor1,i.factor2,s,pn.REPLACE);return ui(this._mapBoundsStart,this._mapBounds),da(n,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,i}}_onRotateGrab(i){if(i.action!=="start")return;const e=Xp(this._displayBounds,this.view.renderCoordsHelper,Vi.HEADING,hi()),t=this._calculatePickRay(i.screenPoint);ri(e,t,S.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:e})}_createRotateDragPipeline(i){return Le(i,(e,t,a)=>{const s=this.inputState;g(s)||(t.next(n=>(n.action==="start"&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),n)).next(Da(this.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(this._rotateDragUpdateGeometry()).next(n=>{const r={graphic:this.graphic,angle:Di(n.rotateAngle)};switch(n.action){case"start":case"update":this.emit("graphic-rotate",r);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",r)}return n}),a.next(()=>{h(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()}))})}_rotateDragRenderPlaneToRotate(i){return e=>{const t=qi(i.rotatePlane),a=yo(e.renderStart,e.renderEnd,this._displayBounds.origin,t);return{...e,rotateAxis:t,rotateAngle:a}}}_rotateDragUpdateGeometry(){return i=>{const e=U(M(),this._mapBoundsStart.origin),t=[];for(const n of this._editGeometryOperations.data.components)t.push(...n.vertices);const a=i.action==="start"?tt.NEW_STEP:tt.ACCUMULATE_STEPS,s=this._editGeometryOperations.rotateVertices(t,e,i.rotateAngle,a,pn.REPLACE);return ui(this._mapBoundsStart,this._mapBounds),da(s,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,i}}_calculatePickRay(i){const e=Hi(),t=fa(i);return ai(this.view.state.camera,t,e),te(e.direction,e.direction),e}_updateManipulators(){if(!this.visible)return;const i=Yp(this._displayBounds,ne.get());Zp(this._rotateManipulator,i,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,i),this._resizeManipulators.forEach((e,t)=>{Wp(e,this._resizeHandles[t],i,this._displayBounds)})}_updateZMoveHandle(i,e){const t=this._displayBounds,a={basis:t.basis1,direction:-1,position:D(S.get(),t.origin,t.basis1),edge:2},s=ne.get();oh(s,e,a.edge*Math.PI/2),s[12]=0,s[13]=0,s[14]=0,i.modelTransform=s,i.renderLocation=a.position}_cancel(){const i=this._editGeometryOperations.lastOperation;g(i)||(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,vr(i,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if(h(this.inputState))this.view.activeTool=null;else if(this.canUndo){const i=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,vr(C(i),this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const i=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,da(C(i),this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};d([_({constructOnly:!0,nonNullable:!0})],pe.prototype,"view",void 0),d([_({constructOnly:!0,nonNullable:!0})],pe.prototype,"graphic",void 0),d([_({constructOnly:!0,nonNullable:!0})],pe.prototype,"enableZ",void 0),d([_()],pe.prototype,"enableRotation",void 0),d([_()],pe.prototype,"enableScaling",void 0),d([_({constructOnly:!0,type:bt})],pe.prototype,"tooltipOptions",void 0),d([_()],pe.prototype,"preserveAspectRatio",null),d([_()],pe.prototype,"grabbing",void 0),d([_()],pe.prototype,"inputState",void 0),d([_({readOnly:!0})],pe.prototype,"type",void 0),d([_()],pe.prototype,"_moveUnit",null),pe=d([Q("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],pe);const br="draped-elevation-changes",du=10,pu=80,Mr=1e-6,Fg=Object.freeze(Object.defineProperty({__proto__:null,get DrawGraphicTool3D(){return Tt},get ExtentTransformTool(){return pe},get GraphicMoveTool(){return Fe},get GraphicReshapeTool(){return se},get GraphicTransformTool(){return de}},Symbol.toStringTag,{value:"Module"}));export{Rc as A,go as C,Fg as e,bd as f,jp as t,Ec as v,od as w};
