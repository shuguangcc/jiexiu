import{_ as G}from"./preload-helper-101896b7.js";import{l}from"./Color-af6e0c66.js";import{c as h,x as k,r as X}from"./symbols-75e7a993.js";import{c as Y}from"./asyncUtils-087555fc.js";import{h as j}from"./string-480f3e3f.js";import{t as b,r as f,f as R,e as P,q as F}from"./typedArrayUtil-d9bc5fbd.js";import{u,e as W}from"./screenUtils-90993e16.js";import{l as _}from"./vec3f64-6cd30318.js";import{i as V}from"./BlendLayer-813950f9.js";import{a as U}from"./assets-a5ce5e1a.js";import{U as D}from"./request-f17a8ddb.js";import{e as H}from"./ItemCache-bf1028d4.js";import{f as S,u as q,M,y as C,m as d,C as J}from"./utils-0c7f5071.js";function E(e,t,o,r){if(e)if(e.type!=="CIMTextSymbol"){if(o&&e.effects)for(const n of e.effects)K(n,t);if(e.symbolLayers)for(const n of e.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":B(n,t,r);break;case"CIMPictureStroke":case"CIMSolidStroke":!(r!=null&&r.preserveOutlineWidth)&&n.width&&(n.width*=t);break;case"CIMPictureFill":n.height&&(n.height*=t),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t);break;case"CIMHatchFill":E(n.lineSymbol,t,!0,{...r,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=t),n.offsetY&&(n.offsetY*=t),n.separation&&(n.separation*=t)}}else e.height!=null&&(e.height*=t)}function B(e,t,o){if(e&&(e.markerPlacement&&N(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&e.anchorPointUnits==="Absolute"&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=e.size!=null?e.size*t:0,e.type==="CIMVectorMarker"&&e.markerGraphics))for(const r of e.markerGraphics)e.scaleSymbolsProportionally||E(r.symbol,t,!0,o)}function N(e,t){switch(d(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const o=e.placementTemplate.map(r=>r*t);e.placementTemplate=o}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const o=e.placementTemplate.map(r=>r*t);e.placementTemplate=o}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}function K(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const o=e.dashTemplate.map(r=>r*t);e.dashTemplate=o}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function Q(e){const t=[];return I(S(e),t),t.length?new l(q(t[0])):null}function I(e,t){var n;if(!e)return;let o;o=e.type==="CIMTextSymbol"?e.symbol:e;const r=e.type==="CIMPolygonSymbol";if(o!=null&&o.symbolLayers){for(const s of o.symbolLayers)if(!(s.colorLocked||r&&(M(s)||C(s)&&s.markerPlacement&&d(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&L(t,s.tintColor);break;case"CIMVectorMarker":(n=s.markerGraphics)==null||n.forEach(a=>{I(a.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":L(t,s.color);break;case"CIMHatchFill":I(s.lineSymbol,t)}}}function L(e,t){for(const o of e)if(o.join(".")===t.join("."))return;e.push(t)}function xe(e,t,o){t instanceof l||(t=new l(t));const r=S(e);r&&w(r,t,o)}function w(e,t,o){var s;if(!e)return;let r;r=e.type==="CIMTextSymbol"?e.symbol:e;const n=(r==null?void 0:r.type)==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers)for(const a of r.symbolLayers){if(a.colorLocked)continue;if(n){if(o){const{layersToColor:i}=o;if((M(a)||C(a)&&a.markerPlacement&&d(a.markerPlacement))&&i==="fill"||J(a)&&i==="outline")continue}else if(M(a)||C(a)&&a.markerPlacement&&d(a.markerPlacement))continue}const c=t.toArray();switch(a.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":a.tintColor=c;break;case"CIMVectorMarker":(s=a.markerGraphics)==null||s.forEach(i=>{w(i.symbol,t,o)});break;case"CIMSolidStroke":case"CIMSolidFill":a.color=c;break;case"CIMHatchFill":w(a.lineSymbol,t,o)}}}const x="picture-fill",O="simple-fill",Z="simple-line",T="simple-marker",ee="text",te="cim",g=new H(1e3);function Oe(e){const t=e.style;let o=null;if(e)switch(e.type){case T:t!=="cross"&&t!=="x"&&(o=e.color);break;case O:t==="solid"?o=e.color:t!=="none"&&(o={type:"pattern",x:0,y:0,src:U(`esri/symbols/patterns/${t}.png`),width:5,height:5});break;case x:o={type:"pattern",src:e.url,width:u(e.width)*e.xscale,height:u(e.height)*e.yscale,x:u(e.xoffset),y:u(e.yoffset)};break;case ee:o=e.color;break;case te:o=Q(e)}return o}function Te(e,t){const o=e+"-"+t;return g.get(o)!==void 0?Promise.resolve(g.get(o)):D(e,{responseType:"image"}).then(r=>{const n=r.data,s=n.naturalWidth,a=n.naturalHeight,c=document.createElement("canvas");c.width=s,c.height=a;const i=c.getContext("2d");i.fillStyle=t,i.fillRect(0,0,s,a),i.globalCompositeOperation="destination-in",i.drawImage(n,0,0);const m=c.toDataURL();return g.put(o,m),m})}function z(e){if(!e)return null;let t=null;switch(e.type){case O:case x:case T:t=z(e.outline);break;case Z:{const o=u(e.width);e.style!=null&&e.style!=="none"&&o!==0&&(t={color:e.color,style:oe(e.style),width:o,cap:e.cap,join:e.join==="miter"?u(e.miterLimit):e.join});break}default:t=null}return t}const oe=(()=>{const e={};return t=>{if(e[t])return e[t];const o=t.replace(/-/g,"");return e[t]=o,o}})(),ze=new l([128,128,128]),$=/\/resource\/(.*?)\.svg$/,re=new l("white");function ne(e){const t=e.symbolLayers&&e.symbolLayers.length;if(!t)return;const o=e.symbolLayers.getItemAt(t-1);return"outline"in o?F(o,"outline","size"):void 0}function ve(e){var t;if(!e)return 0;if(h(e)){const o=ne(e);return f(o)?o:0}return W((t=z(e))==null?void 0:t.width)}function Ae(e){if(b(e)||!("symbolLayers"in e)||b(e.symbolLayers))return!1;switch(e.type){case"point-3d":return e.symbolLayers.some(t=>t.type==="object");case"line-3d":return e.symbolLayers.some(t=>t.type==="path");case"polygon-3d":return e.symbolLayers.some(t=>t.type==="object"||t.type==="extrude");default:return!1}}function Ge(e,t){const o=R(t.resource).href;return!j("esri-canvas-svg-support")&&e.styleOrigin&&$.test(o)?o.replace($,"/resource/png/$1.png"):o}function Xe(e,t){if(!e)return null;let o=null;return h(e)?o=se(e):k(e)&&(o=e.color?new l(e.color):null),o?y(o,t):null}function se(e){const t=e.symbolLayers;if(!t)return null;let o=null;return t.forEach(r=>{var n;r.type==="object"&&((n=r.resource)==null?void 0:n.href)!=null||(o=r.type==="water"?P(r.color):f(r.material)?P(r.material.color):null)}),o?new l(o):null}function y(e,t){if(t==null||e==null)return e;const o=e.toRgba();return o[3]=o[3]*t,new l(o)}function ae(e,t,o){const r=e.symbolLayers;if(!r)return;const n=s=>{const a=f(s)?s:null;return y(t=t??a??(o!=null?re:null),o)};r.forEach(s=>{var a;if(s.type!=="object"||((a=s.resource)==null?void 0:a.href)==null||t)if(s.type==="water")s.color=n(s.color);else{const c=f(s.material)?s.material.color:null,i=n(c);b(s.material)?s.material=new X({color:i}):s.material.color=i,o!=null&&"outline"in s&&f(s.outline)&&f(s.outline.color)&&(s.outline.color=y(s.outline.color,o))}})}function ie(e,t,o){(t=t??e.color)&&(e.color=y(t,o)),o!=null&&"outline"in e&&e.outline&&e.outline.color&&(e.outline.color=y(e.outline.color,o))}function Ye(e,t,o){e&&(t||o!=null)&&(t&&(t=new l(t)),h(e)?ae(e,t,o):k(e)&&ie(e,t,o))}async function ce(e,t){const o=e.symbolLayers;o&&await Y(o,async r=>le(r,t))}async function le(e,t){switch(e.type){case"extrude":ue(e,t);break;case"icon":case"line":case"text":fe(e,t);break;case"path":pe(e,t);break;case"object":await me(e,t)}}function fe(e,t){const o=v(t);f(o)&&(e.size=o)}function v(e){for(const t of e)if(typeof t=="number")return t;return null}function ue(e,t){e.size=typeof t[2]=="number"?t[2]:0}async function me(e,t){const{resourceSize:o,symbolSize:r}=await ye(e),n=A(t,o,r);e.width=p(t[0],r[0],o[0],n),e.depth=p(t[1],r[1],o[1],n),e.height=p(t[2],r[2],o[2],n)}function pe(e,t){const o=A(t,_,[e.width,void 0,e.height]);e.width=p(t[0],e.width,1,o),e.height=p(t[2],e.height,1,o)}function A(e,t,o){for(let r=0;r<3;r++){const n=e[r];switch(n){case"symbol-value":{const s=o[r];return s!=null?s/t[r]:1}case"proportional":break;default:if(n&&t[r])return n/t[r]}}return 1}async function ye(e){const t=await G(()=>import("./symbolLayerUtils-b38da77b.js"),["assets/symbolLayerUtils-b38da77b.js","assets/preload-helper-101896b7.js","assets/request-f17a8ddb.js","assets/Error-57322e92.js","assets/string-480f3e3f.js","assets/typedArrayUtil-d9bc5fbd.js","assets/promiseUtils-32d9c228.js","assets/ItemCache-bf1028d4.js","assets/MemCache-1d2f56ee.js","assets/cast-a534ae90.js","assets/ensureType-25b8cc06.js","assets/nextTick-3ee5a785.js","assets/aaBoundingBox-4a83dbbc.js","assets/Extent-a1a1de42.js","assets/aaBoundingRect-b340cf8c.js","assets/mathUtils-57aba1ea.js","assets/vec3-1863987c.js","assets/vec3f64-6cd30318.js","assets/common-c186b691.js","assets/vec4-46a9b36d.js","assets/symbolLayerUtils3D-c8c40895.js"]),o=await t.computeObjectLayerResourceSize(e,10),{width:r,height:n,depth:s}=e,a=[r,s,n];let c=1;for(let i=0;i<3;i++){const m=a[i];if(m!=null){c=m/o[i];break}}for(let i=0;i<3;i++)a[i]==null&&(a[i]=o[i]*c);return{resourceSize:o,symbolSize:a}}function p(e,t,o,r){switch(e){case"proportional":return o*r;case"symbol-value":return t??o;default:return e}}function he(e,t){const o=v(t);if(!b(o))switch(e.type){case"simple-marker":e.size=o;break;case"picture-marker":{const r=e.width/e.height;r>1?(e.width=o,e.height=o*r):(e.width=o*r,e.height=o);break}case"simple-line":e.width=o;break;case"text":e.font.size=o}}async function je(e,t){if(e&&t)return h(e)?ce(e,t):void(k(e)&&he(e,t))}function Re(e,t,o){if(e&&t!=null)if(h(e)){const r=e.symbolLayers;r&&r.forEach(n=>{if(n&&n.type==="object")switch(o){case"tilt":n.tilt=t;break;case"roll":n.roll=t;break;default:n.heading=t}})}else k(e)&&(e.type!=="simple-marker"&&e.type!=="picture-marker"&&e.type!=="text"||(e.angle=t))}function Fe(e){if(!e)return null;const t=e.effects.filter(o=>o.type!=="bloom").map(o=>o.toJSON());return V(t)}function We(e){return f(e)&&e.type==="polygon-3d"&&e.symbolLayers.some(t=>t.type==="extrude")}export{We as B,xe as I,je as M,Re as N,oe as a,Ge as b,Ae as d,Oe as f,ze as g,Te as h,Xe as j,B as m,Fe as q,ve as w,Ye as x,z as y};
